1:"$Sreact.fragment"
2:I[7555,[],""]
3:I[1901,["874","static/chunks/874-90f68e0a3827b559.js","39","static/chunks/app/error-d036ecfd03716e30.js"],"default"]
4:I[1295,[],""]
5:I[9543,["874","static/chunks/874-90f68e0a3827b559.js","345","static/chunks/app/not-found-2113bbd7a2f55e8f.js"],"default"]
8:I[9665,[],"MetadataBoundary"]
a:I[9665,[],"OutletBoundary"]
d:I[4911,[],"AsyncMetadataOutlet"]
f:I[8460,["209","static/chunks/app/loading-b73dd9bd22c3caa2.js"],"default"]
10:I[9665,[],"ViewportBoundary"]
12:I[6614,[],""]
:HL["/_next/static/media/569ce4b8f30dc480-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/media/93f479601ee12b01-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/60adccb42f39203c.css","style"]
:HL["/_next/static/css/c7f6e508dc13ee25.css","style"]
0:{"P":null,"b":"fPyRDf3jU8EaKreMEXeMB","p":"","c":["","posts","134e96d502f2544c3b48fbed"],"i":false,"f":[[["",{"children":["(article)",{"children":["posts",{"children":[["slug","134e96d502f2544c3b48fbed","d"],{"children":["__PAGE__",{}]}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/60adccb42f39203c.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__variable_5cfdac __variable_9a8899 antialiased","children":["$","$L2",null,{"parallelRouterKey":"children","error":"$3","errorStyles":[],"errorScripts":[],"template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","$L5",null,{}],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}]]}],{"children":["(article)",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/c7f6e508dc13ee25.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],"$L6"]}],{"children":["posts",["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","134e96d502f2544c3b48fbed","d"],["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L7",["$","$L8",null,{"children":"$L9"}],null,["$","$La",null,{"children":["$Lb","$Lc",["$","$Ld",null,{"promise":"$@e"}]]}]]}],{},null,false]},null,false]},null,false]},null,false]},[["$","$Lf","l",{}],[],[]],false],["$","$1","h",{"children":[null,["$","$1","TmJp38nGTk7RluLUFI14i",{"children":[["$","$L10",null,{"children":"$L11"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}],null]}],false]],"m":"$undefined","G":["$12","$undefined"],"s":false,"S":true}
13:I[2034,["874","static/chunks/874-90f68e0a3827b559.js","296","static/chunks/296-93bf38127a29d878.js","766","static/chunks/766-3404ce8492c1c2aa.js","846","static/chunks/846-5073d6248f7e4d01.js","651","static/chunks/app/(article)/layout-0113e097a12c4d28.js"],"default"]
14:"$Sreact.suspense"
15:I[4911,[],"AsyncMetadata"]
6:["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__variable_5cfdac __variable_9a8899 antialiased","children":[["$","div",null,{"className":"min-h-screen","children":[["$","$L13",null,{}],["$","main",null,{"className":"p-6 flex justify-center","children":["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]}],["$","footer",null,{"className":"bg-neutral-50 border-t border-neutral-200 text-center text-xs opacity-50 py-4","children":["© 2022 - ",2025,["$","a",null,{"rel":"noopener noreferrer","className":"hover:underline hover:bg-indigo","href":"https://github.com/LZS911","target":"_blank","children":", LZS_911"}],", build with"," ",["$","a",null,{"rel":"noopener noreferrer","className":"underline hover:bg-indigo","href":"https://nextjs.org/","target":"_blank","children":"Next.js"}]," ","and"," ",["$","a",null,{"rel":"noopener noreferrer","className":"underline hover:bg-indigo","href":"https://vercel.com/","target":"_blank","children":"Vercel"}]]}]]}],false]}]}]
9:["$","$14",null,{"fallback":null,"children":["$","$L15",null,{"promise":"$@16"}]}]
c:null
17:I[5099,["874","static/chunks/874-90f68e0a3827b559.js","296","static/chunks/296-93bf38127a29d878.js","766","static/chunks/766-3404ce8492c1c2aa.js","520","static/chunks/app/(article)/posts/%5Bslug%5D/page-15870e626cfa21a8.js"],"ThemeLoader"]
18:T2517,<h2 id="packagemanager-字段与-managepackagemanagerversions-配置"><a aria-hidden="true" tabindex="-1" href="#packagemanager-字段与-managepackagemanagerversions-配置"><span class="icon icon-link"></span></a>packageManager 字段与 managePackageManagerVersions 配置</h2>
<h3 id="1-packagejson-配置"><a aria-hidden="true" tabindex="-1" href="#1-packagejson-配置"><span class="icon icon-link"></span></a>1. package.json 配置</h3>
<ul>
<li>
<p>在 <code>package.json</code> 中添加 <code>packageManager</code>  声明项目所需的 pnpm 版本，例如：<code>"packageManager": "pnpm@8.3.1"</code></p>
</li>
<li>
<p>在 <code>package.json</code> 中添加 <code>engines</code> 字段设置运行环境要求，例如：<code>"engines": {"pnpm": ">=9.7"}</code></p>
</li>
</ul>
<p>pnpm 10.x 及以上版本会自动检测该字段，并在执行任何 pnpm 命令时，自动下载并切换到指定版本。若 pnpm 版本低于 10.x，请先执行 <code>pnpm self-update</code> 进行更新。</p>
<h3 id="2版本自动切换功能"><a aria-hidden="true" tabindex="-1" href="#2版本自动切换功能"><span class="icon icon-link"></span></a>2.版本自动切换功能</h3>
<p>从 pnpm 9.7 版本开始，pnpm 引入了自动版本切换功能。当执行任何 pnpm 命令时，它会自动检测 package.json 中的 packageManager 字段，并下载切换到指定版本。若当前全局安装的 pnpm 版本低于 9.7，由于 engines 字段的限制，执行 pnpm install 会导致错误。此时需要执行 pnpm self-update 升级 pnpm 到最新版本。</p>
<h3 id="3-pnpm-managepackagemanagerversions-配置说明"><a aria-hidden="true" tabindex="-1" href="#3-pnpm-managepackagemanagerversions-配置说明"><span class="icon icon-link"></span></a>3. pnpm managePackageManagerVersions 配置说明</h3>
<p>pnpm 是否自动切换版本由 <code>managePackageManagerVersions</code> 配置项控制，默认值为 <code>true</code>。</p>
<ul>
<li><strong>开启（默认）</strong>：pnpm 会自动根据 <code>packageManager</code> 字段切换版本。</li>
<li><strong>关闭</strong>：pnpm 始终使用当前全局安装的版本，不会自动切换。</li>
</ul>
<h4 id="配置方法"><a aria-hidden="true" tabindex="-1" href="#配置方法"><span class="icon icon-link"></span></a>配置方法</h4>
<ul>
<li>
<p>关闭配置：</p>
<pre><code class="hljs language-bash">pnpm config <span class="hljs-built_in">set</span> manage-package-manager-versions <span class="hljs-literal">false</span>
</code></pre>
</li>
<li>
<p>启用配置：</p>
<pre><code class="hljs language-bash"> pnpm config <span class="hljs-built_in">set</span> manage-package-manager-versions <span class="hljs-literal">true</span>
</code></pre>
</li>
</ul>
<h4 id="验证方法"><a aria-hidden="true" tabindex="-1" href="#验证方法"><span class="icon icon-link"></span></a>验证方法</h4>
<ol>
<li>修改 <code>package.json</code> 的 <code>packageManager</code> 字段为不同版本。</li>
<li>执行 <code>pnpm -v</code>，观察输出。
<ul>
<li>如果 <code>managePackageManagerVersions</code> 为 <code>true</code>，pnpm 会自动切换到指定版本。</li>
<li>如果为 <code>false</code>，pnpm 只会输出全局安装的版本。</li>
</ul>
</li>
</ol>
<h3 id="3-相关参考"><a aria-hidden="true" tabindex="-1" href="#3-相关参考"><span class="icon icon-link"></span></a>3. 相关参考</h3>
<ul>
<li><a href="https://pnpm.io/settings#managepackagemanagerversions">pnpm 官方文档 - managePackageManagerVersions</a></li>
</ul>
<hr>
<p><strong>结论</strong>：<br>
pnpm 10.x 及以上版本的"自动 shim"机制由 <code>managePackageManagerVersions</code> 配置控制。你可以根据团队需要灵活开启或关闭该特性，确保开发和 CI 环境下的 pnpm 版本一致性或灵活性。</p>
<h2 id="使用-corepack-管理-pnpm-版本方案"><a aria-hidden="true" tabindex="-1" href="#使用-corepack-管理-pnpm-版本方案"><span class="icon icon-link"></span></a>使用 Corepack 管理 pnpm 版本方案</h2>
<h3 id="corepack-简介"><a aria-hidden="true" tabindex="-1" href="#corepack-简介"><span class="icon icon-link"></span></a>Corepack 简介</h3>
<p>Corepack 是 Node.js 从 v16.9.0 开始内置的包管理器版本管理工具，它可以帮助项目锁定 yarn、pnpm 等包管理器的版本，确保团队成员使用相同的包管理器版本，提高项目的一致性。</p>
<h3 id="corepack-安装"><a aria-hidden="true" tabindex="-1" href="#corepack-安装"><span class="icon icon-link"></span></a>Corepack 安装</h3>
<p>首先卸载全局 yarn 和 pnpm 二进制文件（保留 npm），通常可以使用以下命令执行：</p>
<pre><code class="hljs language-bash">npm uninstall -g yarn pnpm
</code></pre>
<p>然后安装 corepack</p>
<pre><code class="hljs language-bash">npm install -g corepack
</code></pre>
<h3 id="1-启用-corepack"><a aria-hidden="true" tabindex="-1" href="#1-启用-corepack"><span class="icon icon-link"></span></a>1. 启用 Corepack</h3>
<p>安装完成后执行以下命令用于启用 corepack</p>
<pre><code class="hljs language-bash">corepack <span class="hljs-built_in">enable</span>
</code></pre>
<p>也可以单独启用特定的包管理器：</p>
<pre><code class="hljs language-bash">corepack <span class="hljs-built_in">enable</span> pnpm
</code></pre>
<h3 id="2-配置项目使用-corepack"><a aria-hidden="true" tabindex="-1" href="#2-配置项目使用-corepack"><span class="icon icon-link"></span></a>2. 配置项目使用 Corepack</h3>
<p>与上述 pnpm 自带机制类似，Corepack 也使用 <code>package.json</code> 中的 <code>packageManager</code> 字段：</p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"packageManager"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm@8.3.1"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>配置后，执行 <code>pnpm -v</code> 后将会出现安装 pnpm 提示</p>
<p><img src="/assets/blog/posts/image-1747298914915-9od5nvz.png" alt="图片"></p>
<h3 id="3-新项目使用-corepack"><a aria-hidden="true" tabindex="-1" href="#3-新项目使用-corepack"><span class="icon icon-link"></span></a>3. 新项目使用 Corepack</h3>
<p>当项目 package.json 未配置 packageManager 字段时，可以在项目中使用 npm、yarn 或 pnpm 中的任意一种。初次使用后，Corepack 会显示安装提示，安装成功后会自动在 package.json 中添加 packageManager 字段。</p>
<p>以下是初次安装并使用 yarn 后，Corepack 自动添加的 packageManager 配置示例：</p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"packageManager"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"yarn@1.22.22+sha512.a6b2f7906b721bba3d67d4aff083df04dad64c399707841b7acf00f6b133b7ac24255f2652fa22ae3534329dc6180534e98d17432037ff6fd140556e2bb3137e"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>更多详情可参考 <a href="https://github.com/nodejs/corepack?tab=readme-ov-file#-corepack">Corepack 官方文档</a>。</p>
<h2 id="两种方案对比"><a aria-hidden="true" tabindex="-1" href="#两种方案对比"><span class="icon icon-link"></span></a>两种方案对比</h2>
<table>
<thead>
<tr>
<th>特性</th>
<th>pnpm 自带机制</th>
<th>Corepack</th>
</tr>
</thead>
<tbody>
<tr>
<td>支持版本</td>
<td>要求 pnpm 10.x+</td>
<td>适用于 Node.js v16.9.0+</td>
</tr>
<tr>
<td>启用方式</td>
<td>默认开启，可通过配置关闭</td>
<td>需手动启用</td>
</tr>
<tr>
<td>配置方式</td>
<td><code>packageManager</code> 字段 + <code>managePackageManagerVersions</code> 配置</td>
<td>仅需 <code>packageManager</code> 字段</td>
</tr>
<tr>
<td>工作原理</td>
<td>pnpm 自身检测并切换版本</td>
<td>Node.js 层面拦截并管理包管理器调用</td>
</tr>
<tr>
<td>全局配置</td>
<td>通过 pnpm config 设置</td>
<td>一次启用全局生效</td>
</tr>
<tr>
<td>支持的包管理器</td>
<td>仅 pnpm</td>
<td>支持多种包管理器(yarn、pnpm、npm)</td>
</tr>
<tr>
<td>离线支持</td>
<td>需要网络下载</td>
<td>可预先准备版本供离线使用</td>
</tr>
</tbody>
</table>
<h2 id="使用建议"><a aria-hidden="true" tabindex="-1" href="#使用建议"><span class="icon icon-link"></span></a>使用建议</h2>
<ol>
<li>
<p><strong>新项目推荐</strong>:</p>
<ul>
<li>如果使用 Node.js v16.9.0+，推荐使用 Corepack，特别是多项目使用不同包管理器的环境。</li>
<li>使用 pnpm 10+ 的项目，两种方案都可以，但 pnpm 自带机制配置更简单。</li>
</ul>
</li>
<li>
<p><strong>CI 环境</strong>:</p>
<ul>
<li>Corepack 在 CI 环境中更加可靠，因为它是 Node.js 级别的管理。</li>
<li>对于只使用 pnpm 的团队，pnpm 自带机制也足够。</li>
</ul>
</li>
<li>
<p><strong>团队统一</strong>:</p>
<ul>
<li>无论选择哪种方案，团队应统一使用同一种机制以避免混淆。</li>
<li>记录在项目文档中使用的是哪种版本管理方式。</li>
</ul>
</li>
</ol>
<h2 id="实践注意事项"><a aria-hidden="true" tabindex="-1" href="#实践注意事项"><span class="icon icon-link"></span></a>实践注意事项</h2>
<ol>
<li>Corepack 需要一次性启用，之后所有项目都会受益。</li>
<li>pnpm 自带机制需要确保开发者使用 pnpm 10+。</li>
</ol>7:["$","article",null,{"children":[["$","div",null,{"className":"flex justify-center font-[Arial] max-w-[864px] text-center","children":["$","h1",null,{"className":"text-[2.5rem] font-bold bg-lime-300 px-5 py-2 rounded-sm text-shadow-lg leading-[1.1]","children":"pnpm 包管理器版本自动切换机制"}]}],["$","div",null,{"className":"flex flex-wrap items-center gap-4 mb-6","children":[["$","time",null,{"dateTime":"2025-05-15","className":"text-center block my-4 text-sm opacity-60","children":"May\t15, 2025"}],["$","span",null,{"className":"px-3 py-1 text-sm rounded bg-gray-100 dark:bg-gray-800","children":"blog"}],"$undefined"]}],[null,["$","$L17",null,{"theme":"fancy"}],["$","section",null,{"className":"markdown-body-fancy max-w-3xl","dangerouslySetInnerHTML":{"__html":"$18"}}]],null]}]
11:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
b:null
16:{"metadata":[["$","title","0",{"children":"Ai.Haibara codes"}],["$","meta","1",{"name":"description","content":"LZS Blog"}],["$","link","2",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"96x96"}]],"error":null,"digest":"$undefined"}
e:{"metadata":"$16:metadata","error":null,"digest":"$undefined"}
