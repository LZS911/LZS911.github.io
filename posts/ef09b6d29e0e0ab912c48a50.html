<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/60adccb42f39203c.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/c7f6e508dc13ee25.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-9cdb0b2d6ee94dc8.js"/><script src="/_next/static/chunks/4bd1b696-c9bd88c3e79a40cd.js" async=""></script><script src="/_next/static/chunks/684-ea7b2db13f3dd55b.js" async=""></script><script src="/_next/static/chunks/main-app-8a63285bca825cb3.js" async=""></script><script src="/_next/static/chunks/874-90f68e0a3827b559.js" async=""></script><script src="/_next/static/chunks/app/error-d036ecfd03716e30.js" async=""></script><script src="/_next/static/chunks/app/not-found-2113bbd7a2f55e8f.js" async=""></script><script src="/_next/static/chunks/app/loading-b73dd9bd22c3caa2.js" async=""></script><script src="/_next/static/chunks/296-93bf38127a29d878.js" async=""></script><script src="/_next/static/chunks/766-3404ce8492c1c2aa.js" async=""></script><script src="/_next/static/chunks/846-5073d6248f7e4d01.js" async=""></script><script src="/_next/static/chunks/app/(article)/layout-0113e097a12c4d28.js" async=""></script><script src="/_next/static/chunks/app/(article)/posts/%5Bslug%5D/page-15870e626cfa21a8.js" async=""></script><meta name="next-size-adjust" content=""/><title>Ai.Haibara codes</title><meta name="description" content="LZS Blog"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="96x96"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_5cfdac __variable_9a8899 antialiased"><!--$--><html lang="en"><body class="__variable_5cfdac __variable_9a8899 antialiased"><div class="min-h-screen"><header class="text-white bg-black drop-shadow-2xl"><div class="mx-auto my-0 max-w-[960px] py-6 px-4 flex items-center"><div class="flex items-center"><img alt="Ai.Haibara" loading="lazy" width="100" height="100" decoding="async" data-nimg="1" class=" rounded-full" style="color:transparent" srcSet="/_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=128&amp;q=75 1x, /_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=256&amp;q=75 2x" src="/_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=256&amp;q=75"/></div><div class="ml-6"><a class=" font-bold text-3xl" href="/">Ai.Haibara codes</a><div class="mt-2"><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/">Home</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/projects">Projects</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/talks">Talks</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/blogs">Blogs</a></div></div></div></header><main class="p-6 flex justify-center"><article><div class="flex justify-center font-[Arial] max-w-[864px] text-center"><h1 class="text-[2.5rem] font-bold bg-lime-300 px-5 py-2 rounded-sm text-shadow-lg leading-[1.1]">如何实现一个深拷贝?</h1></div><div class="flex flex-wrap items-center gap-4 mb-6"><time dateTime="2021-12-06" class="text-center block my-4 text-sm opacity-60">December	6, 2021</time><span class="px-3 py-1 text-sm rounded bg-gray-100 dark:bg-gray-800">blog</span><div class="flex flex-wrap gap-2"><a class="inline-block rounded transition-colors px-2 py-0.5 text-xs bg-blue-100 text-blue-800 hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800" href="/tags/javascript">javascript</a></div></div><section class="markdown-body-vuepress max-w-3xl"><h2 id="赋值浅拷贝"><a aria-hidden="true" tabindex="-1" href="#赋值浅拷贝"><span class="icon icon-link"></span></a>赋值、浅拷贝</h2>
<hr>
<p>首先, 我们来看一个概念性的问题, 赋值、浅拷贝、深拷贝之间有什么区别?</p>
<ol>
<li>
<p>赋值:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">bar</span>: <span class="hljs-string">'foo'</span> };
<span class="hljs-keyword">const</span> obj2 = obj;
obj2.<span class="hljs-property">bar</span> = <span class="hljs-string">'baz'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj); <span class="hljs-comment">//{ bar: 'baz' }</span>
</code></pre>
<p>当我们复制引用类型的变量时，实际上复制的是栈中存储的地址，所以复制出来的 <code>obj2</code> 实际上和 <code>obj</code> 指向的堆中同一个对象。因此， 我们改变其中任何一个变量的值，另一个变量都会受到影响，这就是为什么会有深拷贝和浅拷贝的原因。</p>
</li>
<li>
<p>浅拷贝:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> foo = { <span class="hljs-attr">name</span>: <span class="hljs-string">'foo'</span> };
<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">bar</span>: <span class="hljs-string">'str'</span>, <span class="hljs-attr">baz</span>: foo };
<span class="hljs-keyword">const</span> obj2 = { ...obj };
obj2.<span class="hljs-property">bar</span> = <span class="hljs-string">'number'</span>;
obj2.<span class="hljs-property">baz</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'foo2'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj); <span class="hljs-comment">//{ bar: 'str', baz: { name: 'foo2' } }</span>
</code></pre>
<p>创建一个新对象，这个对象有着原始对象属性值的一份精确拷贝。如果属性是基本类型，拷贝的就是基本类型的值，如果属性是引用类型，拷贝的就是内存地址 ，所以如果其中一个对象改变了这个地址，就会影响到另一个对象。</p>
</li>
</ol>
<p>讲个题外话: 值传递和引用传递</p>
<p>先看两段代码:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params">name</span>) {
  name = <span class="hljs-string">'foo'</span>;
}

<span class="hljs-keyword">const</span> bar = <span class="hljs-string">'bar'</span>;

<span class="hljs-title function_">setName</span>(bar);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bar); <span class="hljs-comment">//'bar'</span>
</code></pre>
<p>很明显，上面的执行结果是 <code>bar</code>，即函数参数仅仅是被传入变量赋值给了的一个局部变量，改变这个局部变量不会对外部变量产生影响.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params">obj</span>) {
  obj.<span class="hljs-property">name</span> = <span class="hljs-string">'foo'</span>;
}

<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">name</span>: <span class="hljs-string">'baz'</span> };

<span class="hljs-title function_">setName</span>(obj);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj); <span class="hljs-comment">//{name: 'foo'; }</span>
</code></pre>
<p>上面的代码可能让你产生疑惑，是不是参数是引用类型就是引用传递呢？</p>
<p>当函数参数是引用类型时，我们同样将参数复制了一个副本到局部变量，只不过复制的这个副本是指向堆内存中的地址而已，我们在函数内部对对象的属性进行操作，实际上和外部变量指向堆内存中的值相同，但是这并不代表着引用传递，下面我们再看一段代码:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> obj = {};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params">o</span>) {
  o.<span class="hljs-property">name</span> = <span class="hljs-string">'bar'</span>;
  o = { <span class="hljs-attr">name</span>: <span class="hljs-string">'baz'</span> };
}
<span class="hljs-title function_">setName</span>(obj);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj);
</code></pre>
<p>最后 输出为 <code>{name: 'bar'}</code>, 函数参数传递的并不是变量的引用，而是变量拷贝的副本，当变量是原始类型时，这个副本就是值本身，当变量是引用类型时，这个副本是指向堆内存的地址.</p>
<h2 id="深拷贝"><a aria-hidden="true" tabindex="-1" href="#深拷贝"><span class="icon icon-link"></span></a>深拷贝</h2>
<hr>
<p>回到主题, 来实现我们的深拷贝.</p>
<ol>
<li>
<p>乞丐版:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">deepClone</span> = (<span class="hljs-params">obj</span>) => <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));
</code></pre>
<p>最简易实现方式, 但对于值为 <code>function、undefined、symbol</code> 类型时无法处理</p>
</li>
<li>
<p>合格版</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">deepClone</span> = (<span class="hljs-params">source</span>) => {
  <span class="hljs-keyword">if</span> (source === <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
  <span class="hljs-keyword">if</span> (source === <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> source === <span class="hljs-string">'object'</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(source)) {
      <span class="hljs-keyword">const</span> clone = [];
      source.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =></span> {
        clone.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">deepClone</span>(v));
      });
      <span class="hljs-keyword">return</span> clone;
    }
    <span class="hljs-keyword">const</span> clone = {};
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(source).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =></span> {
      clone[key] = <span class="hljs-title function_">deepClone</span>(source[key]);
    });
    <span class="hljs-keyword">return</span> clone;
  }
  <span class="hljs-keyword">return</span> source;
};
</code></pre>
<p>能正确的处理 <code>function、undefined、symbol, array</code> 等类型, 但是当存在循环引用是, 会进入死循环.</p>
</li>
<li>
<p>较完整版</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">const</span> isArray = &#x3C;T>(<span class="hljs-attr">source</span>: <span class="hljs-built_in">unknown</span>): source is <span class="hljs-title class_">Array</span>&#x3C;T> =>
  <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(source);

<span class="hljs-keyword">const</span> isMap = (<span class="hljs-attr">source</span>: <span class="hljs-built_in">unknown</span>): source is <span class="hljs-title class_">Map</span> =>
  <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(source) === <span class="hljs-string">'[object Map]'</span>;

<span class="hljs-keyword">const</span> isSet = &#x3C;T>(<span class="hljs-attr">source</span>: <span class="hljs-built_in">unknown</span>): source is <span class="hljs-title class_">Set</span>&#x3C;T> =>
  <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(source) === <span class="hljs-string">'[object Set]'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">isObject</span> = (<span class="hljs-params"><span class="hljs-attr">source</span>: <span class="hljs-built_in">unknown</span></span>) => {
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">type</span> = <span class="hljs-keyword">typeof</span> source;
  <span class="hljs-keyword">return</span> source !== <span class="hljs-literal">null</span> &#x26;&#x26; <span class="hljs-keyword">type</span> === <span class="hljs-string">'object'</span>;
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">initData</span> = (<span class="hljs-params"><span class="hljs-attr">source</span>: <span class="hljs-built_in">any</span></span>) => {
  <span class="hljs-keyword">const</span> { constructor } = source;
  <span class="hljs-keyword">if</span> (!!constructor) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>);
  }
  <span class="hljs-keyword">return</span>;
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">deepClone</span> = (<span class="hljs-params"><span class="hljs-attr">source</span>: <span class="hljs-built_in">unknown</span>, map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>()</span>) => {
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isObject</span>(source)) {
    <span class="hljs-keyword">return</span> source;
  }
  <span class="hljs-keyword">const</span> clone = <span class="hljs-title function_">initData</span>(source);
  <span class="hljs-keyword">if</span> (!clone) {
    <span class="hljs-keyword">return</span> source;
  }
  <span class="hljs-keyword">if</span> (!!map.<span class="hljs-title function_">has</span>(source <span class="hljs-keyword">as</span> <span class="hljs-title class_">Object</span>)) {
    <span class="hljs-keyword">return</span> map.<span class="hljs-title function_">get</span>(source <span class="hljs-keyword">as</span> <span class="hljs-title class_">Object</span>);
  }
  map.<span class="hljs-title function_">set</span>(source <span class="hljs-keyword">as</span> <span class="hljs-title class_">Object</span>, clone);

  <span class="hljs-keyword">if</span> (isArray&#x3C;<span class="hljs-built_in">any</span>>(source)) {
    source.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =></span> {
      (clone <span class="hljs-keyword">as</span> <span class="hljs-title class_">Array</span>&#x3C;<span class="hljs-built_in">any</span>>).<span class="hljs-title function_">push</span>(<span class="hljs-title function_">deepClone</span>(v, map));
    });
    <span class="hljs-keyword">return</span> clone;
  }

  <span class="hljs-keyword">if</span> (isMap&#x3C;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>>(source)) {
    source.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">v, key</span>) =></span> {
      (clone <span class="hljs-keyword">as</span> <span class="hljs-title class_">Map</span>&#x3C;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>>).<span class="hljs-title function_">set</span>(key, <span class="hljs-title function_">deepClone</span>(v, map));
    });
    <span class="hljs-keyword">return</span> clone;
  }

  <span class="hljs-keyword">if</span> (isSet&#x3C;<span class="hljs-built_in">any</span>>(source)) {
    source.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =></span> {
      (clone <span class="hljs-keyword">as</span> <span class="hljs-title class_">Set</span>&#x3C;<span class="hljs-built_in">any</span>>).<span class="hljs-title function_">add</span>(<span class="hljs-title function_">deepClone</span>(v, map));
    });
    <span class="hljs-keyword">return</span> clone;
  }

  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(source <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =></span> {
    clone[v] = <span class="hljs-title function_">deepClone</span>((source <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[v], map);
  });
  <span class="hljs-keyword">return</span> clone;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> deepClone;
</code></pre>
</li>
</ol>
<p>解决循环引用问题，我们可以额外开辟一个存储空间，来存储当前对象和拷贝对象的对应关系，当需要拷贝当前对象时，先去存储空间中找，有没有拷贝过这个对象，如果有的话直接返回，如果没有的话继续拷贝，这样就巧妙化解的循环引用的问题。</p>
<p>这个存储空间，需要可以存储 <code>key-value</code> 形式的数据，且 <code>key</code> 可以是一个引用类型，我们可以选择 <code>WeakMap</code> 这种数据结构：
</p>
<ul>
<li>检查 <code>map</code> 中有无克隆过的对象</li>
<li>有 - 直接返回</li>
<li>没有 - 将当前对象作为 <code>key</code>，克隆对象作为 <code>value</code> 进行存储</li>
<li>继续克隆</li>
</ul>
<p>当然, 这里只考虑了 <code>Array</code> 、 <code>Object</code>、 <code>Map</code> 和 <code>Set</code> 四种可继续遍历类型, 还有其他类型, 这里不继续研究了...</p>
<h2 id="map-与-weakmap"><a aria-hidden="true" tabindex="-1" href="#map-与-weakmap"><span class="icon icon-link"></span></a><a href="https://es6.ruanyifeng.com/#docs/set-map#Map"><code>Map</code> 与 <code>WeakMap</code></a></h2>
<hr>
<p><code>Map</code> 是 <code>ES6</code> 中新增数据类型, 主要为了解决传统 <code>Object</code> 只能使用字符串作为键值, 并且不能够很方便的获取键的长度.</p>
<p><code>WeakMap</code> 与 <code>Map</code> 的区别有两点:</p>
<ol>
<li>
<p><code>WeakMap</code> 只接受对象作为键名（<code>null</code> 除外），不接受其他类型的值作为键名。</p>
</li>
<li>
<p><code>WeakMap</code> 的键名所指向的对象，不计入垃圾回收机制。</p>
</li>
</ol>
<p>利用第 2 点便不用担心当我们要拷贝的对象非常庞大时，使用 Map 会对内存造成非常大的额外消耗，而且我们需要手动清除 Map 的属性才能释放这块内存，而 WeakMap 会帮我们巧妙化解这个问题。</p>
<p>测试代码地址: <a href="https://github.com/LZS911/vue3-ts-vite2-ly-component/tree/master/src/utils/deepClone">https://github.com/LZS911/vue3-ts-vite2-ly-component/tree/master/src/utils/deepClone</a></p></section></article><!--$--><!--/$--><!--$--><!--/$--></main><footer class="bg-neutral-50 border-t border-neutral-200 text-center text-xs opacity-50 py-4">© 2022 - <!-- -->2025<a rel="noopener noreferrer" class="hover:underline hover:bg-indigo" href="https://github.com/LZS911" target="_blank">, LZS_911</a>, build with<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://nextjs.org/" target="_blank">Next.js</a> <!-- -->and<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://vercel.com/" target="_blank">Vercel</a></footer></div><!--/$--><script src="/_next/static/chunks/webpack-9cdb0b2d6ee94dc8.js" async=""></script></body></html><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7555,[],\"\"]\n3:I[1901,[\"874\",\"static/chunks/874-90f68e0a3827b559.js\",\"39\",\"static/chunks/app/error-d036ecfd03716e30.js\"],\"default\"]\n4:I[1295,[],\"\"]\n5:I[9543,[\"874\",\"static/chunks/874-90f68e0a3827b559.js\",\"345\",\"static/chunks/app/not-found-2113bbd7a2f55e8f.js\"],\"default\"]\n8:I[9665,[],\"MetadataBoundary\"]\na:I[9665,[],\"OutletBoundary\"]\nd:I[4911,[],\"AsyncMetadataOutlet\"]\nf:I[8460,[\"209\",\"static/chunks/app/loading-b73dd9bd22c3caa2.js\"],\"default\"]\n10:I[9665,[],\"ViewportBoundary\"]\n12:I[6614,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/60adccb42f39203c.css\",\"style\"]\n:HL[\"/_next/static/css/c7f6e508dc13ee25.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"fPyRDf3jU8EaKreMEXeMB\",\"p\":\"\",\"c\":[\"\",\"posts\",\"ef09b6d29e0e0ab912c48a50\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"(article)\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"ef09b6d29e0e0ab912c48a50\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/60adccb42f39203c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_5cfdac __variable_9a8899 antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$3\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"$L5\",null,{}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"(article)\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c7f6e508dc13ee25.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],\"$L6\"]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"ef09b6d29e0e0ab912c48a50\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],null,[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false]},[[\"$\",\"$Lf\",\"l\",{}],[],[]],false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"gFPoZV4PhWGQqqd9_Gv9Z\",{\"children\":[[\"$\",\"$L10\",null,{\"children\":\"$L11\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$12\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"13:I[2034,[\"874\",\"static/chunks/874-90f68e0a3827b559.js\",\"296\",\"static/chunks/296-93bf38127a29d878.js\",\"766\",\"static/chunks/766-3404ce8492c1c2aa.js\",\"846\",\"static/chunks/846-5073d6248f7e4d01.js\",\"651\",\"static/chunks/app/(article)/layout-0113e097a12c4d28.js\"],\"default\"]\n14:\"$Sreact.suspense\"\n15:I[4911,[],\"AsyncMetadata\"]\n6:[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_5cfdac __variable_9a8899 antialiased\",\"children\":[[\"$\",\"div\",null,{\"className\":\"min-h-screen\",\"children\":[[\"$\",\"$L13\",null,{}],[\"$\",\"main\",null,{\"className\":\"p-6 flex justify-center\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"bg-neutral-50 border-t border-neutral-200 text-center text-xs opacity-50 py-4\",\"children\":[\"© 2022 - \",2025,[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"hover:underline hover:bg-indigo\",\"href\":\"https://github.com/LZS911\",\"target\":\"_blank\",\"children\":\", LZS_911\"}],\", build with\",\" \",[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"underline hover:bg-indigo\",\"href\":\"https://nextjs.org/\",\"target\":\"_blank\",\"children\":\"Next.js\"}],\" \",\"and\",\" \",[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"underline hover:bg-indigo\",\"href\":\"https://vercel.com/\",\"target\":\"_blank\",\"children\":\"Vercel\"}]]}]]}],false]}]}]\n9:[\"$\",\"$14\",null,{\"fallback\":null,\"children\":[\"$\",\"$L15\",null,{\"promise\":\"$@16\"}]}]\n"])</script><script>self.__next_f.push([1,"c:null\n"])</script><script>self.__next_f.push([1,"17:I[6874,[\"874\",\"static/chunks/874-90f68e0a3827b559.js\",\"296\",\"static/chunks/296-93bf38127a29d878.js\",\"766\",\"static/chunks/766-3404ce8492c1c2aa.js\",\"520\",\"static/chunks/app/(article)/posts/%5Bslug%5D/page-15870e626cfa21a8.js\"],\"\"]\n18:I[5099,[\"874\",\"static/chunks/874-90f68e0a3827b559.js\",\"296\",\"static/chunks/296-93bf38127a29d878.js\",\"766\",\"static/chunks/766-3404ce8492c1c2aa.js\",\"520\",\"static/chunks/app/(article)/posts/%5Bslug%5D/page-15870e626cfa21a8.js\"],\"ThemeLoader\"]\n19:T3df7,"])</script><script>self.__next_f.push([1,"\u003ch2 id=\"赋值浅拷贝\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#赋值浅拷贝\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e赋值、浅拷贝\u003c/h2\u003e\n\u003chr\u003e\n\u003cp\u003e首先, 我们来看一个概念性的问题, 赋值、浅拷贝、深拷贝之间有什么区别?\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e赋值:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e obj = { \u003cspan class=\"hljs-attr\"\u003ebar\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'foo'\u003c/span\u003e };\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e obj2 = obj;\nobj2.\u003cspan class=\"hljs-property\"\u003ebar\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'baz'\u003c/span\u003e;\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(obj); \u003cspan class=\"hljs-comment\"\u003e//{ bar: 'baz' }\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e当我们复制引用类型的变量时，实际上复制的是栈中存储的地址，所以复制出来的 \u003ccode\u003eobj2\u003c/code\u003e 实际上和 \u003ccode\u003eobj\u003c/code\u003e 指向的堆中同一个对象。因此， 我们改变其中任何一个变量的值，另一个变量都会受到影响，这就是为什么会有深拷贝和浅拷贝的原因。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e浅拷贝:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e foo = { \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'foo'\u003c/span\u003e };\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e obj = { \u003cspan class=\"hljs-attr\"\u003ebar\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'str'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ebaz\u003c/span\u003e: foo };\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e obj2 = { ...obj };\nobj2.\u003cspan class=\"hljs-property\"\u003ebar\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'number'\u003c/span\u003e;\nobj2.\u003cspan class=\"hljs-property\"\u003ebaz\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'foo2'\u003c/span\u003e;\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(obj); \u003cspan class=\"hljs-comment\"\u003e//{ bar: 'str', baz: { name: 'foo2' } }\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e创建一个新对象，这个对象有着原始对象属性值的一份精确拷贝。如果属性是基本类型，拷贝的就是基本类型的值，如果属性是引用类型，拷贝的就是内存地址 ，所以如果其中一个对象改变了这个地址，就会影响到另一个对象。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e讲个题外话: 值传递和引用传递\u003c/p\u003e\n\u003cp\u003e先看两段代码:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esetName\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ename\u003c/span\u003e) {\n  name = \u003cspan class=\"hljs-string\"\u003e'foo'\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e bar = \u003cspan class=\"hljs-string\"\u003e'bar'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-title function_\"\u003esetName\u003c/span\u003e(bar);\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(bar); \u003cspan class=\"hljs-comment\"\u003e//'bar'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e很明显，上面的执行结果是 \u003ccode\u003ebar\u003c/code\u003e，即函数参数仅仅是被传入变量赋值给了的一个局部变量，改变这个局部变量不会对外部变量产生影响.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esetName\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eobj\u003c/span\u003e) {\n  obj.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'foo'\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e obj = { \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'baz'\u003c/span\u003e };\n\n\u003cspan class=\"hljs-title function_\"\u003esetName\u003c/span\u003e(obj);\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(obj); \u003cspan class=\"hljs-comment\"\u003e//{name: 'foo'; }\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e上面的代码可能让你产生疑惑，是不是参数是引用类型就是引用传递呢？\u003c/p\u003e\n\u003cp\u003e当函数参数是引用类型时，我们同样将参数复制了一个副本到局部变量，只不过复制的这个副本是指向堆内存中的地址而已，我们在函数内部对对象的属性进行操作，实际上和外部变量指向堆内存中的值相同，但是这并不代表着引用传递，下面我们再看一段代码:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e obj = {};\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esetName\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eo\u003c/span\u003e) {\n  o.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'bar'\u003c/span\u003e;\n  o = { \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'baz'\u003c/span\u003e };\n}\n\u003cspan class=\"hljs-title function_\"\u003esetName\u003c/span\u003e(obj);\n\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(obj);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最后 输出为 \u003ccode\u003e{name: 'bar'}\u003c/code\u003e, 函数参数传递的并不是变量的引用，而是变量拷贝的副本，当变量是原始类型时，这个副本就是值本身，当变量是引用类型时，这个副本是指向堆内存的地址.\u003c/p\u003e\n\u003ch2 id=\"深拷贝\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#深拷贝\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e深拷贝\u003c/h2\u003e\n\u003chr\u003e\n\u003cp\u003e回到主题, 来实现我们的深拷贝.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e乞丐版:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edeepClone\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003eobj\u003c/span\u003e) =\u003e \u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eparse\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estringify\u003c/span\u003e(obj));\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最简易实现方式, 但对于值为 \u003ccode\u003efunction、undefined、symbol\u003c/code\u003e 类型时无法处理\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e合格版\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edeepClone\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003esource\u003c/span\u003e) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (source === \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n  }\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (source === \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e;\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e source === \u003cspan class=\"hljs-string\"\u003e'object'\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-title class_\"\u003eArray\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eisArray\u003c/span\u003e(source)) {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e clone = [];\n      source.\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e) =\u003e\u003c/span\u003e {\n        clone.\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003edeepClone\u003c/span\u003e(v));\n      });\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e clone;\n    }\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e clone = {};\n    \u003cspan class=\"hljs-title class_\"\u003eObject\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ekeys\u003c/span\u003e(source).\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ekey\u003c/span\u003e) =\u003e\u003c/span\u003e {\n      clone[key] = \u003cspan class=\"hljs-title function_\"\u003edeepClone\u003c/span\u003e(source[key]);\n    });\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e clone;\n  }\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e source;\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e能正确的处理 \u003ccode\u003efunction、undefined、symbol, array\u003c/code\u003e 等类型, 但是当存在循环引用是, 会进入死循环.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e较完整版\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e isArray = \u0026#x3C;T\u003e(\u003cspan class=\"hljs-attr\"\u003esource\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eunknown\u003c/span\u003e): source is \u003cspan class=\"hljs-title class_\"\u003eArray\u003c/span\u003e\u0026#x3C;T\u003e =\u003e\n  \u003cspan class=\"hljs-title class_\"\u003eArray\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eisArray\u003c/span\u003e(source);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e isMap = (\u003cspan class=\"hljs-attr\"\u003esource\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eunknown\u003c/span\u003e): source is \u003cspan class=\"hljs-title class_\"\u003eMap\u003c/span\u003e =\u003e\n  \u003cspan class=\"hljs-title class_\"\u003eObject\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprototype\u003c/span\u003e\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003etoString\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecall\u003c/span\u003e(source) === \u003cspan class=\"hljs-string\"\u003e'[object Map]'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e isSet = \u0026#x3C;T\u003e(\u003cspan class=\"hljs-attr\"\u003esource\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eunknown\u003c/span\u003e): source is \u003cspan class=\"hljs-title class_\"\u003eSet\u003c/span\u003e\u0026#x3C;T\u003e =\u003e\n  \u003cspan class=\"hljs-title class_\"\u003eObject\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprototype\u003c/span\u003e\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003etoString\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecall\u003c/span\u003e(source) === \u003cspan class=\"hljs-string\"\u003e'[object Set]'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eisObject\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-attr\"\u003esource\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eunknown\u003c/span\u003e\u003c/span\u003e) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e source;\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e source !== \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e \u0026#x26;\u0026#x26; \u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e'object'\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003einitData\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-attr\"\u003esource\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u003c/span\u003e) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { constructor } = source;\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!!constructor) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e);\n  }\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edeepClone\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-attr\"\u003esource\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eunknown\u003c/span\u003e, map = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eWeakMap\u003c/span\u003e()\u003c/span\u003e) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-title function_\"\u003eisObject\u003c/span\u003e(source)) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e source;\n  }\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e clone = \u003cspan class=\"hljs-title function_\"\u003einitData\u003c/span\u003e(source);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!clone) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e source;\n  }\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!!map.\u003cspan class=\"hljs-title function_\"\u003ehas\u003c/span\u003e(source \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eObject\u003c/span\u003e)) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e map.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(source \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eObject\u003c/span\u003e);\n  }\n  map.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(source \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eObject\u003c/span\u003e, clone);\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (isArray\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u003e(source)) {\n    source.\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e) =\u003e\u003c/span\u003e {\n      (clone \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eArray\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u003e).\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003edeepClone\u003c/span\u003e(v, map));\n    });\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e clone;\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (isMap\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u003e(source)) {\n    source.\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev, key\u003c/span\u003e) =\u003e\u003c/span\u003e {\n      (clone \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMap\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u003e).\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(key, \u003cspan class=\"hljs-title function_\"\u003edeepClone\u003c/span\u003e(v, map));\n    });\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e clone;\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (isSet\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u003e(source)) {\n    source.\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e) =\u003e\u003c/span\u003e {\n      (clone \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSet\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e\u003e).\u003cspan class=\"hljs-title function_\"\u003eadd\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003edeepClone\u003c/span\u003e(v, map));\n    });\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e clone;\n  }\n\n  \u003cspan class=\"hljs-title class_\"\u003eObject\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ekeys\u003c/span\u003e(source \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    clone[v] = \u003cspan class=\"hljs-title function_\"\u003edeepClone\u003c/span\u003e((source \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e)[v], map);\n  });\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e clone;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e deepClone;\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e解决循环引用问题，我们可以额外开辟一个存储空间，来存储当前对象和拷贝对象的对应关系，当需要拷贝当前对象时，先去存储空间中找，有没有拷贝过这个对象，如果有的话直接返回，如果没有的话继续拷贝，这样就巧妙化解的循环引用的问题。\u003c/p\u003e\n\u003cp\u003e这个存储空间，需要可以存储 \u003ccode\u003ekey-value\u003c/code\u003e 形式的数据，且 \u003ccode\u003ekey\u003c/code\u003e 可以是一个引用类型，我们可以选择 \u003ccode\u003eWeakMap\u003c/code\u003e 这种数据结构：\n\b\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e检查 \u003ccode\u003emap\u003c/code\u003e 中有无克隆过的对象\u003c/li\u003e\n\u003cli\u003e有 - 直接返回\u003c/li\u003e\n\u003cli\u003e没有 - 将当前对象作为 \u003ccode\u003ekey\u003c/code\u003e，克隆对象作为 \u003ccode\u003evalue\u003c/code\u003e 进行存储\u003c/li\u003e\n\u003cli\u003e继续克隆\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e当然, 这里只考虑了 \u003ccode\u003eArray\u003c/code\u003e 、 \u003ccode\u003eObject\u003c/code\u003e、 \u003ccode\u003eMap\u003c/code\u003e 和 \u003ccode\u003eSet\u003c/code\u003e 四种可继续遍历类型, 还有其他类型, 这里不继续研究了...\u003c/p\u003e\n\u003ch2 id=\"map-与-weakmap\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#map-与-weakmap\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://es6.ruanyifeng.com/#docs/set-map#Map\"\u003e\u003ccode\u003eMap\u003c/code\u003e 与 \u003ccode\u003eWeakMap\u003c/code\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003chr\u003e\n\u003cp\u003e\u003ccode\u003eMap\u003c/code\u003e 是 \u003ccode\u003eES6\u003c/code\u003e 中新增数据类型, 主要为了解决传统 \u003ccode\u003eObject\u003c/code\u003e 只能使用字符串作为键值, 并且不能够很方便的获取键的长度.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eWeakMap\u003c/code\u003e 与 \u003ccode\u003eMap\u003c/code\u003e 的区别有两点:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eWeakMap\u003c/code\u003e 只接受对象作为键名（\u003ccode\u003enull\u003c/code\u003e 除外），不接受其他类型的值作为键名。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eWeakMap\u003c/code\u003e 的键名所指向的对象，不计入垃圾回收机制。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e利用第 2 点便不用担心当我们要拷贝的对象非常庞大时，使用 Map 会对内存造成非常大的额外消耗，而且我们需要手动清除 Map 的属性才能释放这块内存，而 WeakMap 会帮我们巧妙化解这个问题。\u003c/p\u003e\n\u003cp\u003e测试代码地址: \u003ca href=\"https://github.com/LZS911/vue3-ts-vite2-ly-component/tree/master/src/utils/deepClone\"\u003ehttps://github.com/LZS911/vue3-ts-vite2-ly-component/tree/master/src/utils/deepClone\u003c/a\u003e\u003c/p\u003e"])</script><script>self.__next_f.push([1,"7:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center font-[Arial] max-w-[864px] text-center\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-[2.5rem] font-bold bg-lime-300 px-5 py-2 rounded-sm text-shadow-lg leading-[1.1]\",\"children\":\"如何实现一个深拷贝?\"}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap items-center gap-4 mb-6\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2021-12-06\",\"className\":\"text-center block my-4 text-sm opacity-60\",\"children\":\"December\\t6, 2021\"}],[\"$\",\"span\",null,{\"className\":\"px-3 py-1 text-sm rounded bg-gray-100 dark:bg-gray-800\",\"children\":\"blog\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2\",\"children\":[[\"$\",\"$L17\",\"javascript\",{\"href\":\"/tags/javascript\",\"className\":\"inline-block rounded transition-colors px-2 py-0.5 text-xs bg-blue-100 text-blue-800 hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800\",\"children\":\"javascript\"}]]}]]}],[null,[\"$\",\"$L18\",null,{\"theme\":\"vuepress\"}],[\"$\",\"section\",null,{\"className\":\"markdown-body-vuepress max-w-3xl\",\"dangerouslySetInnerHTML\":{\"__html\":\"$19\"}}]],null]}]\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"16:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Ai.Haibara codes\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"LZS Blog\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"96x96\"}]],\"error\":null,\"digest\":\"$undefined\"}\ne:{\"metadata\":\"$16:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>