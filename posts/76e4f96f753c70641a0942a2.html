<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/60adccb42f39203c.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/c7f6e508dc13ee25.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-9cdb0b2d6ee94dc8.js"/><script src="/_next/static/chunks/4bd1b696-c9bd88c3e79a40cd.js" async=""></script><script src="/_next/static/chunks/684-ea7b2db13f3dd55b.js" async=""></script><script src="/_next/static/chunks/main-app-8a63285bca825cb3.js" async=""></script><script src="/_next/static/chunks/874-90f68e0a3827b559.js" async=""></script><script src="/_next/static/chunks/app/error-d036ecfd03716e30.js" async=""></script><script src="/_next/static/chunks/app/not-found-2113bbd7a2f55e8f.js" async=""></script><script src="/_next/static/chunks/app/loading-b73dd9bd22c3caa2.js" async=""></script><script src="/_next/static/chunks/296-93bf38127a29d878.js" async=""></script><script src="/_next/static/chunks/766-3404ce8492c1c2aa.js" async=""></script><script src="/_next/static/chunks/846-5073d6248f7e4d01.js" async=""></script><script src="/_next/static/chunks/app/(article)/layout-0113e097a12c4d28.js" async=""></script><script src="/_next/static/chunks/app/(article)/posts/%5Bslug%5D/page-15870e626cfa21a8.js" async=""></script><meta name="next-size-adjust" content=""/><title>Ai.Haibara codes</title><meta name="description" content="LZS Blog"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="96x96"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_5cfdac __variable_9a8899 antialiased"><!--$--><html lang="en"><body class="__variable_5cfdac __variable_9a8899 antialiased"><div class="min-h-screen"><header class="text-white bg-black drop-shadow-2xl"><div class="mx-auto my-0 max-w-[960px] py-6 px-4 flex items-center"><div class="flex items-center"><img alt="Ai.Haibara" loading="lazy" width="100" height="100" decoding="async" data-nimg="1" class=" rounded-full" style="color:transparent" srcSet="/_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=128&amp;q=75 1x, /_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=256&amp;q=75 2x" src="/_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=256&amp;q=75"/></div><div class="ml-6"><a class=" font-bold text-3xl" href="/">Ai.Haibara codes</a><div class="mt-2"><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/">Home</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/projects">Projects</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/talks">Talks</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/blogs">Blogs</a></div></div></div></header><main class="p-6 flex justify-center"><article><div class="flex justify-center font-[Arial] max-w-[864px] text-center"><h1 class="text-[2.5rem] font-bold bg-lime-300 px-5 py-2 rounded-sm text-shadow-lg leading-[1.1]">vite-plugin-conditional-compile</h1></div><div class="flex flex-wrap items-center gap-4 mb-6"><time dateTime="2022-12-01" class="text-center block my-4 text-sm opacity-60">December	1, 2022</time><span class="px-3 py-1 text-sm rounded bg-gray-100 dark:bg-gray-800">project</span><div class="flex flex-wrap gap-2"><a class="inline-block rounded transition-colors px-2 py-0.5 text-xs bg-blue-100 text-blue-800 hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800" href="/tags/null"></a></div></div><section class="markdown-body-fancy max-w-3xl"><blockquote>
<p>项目地址: <a href="https://www.npmjs.com/package/vite-plugin-conditional-compile">https://www.npmjs.com/package/vite-plugin-conditional-compile</a></p>
</blockquote>
<h2 id="功能特性"><a aria-hidden="true" tabindex="-1" href="#功能特性"><span class="icon icon-link"></span></a>功能特性</h2>
<ul>
<li>支持根据自定义的条件配置选择性地包含或排除代码块</li>
<li>可以在开发环境和生产环境中使用不同的代码逻辑</li>
<li>灵活的条件表达式，支持逻辑运算和环境变量</li>
<li>可以在 Vite 构建过程中动态生成不同的输出文件</li>
</ul>
<h2 id="安装"><a aria-hidden="true" tabindex="-1" href="#安装"><span class="icon icon-link"></span></a>安装</h2>
<pre><code class="hljs language-ssh">yarn add vite-plugin-conditional-compile -D
</code></pre>
<h2 id="使用"><a aria-hidden="true" tabindex="-1" href="#使用"><span class="icon icon-link"></span></a>使用</h2>
<blockquote>
<p>务必将该插件的加载顺序放在最前位，防止 jsx 之类的代码被其他插件编译，导致本插件无法解析</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite"</span>;
<span class="hljs-keyword">import</span> vitePluginConditionalCompile <span class="hljs-keyword">from</span> <span class="hljs-string">"vite-plugin-conditional-compile"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vitePluginConditionalCompile</span>({
      <span class="hljs-comment">// 插件配置项...</span>
    }),
    <span class="hljs-comment">// 其他插件...</span>
  ],
});
</code></pre>
<h2 id="配置项"><a aria-hidden="true" tabindex="-1" href="#配置项"><span class="icon icon-link"></span></a>配置项</h2>
<p>该插件支持以下配置项：</p>
<ol>
<li>
<p><code>include: string | RegExp | readonly (string | RegExp)[] | null</code>
需要进行条件编译的文件路径或文件匹配模式。</p>
<p>默认值: <code>['**/*']</code></p>
<p>示例：</p>
<pre><code class="hljs language-js">   {
     <span class="hljs-attr">include</span>: [<span class="hljs-regexp">/^.+\/packages\/.+\/.+.(ts|tsx)$/</span>],
   }
</code></pre>
</li>
<li>
<p><code>exclude: string | RegExp | readonly (string | RegExp)[] | null</code>
需要排除条件编译的文件路径或文件匹配模式。</p>
<p>默认值: <code>[/[\\/]node_modules[\\/]/, /[\\/]\.git[\\/]/]</code></p>
<p>示例：</p>
<pre><code class="hljs language-js">   {
      <span class="hljs-attr">exclude</span>: [<span class="hljs-string">'/\.eslintrc.js/'</span>]
   }
</code></pre>
</li>
<li>
<p><code>env: Record&#x3C;string, any></code>
自定义环境变量选项，用于在条件编译语句中使用自定义的环境变量。示例：</p>
<pre><code class="hljs language-javascript">{
  <span class="hljs-string">'MY_VARIABLE'</span>: <span class="hljs-string">'my value'</span>,
  <span class="hljs-comment">// 更多自定义环境变量...</span>
}
</code></pre>
<p>同时，本插件会调用 vite 提供的 <a href="https://vitejs.dev/guide/api-javascript.html#loadenv">loadEnv</a> 来获取项目的环境变量。</p>
</li>
</ol>
<h2 id="示例"><a aria-hidden="true" tabindex="-1" href="#示例"><span class="icon icon-link"></span></a>示例</h2>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite"</span>;
<span class="hljs-keyword">import</span> vitePluginConditionalCompile <span class="hljs-keyword">from</span> <span class="hljs-string">"vite-plugin-conditional-compile"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vitePluginConditionalCompile</span>({
      <span class="hljs-attr">env</span>:{
        <span class="hljs-comment">//自定义环境变量, 提供给条件语句使用</span>
        <span class="hljs-attr">feature</span>: <span class="hljs-string">'code'</span>,
        <span class="hljs-attr">prod_version</span>: <span class="hljs-string">'vite'</span>
      }
    }),
  ],
});


<span class="hljs-comment">// main.jsx</span>
<span class="hljs-comment">// #if [DEV]</span>
<span class="hljs-keyword">import</span> { featureA } <span class="hljs-keyword">from</span> <span class="hljs-string">'./featureA.js'</span>;

<span class="hljs-comment">// 这里的 PROD 取至 项目的环境变量, 若当前为生产环境时将加载此条 import 语句</span>
<span class="hljs-comment">// #elif [PROD]</span>
<span class="hljs-keyword">import</span> { featureB } <span class="hljs-keyword">from</span> <span class="hljs-string">'./featureB.js'</span>;

<span class="hljs-comment">//这里的 feature 和 prod_version 取至用户的 env 配置项, 判断 feature 的值是否与 ”code“ 相同、prod_version的值是否不等于 ”vite“. 当满足其中之一时, 该条件成立</span>
<span class="hljs-comment">// #elif [feature=code || !(prod_version=vite)]</span>
<span class="hljs-keyword">import</span> { featureC } <span class="hljs-keyword">from</span> <span class="hljs-string">'./featureC.js'</span>;

<span class="hljs-comment">// #else</span>
<span class="hljs-keyword">import</span> { featureD } <span class="hljs-keyword">from</span> <span class="hljs-string">'./featureD.js'</span>;

<span class="hljs-comment">// #endif</span>

<span class="hljs-comment">// #if [DEV]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Development environment'</span>);
<span class="hljs-comment">// #endif</span>

<span class="hljs-comment">// #if [PROD]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Production environment'</span>);
<span class="hljs-comment">// #endif</span>

<span class="hljs-comment">// #if [!!API_URL]</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">API_URL</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =></span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =></span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data));
<span class="hljs-comment">// #endif</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Com</span> = (<span class="hljs-params"></span>) => {
<span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span>></span>
      {/* #if [PROD] */}
      <span class="hljs-tag">&#x3C;<span class="hljs-name">span</span>></span>prod mode<span class="hljs-tag">&#x3C;/<span class="hljs-name">span</span>></span>
      {/* #elif [DEV] */}
      <span class="hljs-tag">&#x3C;<span class="hljs-name">span</span>></span>dev mode<span class="hljs-tag">&#x3C;/<span class="hljs-name">span</span>></span>
      {/*#else */}
      <span class="hljs-tag">&#x3C;<span class="hljs-name">span</span>></span>unknown mode<span class="hljs-tag">&#x3C;/<span class="hljs-name">span</span>></span>
      {/* #endif */}
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
  );
}
</code></pre>
<pre><code class="hljs language-vue">&#x3C;script setup lang="ts">
// #if [DEV]
import { featureA } from './featureA.js';
// #endif

&#x3C;/script>

&#x3C;template>

  &#x3C;!-- #if [DEV] -->
  &#x3C;router-link to="/debug">
    &#x3C;span class="m-2 text-green-500">demo&#x3C;/span>
  &#x3C;/router-link>

  &#x3C;!-- #elif [PROD] -->
 &#x3C;router-link to="/prod">
    &#x3C;span class="m-2 text-green-500">demo&#x3C;/span>
  &#x3C;/router-link>

  &#x3C;!-- #else -->
  &#x3C;router-link to="/helloWorld">
    &#x3C;span class="text-green-500">helloWorld&#x3C;/span>
  &#x3C;/router-link>
  &#x3C;!-- #endif -->

  &#x3C;router-view />
&#x3C;/template>
</code></pre>
<h2 id="支持的条件语句"><a aria-hidden="true" tabindex="-1" href="#支持的条件语句"><span class="icon icon-link"></span></a>支持的条件语句</h2>
<blockquote>
<p>注: 条件需要使用 [] 进行包裹</p>
</blockquote>
<ol>
<li>等式: <code>feature=code</code>、<code>prod_version=4.5.0</code> 等式右侧支持字符以及数字类型。</li>
<li>不等式: <code>prod_version != vite</code>。</li>
<li>逻辑语句: <code>feature=code || !(prod_version=vite)</code> 支持嵌套逻辑语句。</li>
<li>变量: <code>DEV</code> 判断 env['DEV'] 的值是否为 true。</li>
<li>取反符号: <code>!PROD</code> 判断 env['PROD'] 的值是否为 false，可以使用双重取反来模拟 #ifdef。</li>
</ol>
<h2 id="vs-code-插件"><a aria-hidden="true" tabindex="-1" href="#vs-code-插件"><span class="icon icon-link"></span></a>VS Code 插件</h2>
<p>后续将会支持 VS Code插件来高亮条件以及语法校验等功能。</p></section></article><!--$--><!--/$--><!--$--><!--/$--></main><footer class="bg-neutral-50 border-t border-neutral-200 text-center text-xs opacity-50 py-4">© 2022 - <!-- -->2025<a rel="noopener noreferrer" class="hover:underline hover:bg-indigo" href="https://github.com/LZS911" target="_blank">, LZS_911</a>, build with<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://nextjs.org/" target="_blank">Next.js</a> <!-- -->and<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://vercel.com/" target="_blank">Vercel</a></footer></div><!--/$--><script src="/_next/static/chunks/webpack-9cdb0b2d6ee94dc8.js" async=""></script></body></html><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7555,[],\"\"]\n3:I[1901,[\"874\",\"static/chunks/874-90f68e0a3827b559.js\",\"39\",\"static/chunks/app/error-d036ecfd03716e30.js\"],\"default\"]\n4:I[1295,[],\"\"]\n5:I[9543,[\"874\",\"static/chunks/874-90f68e0a3827b559.js\",\"345\",\"static/chunks/app/not-found-2113bbd7a2f55e8f.js\"],\"default\"]\n8:I[9665,[],\"MetadataBoundary\"]\na:I[9665,[],\"OutletBoundary\"]\nd:I[4911,[],\"AsyncMetadataOutlet\"]\nf:I[8460,[\"209\",\"static/chunks/app/loading-b73dd9bd22c3caa2.js\"],\"default\"]\n10:I[9665,[],\"ViewportBoundary\"]\n12:I[6614,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/60adccb42f39203c.css\",\"style\"]\n:HL[\"/_next/static/css/c7f6e508dc13ee25.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"fPyRDf3jU8EaKreMEXeMB\",\"p\":\"\",\"c\":[\"\",\"posts\",\"76e4f96f753c70641a0942a2\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"(article)\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"76e4f96f753c70641a0942a2\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/60adccb42f39203c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_5cfdac __variable_9a8899 antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$3\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"$L5\",null,{}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"(article)\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c7f6e508dc13ee25.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],\"$L6\"]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"76e4f96f753c70641a0942a2\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],null,[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false]},[[\"$\",\"$Lf\",\"l\",{}],[],[]],false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"B88cWRxDT1l0xgAGSJIQc\",{\"children\":[[\"$\",\"$L10\",null,{\"children\":\"$L11\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$12\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"13:I[2034,[\"874\",\"static/chunks/874-90f68e0a3827b559.js\",\"296\",\"static/chunks/296-93bf38127a29d878.js\",\"766\",\"static/chunks/766-3404ce8492c1c2aa.js\",\"846\",\"static/chunks/846-5073d6248f7e4d01.js\",\"651\",\"static/chunks/app/(article)/layout-0113e097a12c4d28.js\"],\"default\"]\n14:\"$Sreact.suspense\"\n15:I[4911,[],\"AsyncMetadata\"]\n6:[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_5cfdac __variable_9a8899 antialiased\",\"children\":[[\"$\",\"div\",null,{\"className\":\"min-h-screen\",\"children\":[[\"$\",\"$L13\",null,{}],[\"$\",\"main\",null,{\"className\":\"p-6 flex justify-center\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"bg-neutral-50 border-t border-neutral-200 text-center text-xs opacity-50 py-4\",\"children\":[\"© 2022 - \",2025,[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"hover:underline hover:bg-indigo\",\"href\":\"https://github.com/LZS911\",\"target\":\"_blank\",\"children\":\", LZS_911\"}],\", build with\",\" \",[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"underline hover:bg-indigo\",\"href\":\"https://nextjs.org/\",\"target\":\"_blank\",\"children\":\"Next.js\"}],\" \",\"and\",\" \",[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"underline hover:bg-indigo\",\"href\":\"https://vercel.com/\",\"target\":\"_blank\",\"children\":\"Vercel\"}]]}]]}],false]}]}]\n9:[\"$\",\"$14\",null,{\"fallback\":null,\"children\":[\"$\",\"$L15\",null,{\"promise\":\"$@16\"}]}]\n"])</script><script>self.__next_f.push([1,"c:null\n"])</script><script>self.__next_f.push([1,"17:I[6874,[\"874\",\"static/chunks/874-90f68e0a3827b559.js\",\"296\",\"static/chunks/296-93bf38127a29d878.js\",\"766\",\"static/chunks/766-3404ce8492c1c2aa.js\",\"520\",\"static/chunks/app/(article)/posts/%5Bslug%5D/page-15870e626cfa21a8.js\"],\"\"]\n18:I[5099,[\"874\",\"static/chunks/874-90f68e0a3827b559.js\",\"296\",\"static/chunks/296-93bf38127a29d878.js\",\"766\",\"static/chunks/766-3404ce8492c1c2aa.js\",\"520\",\"static/chunks/app/(article)/posts/%5Bslug%5D/page-15870e626cfa21a8.js\"],\"ThemeLoader\"]\n19:T25de,"])</script><script>self.__next_f.push([1,"\u003cblockquote\u003e\n\u003cp\u003e项目地址: \u003ca href=\"https://www.npmjs.com/package/vite-plugin-conditional-compile\"\u003ehttps://www.npmjs.com/package/vite-plugin-conditional-compile\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"功能特性\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#功能特性\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e功能特性\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e支持根据自定义的条件配置选择性地包含或排除代码块\u003c/li\u003e\n\u003cli\u003e可以在开发环境和生产环境中使用不同的代码逻辑\u003c/li\u003e\n\u003cli\u003e灵活的条件表达式，支持逻辑运算和环境变量\u003c/li\u003e\n\u003cli\u003e可以在 Vite 构建过程中动态生成不同的输出文件\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"安装\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#安装\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e安装\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ssh\"\u003eyarn add vite-plugin-conditional-compile -D\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"使用\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#使用\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e使用\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e务必将该插件的加载顺序放在最前位，防止 jsx 之类的代码被其他插件编译，导致本插件无法解析\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// vite.config.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { defineConfig } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vite\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e vitePluginConditionalCompile \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vite-plugin-conditional-compile\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edefineConfig\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\u003cspan class=\"hljs-title function_\"\u003evitePluginConditionalCompile\u003c/span\u003e({\n      \u003cspan class=\"hljs-comment\"\u003e// 插件配置项...\u003c/span\u003e\n    }),\n    \u003cspan class=\"hljs-comment\"\u003e// 其他插件...\u003c/span\u003e\n  ],\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"配置项\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#配置项\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e配置项\u003c/h2\u003e\n\u003cp\u003e该插件支持以下配置项：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003einclude: string | RegExp | readonly (string | RegExp)[] | null\u003c/code\u003e\n需要进行条件编译的文件路径或文件匹配模式。\u003c/p\u003e\n\u003cp\u003e默认值: \u003ccode\u003e['**/*']\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e   {\n     \u003cspan class=\"hljs-attr\"\u003einclude\u003c/span\u003e: [\u003cspan class=\"hljs-regexp\"\u003e/^.+\\/packages\\/.+\\/.+.(ts|tsx)$/\u003c/span\u003e],\n   }\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eexclude: string | RegExp | readonly (string | RegExp)[] | null\u003c/code\u003e\n需要排除条件编译的文件路径或文件匹配模式。\u003c/p\u003e\n\u003cp\u003e默认值: \u003ccode\u003e[/[\\\\/]node_modules[\\\\/]/, /[\\\\/]\\.git[\\\\/]/]\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e   {\n      \u003cspan class=\"hljs-attr\"\u003eexclude\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'/\\.eslintrc.js/'\u003c/span\u003e]\n   }\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eenv: Record\u0026#x3C;string, any\u003e\u003c/code\u003e\n自定义环境变量选项，用于在条件编译语句中使用自定义的环境变量。示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e{\n  \u003cspan class=\"hljs-string\"\u003e'MY_VARIABLE'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'my value'\u003c/span\u003e,\n  \u003cspan class=\"hljs-comment\"\u003e// 更多自定义环境变量...\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e同时，本插件会调用 vite 提供的 \u003ca href=\"https://vitejs.dev/guide/api-javascript.html#loadenv\"\u003eloadEnv\u003c/a\u003e 来获取项目的环境变量。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"示例\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#示例\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e示例\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// vite.config.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { defineConfig } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vite\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e vitePluginConditionalCompile \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"vite-plugin-conditional-compile\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edefineConfig\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\u003cspan class=\"hljs-title function_\"\u003evitePluginConditionalCompile\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003eenv\u003c/span\u003e:{\n        \u003cspan class=\"hljs-comment\"\u003e//自定义环境变量, 提供给条件语句使用\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003efeature\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'code'\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eprod_version\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'vite'\u003c/span\u003e\n      }\n    }),\n  ],\n});\n\n\n\u003cspan class=\"hljs-comment\"\u003e// main.jsx\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// #if [DEV]\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { featureA } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./featureA.js'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 这里的 PROD 取至 项目的环境变量, 若当前为生产环境时将加载此条 import 语句\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// #elif [PROD]\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { featureB } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./featureB.js'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e//这里的 feature 和 prod_version 取至用户的 env 配置项, 判断 feature 的值是否与 ”code“ 相同、prod_version的值是否不等于 ”vite“. 当满足其中之一时, 该条件成立\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// #elif [feature=code || !(prod_version=vite)]\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { featureC } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./featureC.js'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// #else\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { featureD } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./featureD.js'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// #endif\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// #if [DEV]\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Development environment'\u003c/span\u003e);\n\u003cspan class=\"hljs-comment\"\u003e// #endif\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// #if [PROD]\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Production environment'\u003c/span\u003e);\n\u003cspan class=\"hljs-comment\"\u003e// #endif\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// #if [!!API_URL]\u003c/span\u003e\n\u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003emeta\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eAPI_URL\u003c/span\u003e)\n  .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eresponse\u003c/span\u003e =\u003e\u003c/span\u003e response.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e())\n  .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003edata\u003c/span\u003e =\u003e\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(data));\n\u003cspan class=\"hljs-comment\"\u003e// #endif\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eCom\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u003e {\n\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\n      {/* #if [PROD] */}\n      \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e\u003e\u003c/span\u003eprod mode\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e\u003e\u003c/span\u003e\n      {/* #elif [DEV] */}\n      \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e\u003e\u003c/span\u003edev mode\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e\u003e\u003c/span\u003e\n      {/*#else */}\n      \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e\u003e\u003c/span\u003eunknown mode\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003espan\u003c/span\u003e\u003e\u003c/span\u003e\n      {/* #endif */}\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-vue\"\u003e\u0026#x3C;script setup lang=\"ts\"\u003e\n// #if [DEV]\nimport { featureA } from './featureA.js';\n// #endif\n\n\u0026#x3C;/script\u003e\n\n\u0026#x3C;template\u003e\n\n  \u0026#x3C;!-- #if [DEV] --\u003e\n  \u0026#x3C;router-link to=\"/debug\"\u003e\n    \u0026#x3C;span class=\"m-2 text-green-500\"\u003edemo\u0026#x3C;/span\u003e\n  \u0026#x3C;/router-link\u003e\n\n  \u0026#x3C;!-- #elif [PROD] --\u003e\n \u0026#x3C;router-link to=\"/prod\"\u003e\n    \u0026#x3C;span class=\"m-2 text-green-500\"\u003edemo\u0026#x3C;/span\u003e\n  \u0026#x3C;/router-link\u003e\n\n  \u0026#x3C;!-- #else --\u003e\n  \u0026#x3C;router-link to=\"/helloWorld\"\u003e\n    \u0026#x3C;span class=\"text-green-500\"\u003ehelloWorld\u0026#x3C;/span\u003e\n  \u0026#x3C;/router-link\u003e\n  \u0026#x3C;!-- #endif --\u003e\n\n  \u0026#x3C;router-view /\u003e\n\u0026#x3C;/template\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"支持的条件语句\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#支持的条件语句\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e支持的条件语句\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注: 条件需要使用 [] 进行包裹\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003col\u003e\n\u003cli\u003e等式: \u003ccode\u003efeature=code\u003c/code\u003e、\u003ccode\u003eprod_version=4.5.0\u003c/code\u003e 等式右侧支持字符以及数字类型。\u003c/li\u003e\n\u003cli\u003e不等式: \u003ccode\u003eprod_version != vite\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e逻辑语句: \u003ccode\u003efeature=code || !(prod_version=vite)\u003c/code\u003e 支持嵌套逻辑语句。\u003c/li\u003e\n\u003cli\u003e变量: \u003ccode\u003eDEV\u003c/code\u003e 判断 env['DEV'] 的值是否为 true。\u003c/li\u003e\n\u003cli\u003e取反符号: \u003ccode\u003e!PROD\u003c/code\u003e 判断 env['PROD'] 的值是否为 false，可以使用双重取反来模拟 #ifdef。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"vs-code-插件\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#vs-code-插件\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eVS Code 插件\u003c/h2\u003e\n\u003cp\u003e后续将会支持 VS Code插件来高亮条件以及语法校验等功能。\u003c/p\u003e"])</script><script>self.__next_f.push([1,"7:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center font-[Arial] max-w-[864px] text-center\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-[2.5rem] font-bold bg-lime-300 px-5 py-2 rounded-sm text-shadow-lg leading-[1.1]\",\"children\":\"vite-plugin-conditional-compile\"}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap items-center gap-4 mb-6\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2022-12-01\",\"className\":\"text-center block my-4 text-sm opacity-60\",\"children\":\"December\\t1, 2022\"}],[\"$\",\"span\",null,{\"className\":\"px-3 py-1 text-sm rounded bg-gray-100 dark:bg-gray-800\",\"children\":\"project\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2\",\"children\":[[\"$\",\"$L17\",\"null\",{\"href\":\"/tags/null\",\"className\":\"inline-block rounded transition-colors px-2 py-0.5 text-xs bg-blue-100 text-blue-800 hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800\",\"children\":null}]]}]]}],[null,[\"$\",\"$L18\",null,{\"theme\":\"fancy\"}],[\"$\",\"section\",null,{\"className\":\"markdown-body-fancy max-w-3xl\",\"dangerouslySetInnerHTML\":{\"__html\":\"$19\"}}]],null]}]\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"16:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Ai.Haibara codes\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"LZS Blog\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"96x96\"}]],\"error\":null,\"digest\":\"$undefined\"}\ne:{\"metadata\":\"$16:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>