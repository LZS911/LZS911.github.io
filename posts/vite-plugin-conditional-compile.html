<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><title>vite-plugin-conditional-compile | Ai.Haibara codes</title><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/8681f744d5932be6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8681f744d5932be6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-3b5a00d5d7e8d93b.js" defer=""></script><script src="/_next/static/chunks/main-59a90320855f5cf5.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f46e289d7ac5e197.js" defer=""></script><script src="/_next/static/chunks/799-575b46febca3af7d.js" defer=""></script><script src="/_next/static/chunks/399-cac0cd8ed02bf02a.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-e2afa3a98c674f72.js" defer=""></script><script src="/_next/static/d505lWANAwEkY6DLPcxRp/_buildManifest.js" defer=""></script><script src="/_next/static/d505lWANAwEkY6DLPcxRp/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen"><header class="text-white bg-black drop-shadow-2xl"><div class="mx-auto my-0 max-w-[960px] py-6 px-4 flex items-center"><div class="flex items-center"><img alt="Ai.Haibara" src="/assets/blog/authors/haibara_2.jpg" width="100" height="100" decoding="async" data-nimg="1" class=" rounded-full" loading="lazy" style="color:transparent"/></div><div class="ml-6"><a class=" font-bold text-3xl" href="/">Ai.Haibara codes</a><div class="mt-2"><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-indigo" href="/">Home</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-indigo" href="/projects">Projects</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-indigo" href="/talks">Talks</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-indigo" href="/blogs">Blogs</a></div></div></div></header><main class="p-6 flex justify-center"><article><div class="flex justify-center font-[Arial] max-w-[864px] text-center"><h1 class="text-5xl font-bold bg-indigo px-5 py-2 rounded-sm text-shadow-lg leading-[1.1]">vite-plugin-conditional-compile</h1></div><time dateTime="2022-12-01" class="text-center block my-4 text-sm opacity-60">December	1, 2022</time><section><div class="markdown-body-fancy max-w-3xl"><blockquote>
<p>项目地址: <a href="https://www.npmjs.com/package/vite-plugin-conditional-compile">https://www.npmjs.com/package/vite-plugin-conditional-compile</a></p>
</blockquote>
<h2 id="功能特性"><a aria-hidden="true" tabindex="-1" href="#功能特性"><span class="icon icon-link"></span></a>功能特性</h2>
<ul>
<li>支持根据自定义的条件配置选择性地包含或排除代码块</li>
<li>可以在开发环境和生产环境中使用不同的代码逻辑</li>
<li>灵活的条件表达式，支持逻辑运算和环境变量</li>
<li>可以在 Vite 构建过程中动态生成不同的输出文件</li>
</ul>
<h2 id="安装"><a aria-hidden="true" tabindex="-1" href="#安装"><span class="icon icon-link"></span></a>安装</h2>
<pre><code class="language-ssh">yarn add vite-plugin-conditional-compile -D
</code></pre>
<h2 id="使用"><a aria-hidden="true" tabindex="-1" href="#使用"><span class="icon icon-link"></span></a>使用</h2>
<blockquote>
<p>务必将该插件的加载顺序放在最前位，防止 jsx 之类的代码被其他插件编译，导致本插件无法解析</p>
</blockquote>
<pre><code class="language-js">// vite.config.ts
import { defineConfig } from "vite";
import vitePluginConditionalCompile from "vite-plugin-conditional-compile";

export default defineConfig({
    plugins: [vitePluginConditionalCompile({
      // 插件配置项...
    }),
    // 其他插件...
  ],
});
</code></pre>
<h2 id="配置项"><a aria-hidden="true" tabindex="-1" href="#配置项"><span class="icon icon-link"></span></a>配置项</h2>
<p>该插件支持以下配置项：</p>
<ol>
<li>
<p><code>include: string | RegExp | readonly (string | RegExp)[] | null</code>
需要进行条件编译的文件路径或文件匹配模式。</p>
<p>默认值: <code>['**/*']</code></p>
<p>示例：</p>
<pre><code class="language-js">   {
     include: [/^.+\/packages\/.+\/.+.(ts|tsx)$/],
   }
</code></pre>
</li>
<li>
<p><code>exclude: string | RegExp | readonly (string | RegExp)[] | null</code>
需要排除条件编译的文件路径或文件匹配模式。</p>
<p>默认值: <code>[/[\\/]node_modules[\\/]/, /[\\/]\.git[\\/]/]</code></p>
<p>示例：</p>
<pre><code class="language-js">   {
      exclude: ['/\.eslintrc.js/']
   }
</code></pre>
</li>
<li>
<p><code>env: Record&#x3C;string, any></code>
自定义环境变量选项，用于在条件编译语句中使用自定义的环境变量。示例：</p>
<pre><code class="language-javascript">{
  'MY_VARIABLE': 'my value',
  // 更多自定义环境变量...
}
</code></pre>
<p>同时，本插件会调用 vite 提供的 <a href="https://vitejs.dev/guide/api-javascript.html#loadenv">loadEnv</a> 来获取项目的环境变量。</p>
</li>
</ol>
<h2 id="示例"><a aria-hidden="true" tabindex="-1" href="#示例"><span class="icon icon-link"></span></a>示例</h2>
<pre><code class="language-javascript">// vite.config.ts
import { defineConfig } from "vite";
import vitePluginConditionalCompile from "vite-plugin-conditional-compile";

export default defineConfig({
    plugins: [vitePluginConditionalCompile({
      env:{
        //自定义环境变量, 提供给条件语句使用
        feature: 'code',
        prod_version: 'vite'
      }
    }),
  ],
});


// main.jsx
// #if [DEV]
import { featureA } from './featureA.js';

// 这里的 PROD 取至 项目的环境变量, 若当前为生产环境时将加载此条 import 语句
// #elif [PROD]
import { featureB } from './featureB.js';

//这里的 feature 和 prod_version 取至用户的 env 配置项, 判断 feature 的值是否与 ”code“ 相同、prod_version的值是否不等于 ”vite“. 当满足其中之一时, 该条件成立
// #elif [feature=code || !(prod_version=vite)]
import { featureC } from './featureC.js';

// #else
import { featureD } from './featureD.js';

// #endif

// #if [DEV]
console.log('Development environment');
// #endif

// #if [PROD]
console.log('Production environment');
// #endif

// #if [!!API_URL]
fetch(import.meta.env.API_URL)
  .then(response => response.json())
  .then(data => console.log(data));
// #endif

const Com = () => {
return (
    &#x3C;div>
      {/* #if [PROD] */}
      &#x3C;span>prod mode&#x3C;/span>
      {/* #elif [DEV] */}
      &#x3C;span>dev mode&#x3C;/span>
      {/*#else */}
      &#x3C;span>unknown mode&#x3C;/span>
      {/* #endif */}
    &#x3C;/div>
  );
}
</code></pre>
<pre><code class="language-vue">&#x3C;script setup lang="ts">
// #if [DEV]
import { featureA } from './featureA.js';
// #endif

&#x3C;/script>

&#x3C;template>

  &#x3C;!-- #if [DEV] -->
  &#x3C;router-link to="/debug">
    &#x3C;span class="m-2 text-green-500">demo&#x3C;/span>
  &#x3C;/router-link>

  &#x3C;!-- #elif [PROD] -->
 &#x3C;router-link to="/prod">
    &#x3C;span class="m-2 text-green-500">demo&#x3C;/span>
  &#x3C;/router-link>

  &#x3C;!-- #else -->
  &#x3C;router-link to="/helloWorld">
    &#x3C;span class="text-green-500">helloWorld&#x3C;/span>
  &#x3C;/router-link>
  &#x3C;!-- #endif -->

  &#x3C;router-view />
&#x3C;/template>
</code></pre>
<h2 id="支持的条件语句"><a aria-hidden="true" tabindex="-1" href="#支持的条件语句"><span class="icon icon-link"></span></a>支持的条件语句</h2>
<blockquote>
<p>注: 条件需要使用 [] 进行包裹</p>
</blockquote>
<ol>
<li>等式: <code>feature=code</code>、<code>prod_version=4.5.0</code> 等式右侧支持字符以及数字类型。</li>
<li>不等式: <code>prod_version != vite</code>。</li>
<li>逻辑语句: <code>feature=code || !(prod_version=vite)</code> 支持嵌套逻辑语句。</li>
<li>变量: <code>DEV</code> 判断 env['DEV'] 的值是否为 true。</li>
<li>取反符号: <code>!PROD</code> 判断 env['PROD'] 的值是否为 false，可以使用双重取反来模拟 #ifdef。</li>
</ol>
<h2 id="vs-code-插件"><a aria-hidden="true" tabindex="-1" href="#vs-code-插件"><span class="icon icon-link"></span></a>VS Code 插件</h2>
<p>后续将会支持 VS Code插件来高亮条件以及语法校验等功能。</p></div></section></article></main><footer class="bg-neutral-50 border-t border-neutral-200 text-center text-xs opacity-50 py-4">© 2022,<!-- --> <a rel="noopener noreferrer" class="hover:underline hover:bg-indigo" href="https://github.com/LZS911" target="_blank">LZS_911</a>, build with<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://nextjs.org/" target="_blank">Next.js</a> <!-- -->and<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://pages.github.com/?(null)" target="_blank">GitHub Pages</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"vite-plugin-conditional-compile","date":"2022-12-01","slug":"vite-plugin-conditional-compile","author":"Ai.Haibara","content":"\u003cblockquote\u003e\n\u003cp\u003e项目地址: \u003ca href=\"https://www.npmjs.com/package/vite-plugin-conditional-compile\"\u003ehttps://www.npmjs.com/package/vite-plugin-conditional-compile\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"功能特性\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#功能特性\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e功能特性\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e支持根据自定义的条件配置选择性地包含或排除代码块\u003c/li\u003e\n\u003cli\u003e可以在开发环境和生产环境中使用不同的代码逻辑\u003c/li\u003e\n\u003cli\u003e灵活的条件表达式，支持逻辑运算和环境变量\u003c/li\u003e\n\u003cli\u003e可以在 Vite 构建过程中动态生成不同的输出文件\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"安装\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#安装\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e安装\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"language-ssh\"\u003eyarn add vite-plugin-conditional-compile -D\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"使用\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#使用\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e使用\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e务必将该插件的加载顺序放在最前位，防止 jsx 之类的代码被其他插件编译，导致本插件无法解析\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003e// vite.config.ts\nimport { defineConfig } from \"vite\";\nimport vitePluginConditionalCompile from \"vite-plugin-conditional-compile\";\n\nexport default defineConfig({\n    plugins: [vitePluginConditionalCompile({\n      // 插件配置项...\n    }),\n    // 其他插件...\n  ],\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"配置项\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#配置项\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e配置项\u003c/h2\u003e\n\u003cp\u003e该插件支持以下配置项：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003einclude: string | RegExp | readonly (string | RegExp)[] | null\u003c/code\u003e\n需要进行条件编译的文件路径或文件匹配模式。\u003c/p\u003e\n\u003cp\u003e默认值: \u003ccode\u003e['**/*']\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003e   {\n     include: [/^.+\\/packages\\/.+\\/.+.(ts|tsx)$/],\n   }\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eexclude: string | RegExp | readonly (string | RegExp)[] | null\u003c/code\u003e\n需要排除条件编译的文件路径或文件匹配模式。\u003c/p\u003e\n\u003cp\u003e默认值: \u003ccode\u003e[/[\\\\/]node_modules[\\\\/]/, /[\\\\/]\\.git[\\\\/]/]\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003e   {\n      exclude: ['/\\.eslintrc.js/']\n   }\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eenv: Record\u0026#x3C;string, any\u003e\u003c/code\u003e\n自定义环境变量选项，用于在条件编译语句中使用自定义的环境变量。示例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e{\n  'MY_VARIABLE': 'my value',\n  // 更多自定义环境变量...\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e同时，本插件会调用 vite 提供的 \u003ca href=\"https://vitejs.dev/guide/api-javascript.html#loadenv\"\u003eloadEnv\u003c/a\u003e 来获取项目的环境变量。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"示例\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#示例\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e示例\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// vite.config.ts\nimport { defineConfig } from \"vite\";\nimport vitePluginConditionalCompile from \"vite-plugin-conditional-compile\";\n\nexport default defineConfig({\n    plugins: [vitePluginConditionalCompile({\n      env:{\n        //自定义环境变量, 提供给条件语句使用\n        feature: 'code',\n        prod_version: 'vite'\n      }\n    }),\n  ],\n});\n\n\n// main.jsx\n// #if [DEV]\nimport { featureA } from './featureA.js';\n\n// 这里的 PROD 取至 项目的环境变量, 若当前为生产环境时将加载此条 import 语句\n// #elif [PROD]\nimport { featureB } from './featureB.js';\n\n//这里的 feature 和 prod_version 取至用户的 env 配置项, 判断 feature 的值是否与 ”code“ 相同、prod_version的值是否不等于 ”vite“. 当满足其中之一时, 该条件成立\n// #elif [feature=code || !(prod_version=vite)]\nimport { featureC } from './featureC.js';\n\n// #else\nimport { featureD } from './featureD.js';\n\n// #endif\n\n// #if [DEV]\nconsole.log('Development environment');\n// #endif\n\n// #if [PROD]\nconsole.log('Production environment');\n// #endif\n\n// #if [!!API_URL]\nfetch(import.meta.env.API_URL)\n  .then(response =\u003e response.json())\n  .then(data =\u003e console.log(data));\n// #endif\n\nconst Com = () =\u003e {\nreturn (\n    \u0026#x3C;div\u003e\n      {/* #if [PROD] */}\n      \u0026#x3C;span\u003eprod mode\u0026#x3C;/span\u003e\n      {/* #elif [DEV] */}\n      \u0026#x3C;span\u003edev mode\u0026#x3C;/span\u003e\n      {/*#else */}\n      \u0026#x3C;span\u003eunknown mode\u0026#x3C;/span\u003e\n      {/* #endif */}\n    \u0026#x3C;/div\u003e\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"language-vue\"\u003e\u0026#x3C;script setup lang=\"ts\"\u003e\n// #if [DEV]\nimport { featureA } from './featureA.js';\n// #endif\n\n\u0026#x3C;/script\u003e\n\n\u0026#x3C;template\u003e\n\n  \u0026#x3C;!-- #if [DEV] --\u003e\n  \u0026#x3C;router-link to=\"/debug\"\u003e\n    \u0026#x3C;span class=\"m-2 text-green-500\"\u003edemo\u0026#x3C;/span\u003e\n  \u0026#x3C;/router-link\u003e\n\n  \u0026#x3C;!-- #elif [PROD] --\u003e\n \u0026#x3C;router-link to=\"/prod\"\u003e\n    \u0026#x3C;span class=\"m-2 text-green-500\"\u003edemo\u0026#x3C;/span\u003e\n  \u0026#x3C;/router-link\u003e\n\n  \u0026#x3C;!-- #else --\u003e\n  \u0026#x3C;router-link to=\"/helloWorld\"\u003e\n    \u0026#x3C;span class=\"text-green-500\"\u003ehelloWorld\u0026#x3C;/span\u003e\n  \u0026#x3C;/router-link\u003e\n  \u0026#x3C;!-- #endif --\u003e\n\n  \u0026#x3C;router-view /\u003e\n\u0026#x3C;/template\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"支持的条件语句\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#支持的条件语句\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e支持的条件语句\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注: 条件需要使用 [] 进行包裹\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003col\u003e\n\u003cli\u003e等式: \u003ccode\u003efeature=code\u003c/code\u003e、\u003ccode\u003eprod_version=4.5.0\u003c/code\u003e 等式右侧支持字符以及数字类型。\u003c/li\u003e\n\u003cli\u003e不等式: \u003ccode\u003eprod_version != vite\u003c/code\u003e。\u003c/li\u003e\n\u003cli\u003e逻辑语句: \u003ccode\u003efeature=code || !(prod_version=vite)\u003c/code\u003e 支持嵌套逻辑语句。\u003c/li\u003e\n\u003cli\u003e变量: \u003ccode\u003eDEV\u003c/code\u003e 判断 env['DEV'] 的值是否为 true。\u003c/li\u003e\n\u003cli\u003e取反符号: \u003ccode\u003e!PROD\u003c/code\u003e 判断 env['PROD'] 的值是否为 false，可以使用双重取反来模拟 #ifdef。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"vs-code-插件\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#vs-code-插件\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eVS Code 插件\u003c/h2\u003e\n\u003cp\u003e后续将会支持 VS Code插件来高亮条件以及语法校验等功能。\u003c/p\u003e","ogImage":{"url":"/assets/blog/image/cover.jpg"},"coverImage":"/assets/blog/image/cover.jpg","tag":[null]}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"vite-plugin-conditional-compile"},"buildId":"d505lWANAwEkY6DLPcxRp","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>