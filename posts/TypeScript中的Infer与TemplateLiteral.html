<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/e948a5c1bf791e9e.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/36a97ca7ae61047e.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/cb28a8db79c7a247.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/90e48aee015d076a.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-648f2e7a4a2fdeb9.js"/><script src="/_next/static/chunks/4bd1b696-52a6696c08e3276c.js" async=""></script><script src="/_next/static/chunks/684-fccd6a9e046e86ac.js" async=""></script><script src="/_next/static/chunks/main-app-8a63285bca825cb3.js" async=""></script><script src="/_next/static/chunks/874-0197bf8342d89979.js" async=""></script><script src="/_next/static/chunks/766-28cafc2b8349fbd8.js" async=""></script><script src="/_next/static/chunks/app/layout-bb1da1aafb2c343b.js" async=""></script><script src="/_next/static/chunks/app/error-d036ecfd03716e30.js" async=""></script><script src="/_next/static/chunks/app/not-found-2113bbd7a2f55e8f.js" async=""></script><script src="/_next/static/chunks/app/loading-b73dd9bd22c3caa2.js" async=""></script><meta name="next-size-adjust" content=""/><title>Ai.Haibara codes</title><meta name="description" content="LZS Blog"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="96x96"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_4d318d __variable_ea5f4b antialiased"><div class="min-h-screen"><header class="text-white bg-black drop-shadow-2xl"><div class="mx-auto my-0 max-w-[960px] py-6 px-4 flex items-center"><div class="flex items-center"><img alt="Ai.Haibara" loading="lazy" width="100" height="100" decoding="async" data-nimg="1" class=" rounded-full" style="color:transparent" srcSet="/_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=128&amp;q=75 1x, /_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=256&amp;q=75 2x" src="/_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=256&amp;q=75"/></div><div class="ml-6"><a class=" font-bold text-3xl" href="/">Ai.Haibara codes</a><div class="mt-2"><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/">Home</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/projects">Projects</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/talks">Talks</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/blogs">Blogs</a></div></div></div></header><main class="p-6 flex justify-center"><!--$--><article><div class="flex justify-center font-[Arial] max-w-[864px] text-center"><h1 class="text-[2.5rem] font-bold bg-lime-300 px-5 py-2 rounded-sm text-shadow-lg leading-[1.1]">TypeScript中的 infer 与 TemplateLiteral</h1></div><time dateTime="2022-11-21" class="text-center block my-4 text-sm opacity-60">November	21, 2022</time><section class="markdown-body-fancy max-w-3xl"><h2 id="infer"><a aria-hidden="true" tabindex="-1" href="#infer"><span class="icon icon-link"></span></a>infer</h2>
<p>在介绍 infer 之前, 我们需要先了解一个前置知识点: extends, 也就是条件类型.</p>
<p>来自 Typescript 官网的介绍:</p>
<blockquote>
<p>大多数有效程序的核心是，我们必须依据输入做出一些决定。 JavaScript 程序也是如此，但是由于值可以很容易地被内省，这些决定也是基于输入的类型。 条件类型 有助于描述输入和输出类型之间的关系。</p>
</blockquote>
<pre><code class="hljs language-Typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-title function_">live</span>(): <span class="hljs-built_in">void</span>;
}
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-title function_">woof</span>(): <span class="hljs-built_in">void</span>;
}
 
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Example1</span> = <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> ? <span class="hljs-built_in">number</span> : <span class="hljs-built_in">string</span>;
        
<span class="hljs-comment">// type Example1 = number</span>
 
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Example2</span> = <span class="hljs-title class_">RegExp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> ? <span class="hljs-built_in">number</span> : <span class="hljs-built_in">string</span>;
        
<span class="hljs-comment">// type Example2 = string</span>
</code></pre>
<p>可以看到 extends 的用法与 javascript 中的三元表达式没有太多的区别. 接下来, 回到文章的主题 --- infer 关键字.</p>
<p>首先, 我们先来实现一个工具类型: <em>判断接受的泛型是否为一个函数, 如果是, 则返回函数的返回值类型, 否则返回它自己</em></p>
<pre><code class="hljs language-Typescript"><span class="hljs-keyword">type</span> f1 = <span class="hljs-function">() =></span> <span class="hljs-built_in">void</span>;
<span class="hljs-keyword">type</span> f2 = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">arg</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">arg2</span>: <span class="hljs-built_in">number</span></span>) =></span> <span class="hljs-built_in">number</span>;
<span class="hljs-keyword">type</span> f3 = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">arg</span>: <span class="hljs-built_in">number</span></span>) =></span> <span class="hljs-built_in">string</span>;
<span class="hljs-keyword">type</span> t4 = { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> };

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Example1</span>&#x3C;T> = T <span class="hljs-title function_">extends</span> (<span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">arg</span>: infer params</span>) =></span> infer <span class="hljs-title class_">ResultType</span>) ? <span class="hljs-title class_">ResultType</span> : T;
</code></pre>
<p><img src="/assets/infer_templateLiteral/example-1.png" alt="alt">
<img src="/assets/infer_templateLiteral/example-2.png" alt="alt">
<img src="/assets/infer_templateLiteral/example-3.png" alt="alt">
<img src="/assets/infer_templateLiteral/example-4.png" alt="alt"></p>
<p>在这里, 我们通过 infer 关键字引入了类型一个名为 ResultType 的新泛型类型变量, 或者可以理解为一个占位符, 当条件类型成立时, ResultType 会替换为满足条件类型时所需的类型, 在这个栗子中 ResultType 代表的是函数的返回类型, 也就完成了我们需要的工具类型.</p>
<p>同样, 我们也可以实现一个 <em>提取元组类型中最后一个元素的类型</em></p>
<pre><code class="hljs language-Typescript"><span class="hljs-keyword">type</span> lastArrType&#x3C;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">unknown</span>[]> = T <span class="hljs-keyword">extends</span> [
  ...infer rest,
  infer <span class="hljs-title class_">ResultType</span>
]
  ? <span class="hljs-title class_">ResultType</span>
  : <span class="hljs-built_in">never</span>;
</code></pre>
<p><img src="/assets/infer_templateLiteral/example-5.png" alt="alt"></p>
<h2 id="template-literal"><a aria-hidden="true" tabindex="-1" href="#template-literal"><span class="icon icon-link"></span></a>Template Literal</h2>
<p>我们先看下基础的字符串文字类型:</p>
<pre><code class="hljs language-Typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Demo</span> = <span class="hljs-string">'demo'</span>;
</code></pre>
<p>模版文字类型是建立在字符串文字类型上的, 举个栗子</p>
<pre><code class="hljs language-Typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Hello</span> = <span class="hljs-string">'hello'</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">HelloWorld</span> = <span class="hljs-string">`<span class="hljs-subst">${Hello}</span> world`</span>; <span class="hljs-comment">//type HelloWorld = "hello world"</span>
</code></pre>
<p>单从语法上来说, 也是和 javascript 中的模版字符串大同小异.</p>
<p>配合联合类型时, 会生成出每个联合成员可以表示的每个可能的字符串文字的集合.</p>
<pre><code class="hljs language-Typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">EmailLocaleIDs</span> = <span class="hljs-string">"welcome_email"</span> | <span class="hljs-string">"email_heading"</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FooterLocaleIDs</span> = <span class="hljs-string">"footer_title"</span> | <span class="hljs-string">"footer_sendoff"</span>;
</code></pre>
<p><img src="/assets/infer_templateLiteral/example-6.png" alt="alt"></p>
<h2 id="实践"><a aria-hidden="true" tabindex="-1" href="#实践"><span class="icon icon-link"></span></a>实践</h2>
<p>结合 infer 以及 Template Literal 实现一个类似 <code>String.replace</code> 的工具类型</p>
<pre><code class="hljs language-Typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReplaceStr</span>&#x3C;
  <span class="hljs-title class_">Str</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>,
  <span class="hljs-title class_">From</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>,
  <span class="hljs-title class_">To</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>
> = <span class="hljs-title class_">Str</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">${infer Prefix}</span><span class="hljs-subst">${From}</span><span class="hljs-subst">${infer Suffix}</span>`</span>
  ? <span class="hljs-string">`<span class="hljs-subst">${Prefix}</span><span class="hljs-subst">${To}</span><span class="hljs-subst">${Suffix}</span>`</span>
  : <span class="hljs-title class_">Str</span>;
</code></pre>
<p><img src="/assets/infer_templateLiteral/example-7.png" alt="alt"></p>
<p>对更多实践感兴趣的可以转到: <a href="https://lzs911.github.io/posts/Typescript%20%E4%BD%93%E6%93%8D%E7%BB%83%E4%B9%A0">https://lzs911.github.io/posts/Typescript%20%E4%BD%93%E6%93%8D%E7%BB%83%E4%B9%A0</a></p></section></article><!--$--><!--/$--><!--$--><!--/$--><!--/$--></main><footer class="bg-neutral-50 border-t border-neutral-200 text-center text-xs opacity-50 py-4">© 2022 - <!-- -->2025<a rel="noopener noreferrer" class="hover:underline hover:bg-indigo" href="https://github.com/LZS911" target="_blank">, LZS_911</a>, build with<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://nextjs.org/" target="_blank">Next.js</a> <!-- -->and<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://pages.github.com/?(null)" target="_blank">GitHub Pages</a></footer></div><script src="/_next/static/chunks/webpack-648f2e7a4a2fdeb9.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[996,[\"874\",\"static/chunks/874-0197bf8342d89979.js\",\"766\",\"static/chunks/766-28cafc2b8349fbd8.js\",\"177\",\"static/chunks/app/layout-bb1da1aafb2c343b.js\"],\"default\"]\n3:I[7555,[],\"\"]\n4:I[1901,[\"874\",\"static/chunks/874-0197bf8342d89979.js\",\"39\",\"static/chunks/app/error-d036ecfd03716e30.js\"],\"default\"]\n5:I[1295,[],\"\"]\n6:I[9543,[\"874\",\"static/chunks/874-0197bf8342d89979.js\",\"345\",\"static/chunks/app/not-found-2113bbd7a2f55e8f.js\"],\"default\"]\n8:I[9665,[],\"MetadataBoundary\"]\na:I[9665,[],\"OutletBoundary\"]\nd:I[4911,[],\"AsyncMetadataOutlet\"]\nf:I[8460,[\"209\",\"static/chunks/app/loading-b73dd9bd22c3caa2.js\"],\"default\"]\n10:I[9665,[],\"ViewportBoundary\"]\n12:I[6614,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/e948a5c1bf791e9e.css\",\"style\"]\n:HL[\"/_next/static/css/36a97ca7ae61047e.css\",\"style\"]\n:HL[\"/_next/static/css/cb28a8db79c7a247.css\",\"style\"]\n:HL[\"/_next/static/css/90e48aee015d076a.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"zqV1dHPRggiwu9nwtjnlM\",\"p\":\"\",\"c\":[\"\",\"posts\",\"TypeScript%E4%B8%AD%E7%9A%84Infer%E4%B8%8ETemplateLiteral\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"TypeScript%E4%B8%AD%E7%9A%84Infer%E4%B8%8ETemplateLiteral\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e948a5c1bf791e9e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_4d318d __variable_ea5f4b antialiased\",\"children\":[\"$\",\"div\",null,{\"className\":\"min-h-screen\",\"children\":[[\"$\",\"$L2\",null,{}],[\"$\",\"main\",null,{\"className\":\"p-6 flex justify-center\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$4\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"$L6\",null,{}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"bg-neutral-50 border-t border-neutral-200 text-center text-xs opacity-50 py-4\",\"children\":[\"© 2022 - \",2025,[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"hover:underline hover:bg-indigo\",\"href\":\"https://github.com/LZS911\",\"target\":\"_blank\",\"children\":\", LZS_911\"}],\", build with\",\" \",[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"underline hover:bg-indigo\",\"href\":\"https://nextjs.org/\",\"target\":\"_blank\",\"children\":\"Next.js\"}],\" \",\"and\",\" \",[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"underline hover:bg-indigo\",\"href\":\"https://pages.github.com/?(null)\",\"target\":\"_blank\",\"children\":\"GitHub Pages\"}]]}]]}]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"TypeScript%E4%B8%AD%E7%9A%84Infer%E4%B8%8ETemplateLiteral\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/36a97ca7ae61047e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cb28a8db79c7a247.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/90e48aee015d076a.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},[[\"$\",\"$Lf\",\"l\",{}],[],[]],false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"7vN8nQ_CXQrfnWS-dpFo6\",{\"children\":[[\"$\",\"$L10\",null,{\"children\":\"$L11\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$12\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"13:\"$Sreact.suspense\"\n14:I[4911,[],\"AsyncMetadata\"]\n9:[\"$\",\"$13\",null,{\"fallback\":null,\"children\":[\"$\",\"$L14\",null,{\"promise\":\"$@15\"}]}]\n"])</script><script>self.__next_f.push([1,"c:null\n"])</script><script>self.__next_f.push([1,"16:T1e77,"])</script><script>self.__next_f.push([1,"\u003ch2 id=\"infer\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#infer\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003einfer\u003c/h2\u003e\n\u003cp\u003e在介绍 infer 之前, 我们需要先了解一个前置知识点: extends, 也就是条件类型.\u003c/p\u003e\n\u003cp\u003e来自 Typescript 官网的介绍:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e大多数有效程序的核心是，我们必须依据输入做出一些决定。 JavaScript 程序也是如此，但是由于值可以很容易地被内省，这些决定也是基于输入的类型。 条件类型 有助于描述输入和输出类型之间的关系。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAnimal\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003elive\u003c/span\u003e(): \u003cspan class=\"hljs-built_in\"\u003evoid\u003c/span\u003e;\n}\n\u003cspan class=\"hljs-keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDog\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAnimal\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003ewoof\u003c/span\u003e(): \u003cspan class=\"hljs-built_in\"\u003evoid\u003c/span\u003e;\n}\n \n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eExample1\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eDog\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAnimal\u003c/span\u003e ? \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e : \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e;\n        \n\u003cspan class=\"hljs-comment\"\u003e// type Example1 = number\u003c/span\u003e\n \n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eExample2\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eRegExp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAnimal\u003c/span\u003e ? \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e : \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e;\n        \n\u003cspan class=\"hljs-comment\"\u003e// type Example2 = string\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可以看到 extends 的用法与 javascript 中的三元表达式没有太多的区别. 接下来, 回到文章的主题 --- infer 关键字.\u003c/p\u003e\n\u003cp\u003e首先, 我们先来实现一个工具类型: \u003cem\u003e判断接受的泛型是否为一个函数, 如果是, 则返回函数的返回值类型, 否则返回它自己\u003c/em\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e f1 = \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003evoid\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e f2 = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-attr\"\u003earg\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003earg2\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e) =\u003e\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e f3 = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-attr\"\u003earg\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e) =\u003e\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e t4 = { \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e };\n\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eExample1\u003c/span\u003e\u0026#x3C;T\u003e = T \u003cspan class=\"hljs-title function_\"\u003eextends\u003c/span\u003e (\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003e...\u003cspan class=\"hljs-attr\"\u003earg\u003c/span\u003e: infer params\u003c/span\u003e) =\u003e\u003c/span\u003e infer \u003cspan class=\"hljs-title class_\"\u003eResultType\u003c/span\u003e) ? \u003cspan class=\"hljs-title class_\"\u003eResultType\u003c/span\u003e : T;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/infer_templateLiteral/example-1.png\" alt=\"alt\"\u003e\n\u003cimg src=\"/assets/infer_templateLiteral/example-2.png\" alt=\"alt\"\u003e\n\u003cimg src=\"/assets/infer_templateLiteral/example-3.png\" alt=\"alt\"\u003e\n\u003cimg src=\"/assets/infer_templateLiteral/example-4.png\" alt=\"alt\"\u003e\u003c/p\u003e\n\u003cp\u003e在这里, 我们通过 infer 关键字引入了类型一个名为 ResultType 的新泛型类型变量, 或者可以理解为一个占位符, 当条件类型成立时, ResultType 会替换为满足条件类型时所需的类型, 在这个栗子中 ResultType 代表的是函数的返回类型, 也就完成了我们需要的工具类型.\u003c/p\u003e\n\u003cp\u003e同样, 我们也可以实现一个 \u003cem\u003e提取元组类型中最后一个元素的类型\u003c/em\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e lastArrType\u0026#x3C;T \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eunknown\u003c/span\u003e[]\u003e = T \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e [\n  ...infer rest,\n  infer \u003cspan class=\"hljs-title class_\"\u003eResultType\u003c/span\u003e\n]\n  ? \u003cspan class=\"hljs-title class_\"\u003eResultType\u003c/span\u003e\n  : \u003cspan class=\"hljs-built_in\"\u003enever\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/infer_templateLiteral/example-5.png\" alt=\"alt\"\u003e\u003c/p\u003e\n\u003ch2 id=\"template-literal\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#template-literal\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTemplate Literal\u003c/h2\u003e\n\u003cp\u003e我们先看下基础的字符串文字类型:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDemo\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'demo'\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e模版文字类型是建立在字符串文字类型上的, 举个栗子\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHello\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'hello'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHelloWorld\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${Hello}\u003c/span\u003e world`\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e//type HelloWorld = \"hello world\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e单从语法上来说, 也是和 javascript 中的模版字符串大同小异.\u003c/p\u003e\n\u003cp\u003e配合联合类型时, 会生成出每个联合成员可以表示的每个可能的字符串文字的集合.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eEmailLocaleIDs\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"welcome_email\"\u003c/span\u003e | \u003cspan class=\"hljs-string\"\u003e\"email_heading\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eFooterLocaleIDs\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"footer_title\"\u003c/span\u003e | \u003cspan class=\"hljs-string\"\u003e\"footer_sendoff\"\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/infer_templateLiteral/example-6.png\" alt=\"alt\"\u003e\u003c/p\u003e\n\u003ch2 id=\"实践\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#实践\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e实践\u003c/h2\u003e\n\u003cp\u003e结合 infer 以及 Template Literal 实现一个类似 \u003ccode\u003eString.replace\u003c/code\u003e 的工具类型\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReplaceStr\u003c/span\u003e\u0026#x3C;\n  \u003cspan class=\"hljs-title class_\"\u003eStr\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e,\n  \u003cspan class=\"hljs-title class_\"\u003eFrom\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e,\n  \u003cspan class=\"hljs-title class_\"\u003eTo\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e\n\u003e = \u003cspan class=\"hljs-title class_\"\u003eStr\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${infer Prefix}\u003c/span\u003e\u003cspan class=\"hljs-subst\"\u003e${From}\u003c/span\u003e\u003cspan class=\"hljs-subst\"\u003e${infer Suffix}\u003c/span\u003e`\u003c/span\u003e\n  ? \u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${Prefix}\u003c/span\u003e\u003cspan class=\"hljs-subst\"\u003e${To}\u003c/span\u003e\u003cspan class=\"hljs-subst\"\u003e${Suffix}\u003c/span\u003e`\u003c/span\u003e\n  : \u003cspan class=\"hljs-title class_\"\u003eStr\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/infer_templateLiteral/example-7.png\" alt=\"alt\"\u003e\u003c/p\u003e\n\u003cp\u003e对更多实践感兴趣的可以转到: \u003ca href=\"https://lzs911.github.io/posts/Typescript%20%E4%BD%93%E6%93%8D%E7%BB%83%E4%B9%A0\"\u003ehttps://lzs911.github.io/posts/Typescript%20%E4%BD%93%E6%93%8D%E7%BB%83%E4%B9%A0\u003c/a\u003e\u003c/p\u003e"])</script><script>self.__next_f.push([1,"7:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center font-[Arial] max-w-[864px] text-center\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-[2.5rem] font-bold bg-lime-300 px-5 py-2 rounded-sm text-shadow-lg leading-[1.1]\",\"children\":\"TypeScript中的 infer 与 TemplateLiteral\"}]}],[\"$\",\"time\",null,{\"dateTime\":\"2022-11-21\",\"className\":\"text-center block my-4 text-sm opacity-60\",\"children\":\"November\\t21, 2022\"}],[null,[\"$\",\"section\",null,{\"className\":\"markdown-body-fancy max-w-3xl\",\"dangerouslySetInnerHTML\":{\"__html\":\"$16\"}}]],null]}]\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"15:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Ai.Haibara codes\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"LZS Blog\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"96x96\"}]],\"error\":null,\"digest\":\"$undefined\"}\ne:{\"metadata\":\"$15:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>