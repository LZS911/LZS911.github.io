<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/e948a5c1bf791e9e.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/36a97ca7ae61047e.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/cb28a8db79c7a247.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/90e48aee015d076a.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-648f2e7a4a2fdeb9.js"/><script src="/_next/static/chunks/4bd1b696-52a6696c08e3276c.js" async=""></script><script src="/_next/static/chunks/684-fccd6a9e046e86ac.js" async=""></script><script src="/_next/static/chunks/main-app-8a63285bca825cb3.js" async=""></script><script src="/_next/static/chunks/874-0197bf8342d89979.js" async=""></script><script src="/_next/static/chunks/766-28cafc2b8349fbd8.js" async=""></script><script src="/_next/static/chunks/app/layout-bb1da1aafb2c343b.js" async=""></script><script src="/_next/static/chunks/app/error-d036ecfd03716e30.js" async=""></script><script src="/_next/static/chunks/app/not-found-2113bbd7a2f55e8f.js" async=""></script><script src="/_next/static/chunks/app/loading-b73dd9bd22c3caa2.js" async=""></script><meta name="next-size-adjust" content=""/><title>Ai.Haibara codes</title><meta name="description" content="LZS Blog"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="96x96"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_4d318d __variable_ea5f4b antialiased"><div class="min-h-screen"><header class="text-white bg-black drop-shadow-2xl"><div class="mx-auto my-0 max-w-[960px] py-6 px-4 flex items-center"><div class="flex items-center"><img alt="Ai.Haibara" loading="lazy" width="100" height="100" decoding="async" data-nimg="1" class=" rounded-full" style="color:transparent" srcSet="/_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=128&amp;q=75 1x, /_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=256&amp;q=75 2x" src="/_next/image?url=%2Fassets%2Fblog%2Fauthors%2Fhaibara_2.jpg&amp;w=256&amp;q=75"/></div><div class="ml-6"><a class=" font-bold text-3xl" href="/">Ai.Haibara codes</a><div class="mt-2"><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/">Home</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/projects">Projects</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/talks">Talks</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-lime-300" href="/blogs">Blogs</a></div></div></div></header><main class="p-6 flex justify-center"><!--$--><article><div class="flex justify-center font-[Arial] max-w-[864px] text-center"><h1 class="text-[2.5rem] font-bold bg-lime-300 px-5 py-2 rounded-sm text-shadow-lg leading-[1.1]">如何实现一个EventEmit?</h1></div><time dateTime="2022-09-07" class="text-center block my-4 text-sm opacity-60">September	7, 2022</time><section class="markdown-body-orange max-w-3xl"><h2 id="eventemit-简介"><a aria-hidden="true" tabindex="-1" href="#eventemit-简介"><span class="icon icon-link"></span></a>EventEmit 简介</h2>
<p><code>node.js</code> 所有的异步 <code>I/O</code> 操作在完成时都会发送一个事件到事件队列. 一个 <code>fs.readStream</code> 对象会在文件被打开的时候触发一个事件. 所有这些产生事件的对象都是 <code>events.EventEmitter</code> 的实例.</p>
<p><code>EventEmit</code> 是 <code>node.js</code> 内置模块 <code>events</code> 提供的一个 <code>class</code>, 在 <code>node.js</code> 环境中可以直接 <code>require</code> 后使用. 在 <code>web</code> 环境中我们可以使用第三方 <code>npm</code> 包或者原生的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget">EventTarget</a>. 当然, 也可以自己实现一个类似 <code>node.js</code> 的简易版本.</p>
<p>我们先来看下 <code>EventEmit</code> 的基本使用方法:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">EventEmitter</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node:events'</span>);

<span class="hljs-keyword">const</span> event = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();

<span class="hljs-keyword">const</span> <span class="hljs-title function_">fn</span> = (<span class="hljs-params"></span>) => {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'event 事件触发!'</span>);
};

<span class="hljs-comment">//为指定事件注册一个监听器</span>
event.<span class="hljs-title function_">addListener</span>(<span class="hljs-string">'event'</span>, fn);

<span class="hljs-comment">//触发监听器</span>
event.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'event'</span>);

<span class="hljs-comment">//移除监听器</span>
event.<span class="hljs-title function_">removeListener</span>(<span class="hljs-string">'event'</span>, fn);
</code></pre>
<p>其中, 当我们添加新的监听器时, <code>newListener</code> 事件会触发, <code>当监听器被移除时，removeListener</code> 事件被触发.</p>
<h3 id="实现的-api-介绍"><a aria-hidden="true" tabindex="-1" href="#实现的-api-介绍"><span class="icon icon-link"></span></a>实现的 Api 介绍</h3>
<ol>
<li>
<p><code>emitter.addListener(eventName, listener)</code> 为指定事件注册一个监听器，接受一个 <code>string</code> (或 <code>symbol</code>) 类型的 <code>eventName</code> 和一个回调函数. 返回值为 <code>EventEmit</code> 的实例, 以便链式调用.</p>
<ul>
<li><code>eventName</code> <code>&#x3C;string></code> | <code>&#x3C;symbol></code></li>
<li><code>listener</code> <code>&#x3C;Function></code></li>
<li><code>Returns</code> <code>&#x3C;EventEmit></code></li>
</ul>
</li>
<li>
<p><code>emitter.emit(eventName, [...args])</code> 同步调用为名为 <code>eventName</code> 的事件注册的每个监听器, 按照它们注册的顺序, 将提供的参数传递给每个侦听器, 如果存在该监听器, 则返回 <code>True</code>, 否则返回 <code>False</code></p>
<ul>
<li><code>eventName</code> <code>&#x3C;string></code> | <code>&#x3C;symbol></code></li>
<li><code>...args</code> <code>&#x3C;any></code></li>
<li><code>Returns</code> <code>&#x3C;boolean></code></li>
</ul>
</li>
<li>
<p><code>emitter.once(eventName, listener)</code> 和 <code>addListener</code> 类似, 但只触发一次, 随后便解除事件监听.</p>
</li>
<li>
<p><code>emitter.removeListener(eventName, listener)</code> 移除指定事件的某个监听回调.</p>
<ul>
<li><code>eventName</code> <code>&#x3C;string></code> | <code>&#x3C;symbol></code></li>
<li><code>listener</code> <code>&#x3C;Function></code></li>
<li><code>Returns</code> <code>&#x3C;EventEmit></code></li>
</ul>
</li>
<li>
<p><code>emitter.removeAllListeners([eventName])</code> 删除所有监听器, 或删除指定 <code>eventName</code> 的监听器.</p>
<ul>
<li><code>eventName</code> <code>&#x3C;string></code> | <code>&#x3C;symbol></code></li>
<li><code>Returns</code> <code>&#x3C;EventEmitter></code></li>
</ul>
</li>
<li>
<p><code>emitter.setMaxListeners(n)</code> 用于修改监听器的默认限制的数量. (默认大于 10 个监听回调时会产生警告)</p>
<ul>
<li><code>n</code> <code>&#x3C;integer></code></li>
<li><code>Returns</code> <code>&#x3C;EventEmitter></code></li>
</ul>
</li>
<li>
<p><code>emitter.getMaxListeners()</code> 获取限制监听器的数量</p>
</li>
<li>
<p><code>emitter.listeners(eventName)</code> 返回名为 <code>eventName</code> 的事件的监听器数组的副本.</p>
<ul>
<li><code>eventName</code> <code>&#x3C;string></code> | <code>&#x3C;symbol></code></li>
<li><code>Returns</code> <code>&#x3C;Function></code></li>
</ul>
</li>
<li>
<p><code>emitter.listenerCount(eventName)</code> 返回监听名为 <code>eventName</code> 的事件的监听器数量</p>
</li>
<li>
<p><code>emitter.on</code> <code>emitter.addListener</code>的别名函数</p>
</li>
<li>
<p><code>emitter.off</code> <code>emitter.removeListener</code>的别名函数</p>
</li>
</ol>
<h3 id="构造函数"><a aria-hidden="true" tabindex="-1" href="#构造函数"><span class="icon icon-link"></span></a>构造函数</h3>
<pre><code class="hljs language-javascript">  #maxListeners = <span class="hljs-number">10</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-variable language_">this</span>.#maxListeners = <span class="hljs-number">10</span>;
  }
</code></pre>
<p>其中 <code>listeners</code> 的结构如下:</p>
<pre><code class="hljs language-JSON"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"event1"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>f1<span class="hljs-punctuation">,</span>f2<span class="hljs-punctuation">,</span>f3<span class="hljs-punctuation">]</span>，
  <span class="hljs-attr">"event2"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>f4<span class="hljs-punctuation">,</span>f5<span class="hljs-punctuation">]</span>，
  ...
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="addlistener-方法"><a aria-hidden="true" tabindex="-1" href="#addlistener-方法"><span class="icon icon-link"></span></a>addListener 方法</h3>
<ol>
<li>
<p>判断该事件监听器数组是否初始化，若未初始化，则将 <code>listeners[event]</code> 初始化为数组，并加入监听器 <code>cb</code>, 并触发 <code>newListener</code> 事件.</p>
</li>
<li>
<p>判断该事件的监听器数量是否已超限，超限则报警告.</p>
</li>
<li>
<p>判断数组中是否已存在 <code>cb</code>, 不存在则添加，已存在则不做操作.</p>
</li>
<li>
<p>指定 <code>on</code> 等于 <code>addListener</code> 方法</p>
</li>
</ol>
<pre><code class="hljs language-javascript">  <span class="hljs-title function_">addListener</span>(<span class="hljs-params">eventName, cb</span>) {
    <span class="hljs-keyword">if</span> (
      !<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName || !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName])]
    ) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName] = [cb];
      <span class="hljs-keyword">if</span> (eventName !== <span class="hljs-string">"newListener"</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"newListener"</span>);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName].<span class="hljs-property">length</span> >= <span class="hljs-variable language_">this</span>.#maxListeners) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(
        <span class="hljs-string">"MaxListenersExceededWarning: Possible EventEmitter memory leak detected. %d event6 listeners added to [EventEmitter]. Use emitter.setMaxListeners() to increase limit"</span>,
        <span class="hljs-variable language_">this</span>.#maxListeners
      );
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName].<span class="hljs-title function_">push</span>(cb);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

</code></pre>
<h3 id="emit-方法"><a aria-hidden="true" tabindex="-1" href="#emit-方法"><span class="icon icon-link"></span></a>emit 方法</h3>
<p>遍历监听器,通过 <code>apply</code> 方法把上面得到的 <code>args</code> 参数传进去, 需要注意的是不要漏了返回值.</p>
<pre><code class="hljs language-javascript">  <span class="hljs-title function_">emit</span>(<span class="hljs-params">eventName, ...args</span>) {
    <span class="hljs-keyword">const</span> isExistEvent =
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName] &#x26;&#x26; <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName].<span class="hljs-property">length</span> > <span class="hljs-number">0</span>;

    <span class="hljs-keyword">if</span> (isExistEvent) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName].<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">cb</span>) =></span> {
        cb.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, args);
      });
    }
    <span class="hljs-keyword">return</span> isExistEvent;
  }
</code></pre>
<h3 id="removelistener-方法"><a aria-hidden="true" tabindex="-1" href="#removelistener-方法"><span class="icon icon-link"></span></a>removeListener 方法</h3>
<pre><code class="hljs language-javascript">  <span class="hljs-title function_">removeListener</span>(<span class="hljs-params">eventName, listener</span>) {
    <span class="hljs-keyword">const</span> index = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName] || []).<span class="hljs-title function_">indexOf</span>(listener);
    <span class="hljs-keyword">if</span> (index !== -<span class="hljs-number">1</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName].<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
      <span class="hljs-keyword">if</span> (eventName !== <span class="hljs-string">"removeListener"</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"removeListener"</span>);
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
</code></pre>
<h3 id="once-方法"><a aria-hidden="true" tabindex="-1" href="#once-方法"><span class="icon icon-link"></span></a>once 方法</h3>
<p><code>once</code> 方法是 <code>on</code> 方法和 <code>removeListener</code> 方法的结合：用 <code>on</code> 方法监听，在回调结束的最后位置，通过<code>removeListener</code> 删掉监听函数自身</p>
<pre><code class="hljs language-javascript">  <span class="hljs-title function_">once</span>(<span class="hljs-params">eventName, listener</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">fn</span> = (<span class="hljs-params">...args</span>) => {
      listener.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, args);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeListener</span>(eventName, fn);
    };
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">on</span>(eventName, fn);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
</code></pre>
<h3 id="removealllisteners-方法"><a aria-hidden="true" tabindex="-1" href="#removealllisteners-方法"><span class="icon icon-link"></span></a>removeAllListeners 方法</h3>
<pre><code class="hljs language-javascript">  <span class="hljs-title function_">removeAllListeners</span>(<span class="hljs-params">eventNames = []</span>) {
    <span class="hljs-keyword">if</span> (eventNames.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
    } <span class="hljs-keyword">else</span> {
      eventNames.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =></span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[v] = <span class="hljs-literal">null</span>;
      });
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
</code></pre>
<h3 id="setmaxlistenersgetmaxlistenerslistenercountonoff-方法"><a aria-hidden="true" tabindex="-1" href="#setmaxlistenersgetmaxlistenerslistenercountonoff-方法"><span class="icon icon-link"></span></a>setMaxListeners、getMaxListeners、listenerCount、on、off 方法</h3>
<pre><code class="hljs language-javascript">  <span class="hljs-title function_">setMaxListeners</span>(<span class="hljs-params">maxListeners</span>) {
    <span class="hljs-variable language_">this</span>.#maxListeners = maxListeners;
  }
  <span class="hljs-title function_">getMaxListeners</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#maxListeners;
  }
  <span class="hljs-title function_">listenerCount</span>(<span class="hljs-params">eventName</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName]?.<span class="hljs-property">length</span> ?? <span class="hljs-number">0</span>;
  }

  <span class="hljs-title class_">EventEmitter</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">on</span> = <span class="hljs-title class_">EventEmitter</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">addListener</span>;
  <span class="hljs-title class_">EventEmitter</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">off</span> = <span class="hljs-title class_">EventEmitter</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">removeListener</span>;
</code></pre>
<h4 id="完整代码地址-httpsgithubcomlzs911eventemit"><a aria-hidden="true" tabindex="-1" href="#完整代码地址-httpsgithubcomlzs911eventemit"><span class="icon icon-link"></span></a>完整代码地址: <a href="https://github.com/LZS911/EventEmit">https://github.com/LZS911/EventEmit</a></h4></section></article><!--$--><!--/$--><!--$--><!--/$--><!--/$--></main><footer class="bg-neutral-50 border-t border-neutral-200 text-center text-xs opacity-50 py-4">© 2022 - <!-- -->2025<a rel="noopener noreferrer" class="hover:underline hover:bg-indigo" href="https://github.com/LZS911" target="_blank">, LZS_911</a>, build with<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://nextjs.org/" target="_blank">Next.js</a> <!-- -->and<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://pages.github.com/?(null)" target="_blank">GitHub Pages</a></footer></div><script src="/_next/static/chunks/webpack-648f2e7a4a2fdeb9.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[996,[\"874\",\"static/chunks/874-0197bf8342d89979.js\",\"766\",\"static/chunks/766-28cafc2b8349fbd8.js\",\"177\",\"static/chunks/app/layout-bb1da1aafb2c343b.js\"],\"default\"]\n3:I[7555,[],\"\"]\n4:I[1901,[\"874\",\"static/chunks/874-0197bf8342d89979.js\",\"39\",\"static/chunks/app/error-d036ecfd03716e30.js\"],\"default\"]\n5:I[1295,[],\"\"]\n6:I[9543,[\"874\",\"static/chunks/874-0197bf8342d89979.js\",\"345\",\"static/chunks/app/not-found-2113bbd7a2f55e8f.js\"],\"default\"]\n8:I[9665,[],\"MetadataBoundary\"]\na:I[9665,[],\"OutletBoundary\"]\nd:I[4911,[],\"AsyncMetadataOutlet\"]\nf:I[8460,[\"209\",\"static/chunks/app/loading-b73dd9bd22c3caa2.js\"],\"default\"]\n10:I[9665,[],\"ViewportBoundary\"]\n12:I[6614,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/e948a5c1bf791e9e.css\",\"style\"]\n:HL[\"/_next/static/css/36a97ca7ae61047e.css\",\"style\"]\n:HL[\"/_next/static/css/cb28a8db79c7a247.css\",\"style\"]\n:HL[\"/_next/static/css/90e48aee015d076a.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"zqV1dHPRggiwu9nwtjnlM\",\"p\":\"\",\"c\":[\"\",\"posts\",\"%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8EventEmit\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8EventEmit\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e948a5c1bf791e9e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_4d318d __variable_ea5f4b antialiased\",\"children\":[\"$\",\"div\",null,{\"className\":\"min-h-screen\",\"children\":[[\"$\",\"$L2\",null,{}],[\"$\",\"main\",null,{\"className\":\"p-6 flex justify-center\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$4\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"$L6\",null,{}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"bg-neutral-50 border-t border-neutral-200 text-center text-xs opacity-50 py-4\",\"children\":[\"© 2022 - \",2025,[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"hover:underline hover:bg-indigo\",\"href\":\"https://github.com/LZS911\",\"target\":\"_blank\",\"children\":\", LZS_911\"}],\", build with\",\" \",[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"underline hover:bg-indigo\",\"href\":\"https://nextjs.org/\",\"target\":\"_blank\",\"children\":\"Next.js\"}],\" \",\"and\",\" \",[\"$\",\"a\",null,{\"rel\":\"noopener noreferrer\",\"className\":\"underline hover:bg-indigo\",\"href\":\"https://pages.github.com/?(null)\",\"target\":\"_blank\",\"children\":\"GitHub Pages\"}]]}]]}]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8EventEmit\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/36a97ca7ae61047e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cb28a8db79c7a247.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/90e48aee015d076a.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},[[\"$\",\"$Lf\",\"l\",{}],[],[]],false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"QpT3ilz3Oeq-XgVRN5AxB\",{\"children\":[[\"$\",\"$L10\",null,{\"children\":\"$L11\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$12\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"13:\"$Sreact.suspense\"\n14:I[4911,[],\"AsyncMetadata\"]\n9:[\"$\",\"$13\",null,{\"fallback\":null,\"children\":[\"$\",\"$L14\",null,{\"promise\":\"$@15\"}]}]\n"])</script><script>self.__next_f.push([1,"c:null\n"])</script><script>self.__next_f.push([1,"16:T3f4c,"])</script><script>self.__next_f.push([1,"\u003ch2 id=\"eventemit-简介\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#eventemit-简介\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eEventEmit 简介\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003enode.js\u003c/code\u003e 所有的异步 \u003ccode\u003eI/O\u003c/code\u003e 操作在完成时都会发送一个事件到事件队列. 一个 \u003ccode\u003efs.readStream\u003c/code\u003e 对象会在文件被打开的时候触发一个事件. 所有这些产生事件的对象都是 \u003ccode\u003eevents.EventEmitter\u003c/code\u003e 的实例.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eEventEmit\u003c/code\u003e 是 \u003ccode\u003enode.js\u003c/code\u003e 内置模块 \u003ccode\u003eevents\u003c/code\u003e 提供的一个 \u003ccode\u003eclass\u003c/code\u003e, 在 \u003ccode\u003enode.js\u003c/code\u003e 环境中可以直接 \u003ccode\u003erequire\u003c/code\u003e 后使用. 在 \u003ccode\u003eweb\u003c/code\u003e 环境中我们可以使用第三方 \u003ccode\u003enpm\u003c/code\u003e 包或者原生的 \u003ca href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget\"\u003eEventTarget\u003c/a\u003e. 当然, 也可以自己实现一个类似 \u003ccode\u003enode.js\u003c/code\u003e 的简易版本.\u003c/p\u003e\n\u003cp\u003e我们先来看下 \u003ccode\u003eEventEmit\u003c/code\u003e 的基本使用方法:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eEventEmitter\u003c/span\u003e } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'node:events'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e event = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eEventEmitter\u003c/span\u003e();\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efn\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u003e {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'event 事件触发!'\u003c/span\u003e);\n};\n\n\u003cspan class=\"hljs-comment\"\u003e//为指定事件注册一个监听器\u003c/span\u003e\nevent.\u003cspan class=\"hljs-title function_\"\u003eaddListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'event'\u003c/span\u003e, fn);\n\n\u003cspan class=\"hljs-comment\"\u003e//触发监听器\u003c/span\u003e\nevent.\u003cspan class=\"hljs-title function_\"\u003eemit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'event'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e//移除监听器\u003c/span\u003e\nevent.\u003cspan class=\"hljs-title function_\"\u003eremoveListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'event'\u003c/span\u003e, fn);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e其中, 当我们添加新的监听器时, \u003ccode\u003enewListener\u003c/code\u003e 事件会触发, \u003ccode\u003e当监听器被移除时，removeListener\u003c/code\u003e 事件被触发.\u003c/p\u003e\n\u003ch3 id=\"实现的-api-介绍\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#实现的-api-介绍\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e实现的 Api 介绍\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eemitter.addListener(eventName, listener)\u003c/code\u003e 为指定事件注册一个监听器，接受一个 \u003ccode\u003estring\u003c/code\u003e (或 \u003ccode\u003esymbol\u003c/code\u003e) 类型的 \u003ccode\u003eeventName\u003c/code\u003e 和一个回调函数. 返回值为 \u003ccode\u003eEventEmit\u003c/code\u003e 的实例, 以便链式调用.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eeventName\u003c/code\u003e \u003ccode\u003e\u0026#x3C;string\u003e\u003c/code\u003e | \u003ccode\u003e\u0026#x3C;symbol\u003e\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003elistener\u003c/code\u003e \u003ccode\u003e\u0026#x3C;Function\u003e\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReturns\u003c/code\u003e \u003ccode\u003e\u0026#x3C;EventEmit\u003e\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eemitter.emit(eventName, [...args])\u003c/code\u003e 同步调用为名为 \u003ccode\u003eeventName\u003c/code\u003e 的事件注册的每个监听器, 按照它们注册的顺序, 将提供的参数传递给每个侦听器, 如果存在该监听器, 则返回 \u003ccode\u003eTrue\u003c/code\u003e, 否则返回 \u003ccode\u003eFalse\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eeventName\u003c/code\u003e \u003ccode\u003e\u0026#x3C;string\u003e\u003c/code\u003e | \u003ccode\u003e\u0026#x3C;symbol\u003e\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e...args\u003c/code\u003e \u003ccode\u003e\u0026#x3C;any\u003e\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReturns\u003c/code\u003e \u003ccode\u003e\u0026#x3C;boolean\u003e\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eemitter.once(eventName, listener)\u003c/code\u003e 和 \u003ccode\u003eaddListener\u003c/code\u003e 类似, 但只触发一次, 随后便解除事件监听.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eemitter.removeListener(eventName, listener)\u003c/code\u003e 移除指定事件的某个监听回调.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eeventName\u003c/code\u003e \u003ccode\u003e\u0026#x3C;string\u003e\u003c/code\u003e | \u003ccode\u003e\u0026#x3C;symbol\u003e\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003elistener\u003c/code\u003e \u003ccode\u003e\u0026#x3C;Function\u003e\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReturns\u003c/code\u003e \u003ccode\u003e\u0026#x3C;EventEmit\u003e\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eemitter.removeAllListeners([eventName])\u003c/code\u003e 删除所有监听器, 或删除指定 \u003ccode\u003eeventName\u003c/code\u003e 的监听器.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eeventName\u003c/code\u003e \u003ccode\u003e\u0026#x3C;string\u003e\u003c/code\u003e | \u003ccode\u003e\u0026#x3C;symbol\u003e\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReturns\u003c/code\u003e \u003ccode\u003e\u0026#x3C;EventEmitter\u003e\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eemitter.setMaxListeners(n)\u003c/code\u003e 用于修改监听器的默认限制的数量. (默认大于 10 个监听回调时会产生警告)\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003en\u003c/code\u003e \u003ccode\u003e\u0026#x3C;integer\u003e\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReturns\u003c/code\u003e \u003ccode\u003e\u0026#x3C;EventEmitter\u003e\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eemitter.getMaxListeners()\u003c/code\u003e 获取限制监听器的数量\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eemitter.listeners(eventName)\u003c/code\u003e 返回名为 \u003ccode\u003eeventName\u003c/code\u003e 的事件的监听器数组的副本.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eeventName\u003c/code\u003e \u003ccode\u003e\u0026#x3C;string\u003e\u003c/code\u003e | \u003ccode\u003e\u0026#x3C;symbol\u003e\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReturns\u003c/code\u003e \u003ccode\u003e\u0026#x3C;Function\u003e\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eemitter.listenerCount(eventName)\u003c/code\u003e 返回监听名为 \u003ccode\u003eeventName\u003c/code\u003e 的事件的监听器数量\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eemitter.on\u003c/code\u003e \u003ccode\u003eemitter.addListener\u003c/code\u003e的别名函数\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eemitter.off\u003c/code\u003e \u003ccode\u003eemitter.removeListener\u003c/code\u003e的别名函数\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"构造函数\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#构造函数\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e构造函数\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e  #maxListeners = \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e;\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eObject\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreate\u003c/span\u003e(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e);\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.#maxListeners = \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e;\n  }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e其中 \u003ccode\u003elisteners\u003c/code\u003e 的结构如下:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-JSON\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"event1\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003ef1\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003ef2\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003ef3\u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e，\n  \u003cspan class=\"hljs-attr\"\u003e\"event2\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003ef4\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003ef5\u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e，\n  ...\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"addlistener-方法\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#addlistener-方法\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eaddListener 方法\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e判断该事件监听器数组是否初始化，若未初始化，则将 \u003ccode\u003elisteners[event]\u003c/code\u003e 初始化为数组，并加入监听器 \u003ccode\u003ecb\u003c/code\u003e, 并触发 \u003ccode\u003enewListener\u003c/code\u003e 事件.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e判断该事件的监听器数量是否已超限，超限则报警告.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e判断数组中是否已存在 \u003ccode\u003ecb\u003c/code\u003e, 不存在则添加，已存在则不做操作.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e指定 \u003ccode\u003eon\u003c/code\u003e 等于 \u003ccode\u003eaddListener\u003c/code\u003e 方法\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e  \u003cspan class=\"hljs-title function_\"\u003eaddListener\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eeventName, cb\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\n      !\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[eventName || !\u003cspan class=\"hljs-title class_\"\u003eArray\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eisArray\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[eventName])]\n    ) {\n      \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[eventName] = [cb];\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (eventName !== \u003cspan class=\"hljs-string\"\u003e\"newListener\"\u003c/span\u003e) {\n        \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eemit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"newListener\"\u003c/span\u003e);\n      }\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e;\n    }\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[eventName].\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e \u003e= \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.#maxListeners) {\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(\n        \u003cspan class=\"hljs-string\"\u003e\"MaxListenersExceededWarning: Possible EventEmitter memory leak detected. %d event6 listeners added to [EventEmitter]. Use emitter.setMaxListeners() to increase limit\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.#maxListeners\n      );\n    }\n\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[eventName].\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e(cb);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e;\n  }\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"emit-方法\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#emit-方法\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eemit 方法\u003c/h3\u003e\n\u003cp\u003e遍历监听器,通过 \u003ccode\u003eapply\u003c/code\u003e 方法把上面得到的 \u003ccode\u003eargs\u003c/code\u003e 参数传进去, 需要注意的是不要漏了返回值.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e  \u003cspan class=\"hljs-title function_\"\u003eemit\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eeventName, ...args\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e isExistEvent =\n      \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[eventName] \u0026#x26;\u0026#x26; \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[eventName].\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e \u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (isExistEvent) {\n      \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[eventName].\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ecb\u003c/span\u003e) =\u003e\u003c/span\u003e {\n        cb.\u003cspan class=\"hljs-title function_\"\u003eapply\u003c/span\u003e(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, args);\n      });\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e isExistEvent;\n  }\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"removelistener-方法\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#removelistener-方法\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eremoveListener 方法\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e  \u003cspan class=\"hljs-title function_\"\u003eremoveListener\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eeventName, listener\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e index = (\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[eventName] || []).\u003cspan class=\"hljs-title function_\"\u003eindexOf\u003c/span\u003e(listener);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (index !== -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) {\n      \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[eventName].\u003cspan class=\"hljs-title function_\"\u003esplice\u003c/span\u003e(index, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (eventName !== \u003cspan class=\"hljs-string\"\u003e\"removeListener\"\u003c/span\u003e) {\n        \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eemit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"removeListener\"\u003c/span\u003e);\n      }\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e;\n  }\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"once-方法\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#once-方法\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eonce 方法\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eonce\u003c/code\u003e 方法是 \u003ccode\u003eon\u003c/code\u003e 方法和 \u003ccode\u003eremoveListener\u003c/code\u003e 方法的结合：用 \u003ccode\u003eon\u003c/code\u003e 方法监听，在回调结束的最后位置，通过\u003ccode\u003eremoveListener\u003c/code\u003e 删掉监听函数自身\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e  \u003cspan class=\"hljs-title function_\"\u003eonce\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eeventName, listener\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efn\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e...args\u003c/span\u003e) =\u003e {\n      listener.\u003cspan class=\"hljs-title function_\"\u003eapply\u003c/span\u003e(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, args);\n      \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eremoveListener\u003c/span\u003e(eventName, fn);\n    };\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eon\u003c/span\u003e(eventName, fn);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e;\n  }\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"removealllisteners-方法\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#removealllisteners-方法\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eremoveAllListeners 方法\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e  \u003cspan class=\"hljs-title function_\"\u003eremoveAllListeners\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eeventNames = []\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (eventNames.\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e === \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n      \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eObject\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreate\u003c/span\u003e(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      eventNames.\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e) =\u003e\u003c/span\u003e {\n        \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[v] = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n      });\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e;\n  }\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"setmaxlistenersgetmaxlistenerslistenercountonoff-方法\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#setmaxlistenersgetmaxlistenerslistenercountonoff-方法\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003esetMaxListeners、getMaxListeners、listenerCount、on、off 方法\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e  \u003cspan class=\"hljs-title function_\"\u003esetMaxListeners\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emaxListeners\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.#maxListeners = maxListeners;\n  }\n  \u003cspan class=\"hljs-title function_\"\u003egetMaxListeners\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.#maxListeners;\n  }\n  \u003cspan class=\"hljs-title function_\"\u003elistenerCount\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eeventName\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elisteners\u003c/span\u003e[eventName]?.\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e ?? \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n  }\n\n  \u003cspan class=\"hljs-title class_\"\u003eEventEmitter\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprototype\u003c/span\u003e\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eon\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eEventEmitter\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprototype\u003c/span\u003e\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eaddListener\u003c/span\u003e;\n  \u003cspan class=\"hljs-title class_\"\u003eEventEmitter\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprototype\u003c/span\u003e\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eoff\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eEventEmitter\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprototype\u003c/span\u003e\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eremoveListener\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"完整代码地址-httpsgithubcomlzs911eventemit\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#完整代码地址-httpsgithubcomlzs911eventemit\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e完整代码地址: \u003ca href=\"https://github.com/LZS911/EventEmit\"\u003ehttps://github.com/LZS911/EventEmit\u003c/a\u003e\u003c/h4\u003e"])</script><script>self.__next_f.push([1,"7:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center font-[Arial] max-w-[864px] text-center\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-[2.5rem] font-bold bg-lime-300 px-5 py-2 rounded-sm text-shadow-lg leading-[1.1]\",\"children\":\"如何实现一个EventEmit?\"}]}],[\"$\",\"time\",null,{\"dateTime\":\"2022-09-07\",\"className\":\"text-center block my-4 text-sm opacity-60\",\"children\":\"September\\t7, 2022\"}],[null,[\"$\",\"section\",null,{\"className\":\"markdown-body-orange max-w-3xl\",\"dangerouslySetInnerHTML\":{\"__html\":\"$16\"}}]],null]}]\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"15:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Ai.Haibara codes\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"LZS Blog\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"96x96\"}]],\"error\":null,\"digest\":\"$undefined\"}\ne:{\"metadata\":\"$15:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>