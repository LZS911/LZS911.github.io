<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><title>Webpack与Vite学习记录01 | Ai.Haibara codes</title><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/a5eda337cc81d9ab.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a5eda337cc81d9ab.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-3b5a00d5d7e8d93b.js" defer=""></script><script src="/_next/static/chunks/main-59a90320855f5cf5.js" defer=""></script><script src="/_next/static/chunks/pages/_app-91d7f786791773ad.js" defer=""></script><script src="/_next/static/chunks/799-575b46febca3af7d.js" defer=""></script><script src="/_next/static/chunks/642-f55f53346f993b53.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-d7fe9a31c8040d96.js" defer=""></script><script src="/_next/static/k52nxzxdyD3iAtLv2GTft/_buildManifest.js" defer=""></script><script src="/_next/static/k52nxzxdyD3iAtLv2GTft/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen"><header class="text-white bg-black drop-shadow-2xl"><div class="mx-auto my-0 max-w-[960px] py-6 px-4 flex items-center"><div class="flex items-center"><img alt="Ai.Haibara" src="/assets/blog/authors/haibara_2.jpg" width="100" height="100" decoding="async" data-nimg="1" class=" rounded-full" loading="lazy" style="color:transparent"/></div><div class="ml-6"><a class=" font-bold text-3xl" href="/">Ai.Haibara codes</a><div class="mt-2"><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-indigo" href="/">Home</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-indigo" href="/projects">Projects</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-indigo" href="/talks">Talks</a><a class="p-1 rounded-sm text-xl mr-2 hover:border-b-2 border-indigo" href="/blogs">Blogs</a></div></div></div></header><main class="p-6 flex justify-center"><article><div class="flex justify-center font-[Arial] max-w-[864px] text-center"><h1 class="text-5xl font-bold bg-indigo px-5 py-2 rounded-sm text-shadow-lg leading-[1.1]">Webpack与Vite学习记录01</h1></div><time dateTime="2022-03-10" class="text-center block my-4 text-sm opacity-60">March	10, 2022</time><section><div class="markdown-body-scrolls-light max-w-3xl"><h2 id="webpack-tree-shaking"><a aria-hidden="true" tabindex="-1" href="#webpack-tree-shaking"><span class="icon icon-link"></span></a>Webpack Tree Shaking</h2>
<h3 id="来自于-webpack-中文官方文档描述"><a aria-hidden="true" tabindex="-1" href="#来自于-webpack-中文官方文档描述"><span class="icon icon-link"></span></a>来自于 <code>Webpack</code> 中文官方文档描述</h3>
<blockquote>
<p>tree shaking 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code)。它依赖于 ES2015 模块语法的 静态结构 特性，例如 import 和 export。这个术语和概念实际上是由 ES2015 模块打包工具 rollup 普及起来的。
Webpack 2 正式版本内置支持 ES2015 模块（也叫做 harmony modules）和未使用模块检测能力。新的 Webpack 4 正式版本扩展了此检测能力，通过 package.json 的 "sideEffects" 属性作为标记，向 compiler 提供提示，表明项目中的哪些文件是 "pure(纯正 ES2015 模块)"，由此可以安全地删除文件中未使用的部分。</p>
</blockquote>
<p>上述描述可能有点抽象, 举个栗子:</p>
<h3 id="关于-lodash-的-import"><a aria-hidden="true" tabindex="-1" href="#关于-lodash-的-import"><span class="icon icon-link"></span></a>关于 lodash 的 import</h3>
<p>众所周知, <code>lodash</code> 是一个工具函数库, 在平时开发中能够为我们提供很多便利. 但因为 <code>lodash</code> 在 2012 年便开源, 历史较为久远, 可能有多种缘故, 导致目前 <code>lodash</code> 本身并不是使用的 <code>es module</code>. 所以在使用 <code>Webpack Tree Shaking</code> 时, 会出现一些问题.</p>
<p>前置作业:</p>
<p>这里先配置一个 <code>Webpack</code> + <code>react</code> 的最基本环境.</p>
<p><code>package.json:</code></p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lodash_test_Webpack"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MIT"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Webpack serve --mode=development"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Webpack --mode=production"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.21"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lodash-es"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.21"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^17.0.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^17.0.2"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@babel/core"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.17.7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@babel/preset-react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.16.7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"babel-loader"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^8.2.3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"Webpack"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.70.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"Webpack-bundle-analyzer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.5.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"Webpack-cli"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.9.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"Webpack-dev-server"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.7.4"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>入口文件 <code>main.js:</code></p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { render } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.jsx'</span>;

<span class="hljs-keyword">const</span> mountNode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'app'</span>);
<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">App</span> /></span></span>, mountNode);
</code></pre>
<p><code>app.jsx:</code></p>
<pre><code class="hljs language-jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) => {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span>></span>hello react<span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<p><code>Webpack.config.js</code></p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">BundleAnalyzerPlugin</span> =
  <span class="hljs-built_in">require</span>(<span class="hljs-string">'Webpack-bundle-analyzer'</span>).<span class="hljs-property">BundleAnalyzerPlugin</span>;

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./main.js'</span>,
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name].js'</span>,
    <span class="hljs-attr">path</span>: __dirname + <span class="hljs-string">'/dist'</span>,
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(js|jsx|ts|tsx)$/</span>,
        <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>,
        <span class="hljs-attr">use</span>: [
          {
            <span class="hljs-attr">loader</span>: <span class="hljs-string">'babel-loader'</span>,
          },
        ],
      },
    ],
  },
  <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">BundleAnalyzerPlugin</span>()],
};
</code></pre>
<p><code>.babelrc:</code></p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"presets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"@babel/preset-react"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"runtime"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"automatic"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到在 <code>Webpack</code> 配置中使用了 <code>BundleAnalyzerPlugin</code> 这样一个插件, 简单说明下该插件作用.</p>
<p><strong><a href="https://www.npmtrends.com/Webpack-bundle-analyzer">Webpack bundle analyzer</a></strong></p>
<p>该工具是一个可以分析打包后文件结果的视觉化套件, 有了该工具后就可以清楚的从视觉化的图案了解到每次打包后的文件大小, 用来分析 <code>Webpack Tree Shaking</code> 后的结果.</p>
<h3 id="分析使用不同的方式-import-lodash-的结果"><a aria-hidden="true" tabindex="-1" href="#分析使用不同的方式-import-lodash-的结果"><span class="icon icon-link"></span></a>分析使用不同的方式 import lodash 的结果</h3>
<h4 id="第一种方式-不指定-function-的路径"><a aria-hidden="true" tabindex="-1" href="#第一种方式-不指定-function-的路径"><span class="icon icon-link"></span></a>第一种方式: 不指定 <code>function</code> 的路径</h4>
<p>修改 <code>app.jsx</code>, 在组件中引入 <code>lodash</code></p>
<pre><code class="hljs language-jsx"><span class="hljs-keyword">import</span> { isEqual } <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) => {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isEqual</span>({ <span class="hljs-attr">a</span>: <span class="hljs-string">'b'</span> }, { <span class="hljs-attr">c</span>: <span class="hljs-string">'d'</span> }));
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span>></span>hello react<span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<p>打包后的文件结构:
<img src="../assets/images/webpack-build-result-size/webpack_build_result_1.png" alt="alt"></p>
<p>可以看到, 明明在项目中只使用了 <code>isEqual</code> 这一个 <code>function</code>, 结果 <code>lodash</code> 打包后的文件大小却足足有 <code>531kb</code>, 不禁让人怀疑, <code>isEqual</code> 是一个多么伟大的函数...</p>
<h4 id="第二种方式-指定-function-的路径"><a aria-hidden="true" tabindex="-1" href="#第二种方式-指定-function-的路径"><span class="icon icon-link"></span></a>第二种方式: 指定 <code>function</code> 的路径</h4>
<pre><code class="hljs language-jsx"><span class="hljs-keyword">import</span> isEqual <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash/isEqual'</span>;
</code></pre>
<p>打包后的文件结构:
<img src="../assets/images/webpack-build-result-size/webpack_build_result_2.png" alt="alt"></p>
<p>可以看到这个时候打包后的 <code>lodash</code> 仅有 <code>61kb</code> 了.</p>
<h4 id="为什么两种-import-的方式会导致-bundle-size-不一样"><a aria-hidden="true" tabindex="-1" href="#为什么两种-import-的方式会导致-bundle-size-不一样"><span class="icon icon-link"></span></a>为什么两种 import 的方式会导致 bundle size 不一样</h4>
<p><code>lodash</code> 是一个使用 <code>UMD</code> 为模块的构建的, 这意味着 <code>lodash</code> 并不满足在 <code>webpack</code> 中的 <code>tree-shaking</code> 必须是 <code>es module</code> 的条件. 所以第一种方式实际上会导入完整的 <code>lodash</code>, 最终导致 <code>bundle size</code> 莫名的巨大. 而第二种方法就是只导入了一个文件, 再从文件中拿出我们需要的 <code>isEqual</code>, 如此一来最后打包处的文件大小便是正常的.</p>
<p>可是如果都要这样写代码会很麻烦, 毕竟 <code>vscode</code> 自动导入会按照第一种方式导入. 当然 <code>lodash</code> 官方也有考虑到这个问题, 推出了 <code>es module</code> 版本的 <code>lodash-es</code>.</p>
<h3 id="为什么-webpack-tree-shaking-使用的是-es-module"><a aria-hidden="true" tabindex="-1" href="#为什么-webpack-tree-shaking-使用的是-es-module"><span class="icon icon-link"></span></a>为什么 webpack tree-shaking 使用的是 es module?</h3>
<p>因为在 <code>CommonJS</code>、<code>AMD</code> 、<code>UMD</code> 中的导入都可能是非确定性的, 因此无法静态分析以有效消除死代码.</p>
<p>举个栗子:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> flag = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">if</span> (flag) {
  <span class="hljs-keyword">const</span> lodash = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>);
}
</code></pre>
<h2 id="vite-tree-shaking"><a aria-hidden="true" tabindex="-1" href="#vite-tree-shaking"><span class="icon icon-link"></span></a>vite tree-shaking</h2>
<p><code>vite</code> 的构建生产环境使用的是 <code>rollup</code>, 相比于 <code>webpack</code>, <code>rollup</code> 总是能够打出更小、更快的宝. 并且 rollup 也是基于 <code>es module</code>, 相比于 <code>webpack</code> 使用的 <code>CommonJS</code> 更加的高效.</p></div></section><div class="mt-10 max-w-3xl"><h3 class="text-2xl font-bold mb-4">评论</h3><p>加载评论中...</p></div></article></main><footer class="bg-neutral-50 border-t border-neutral-200 text-center text-xs opacity-50 py-4">© 2022,<!-- --> <a rel="noopener noreferrer" class="hover:underline hover:bg-indigo" href="https://github.com/LZS911" target="_blank">LZS_911</a>, build with<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://nextjs.org/" target="_blank">Next.js</a> <!-- -->and<!-- --> <a rel="noopener noreferrer" class="underline hover:bg-indigo" href="https://pages.github.com/?(null)" target="_blank">GitHub Pages</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Webpack与Vite学习记录01","date":"2022-03-10","slug":"webpack与vite学习记录01","author":"LZS_911","content":"\u003ch2 id=\"webpack-tree-shaking\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#webpack-tree-shaking\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eWebpack Tree Shaking\u003c/h2\u003e\n\u003ch3 id=\"来自于-webpack-中文官方文档描述\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#来自于-webpack-中文官方文档描述\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e来自于 \u003ccode\u003eWebpack\u003c/code\u003e 中文官方文档描述\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003etree shaking 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code)。它依赖于 ES2015 模块语法的 静态结构 特性，例如 import 和 export。这个术语和概念实际上是由 ES2015 模块打包工具 rollup 普及起来的。\nWebpack 2 正式版本内置支持 ES2015 模块（也叫做 harmony modules）和未使用模块检测能力。新的 Webpack 4 正式版本扩展了此检测能力，通过 package.json 的 \"sideEffects\" 属性作为标记，向 compiler 提供提示，表明项目中的哪些文件是 \"pure(纯正 ES2015 模块)\"，由此可以安全地删除文件中未使用的部分。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e上述描述可能有点抽象, 举个栗子:\u003c/p\u003e\n\u003ch3 id=\"关于-lodash-的-import\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#关于-lodash-的-import\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e关于 lodash 的 import\u003c/h3\u003e\n\u003cp\u003e众所周知, \u003ccode\u003elodash\u003c/code\u003e 是一个工具函数库, 在平时开发中能够为我们提供很多便利. 但因为 \u003ccode\u003elodash\u003c/code\u003e 在 2012 年便开源, 历史较为久远, 可能有多种缘故, 导致目前 \u003ccode\u003elodash\u003c/code\u003e 本身并不是使用的 \u003ccode\u003ees module\u003c/code\u003e. 所以在使用 \u003ccode\u003eWebpack Tree Shaking\u003c/code\u003e 时, 会出现一些问题.\u003c/p\u003e\n\u003cp\u003e前置作业:\u003c/p\u003e\n\u003cp\u003e这里先配置一个 \u003ccode\u003eWebpack\u003c/code\u003e + \u003ccode\u003ereact\u003c/code\u003e 的最基本环境.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003epackage.json:\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"lodash_test_Webpack\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"1.0.0\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"main\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"index.js\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"license\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"MIT\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"start\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Webpack serve --mode=development\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Webpack --mode=production\"\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"dependencies\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"lodash\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"^4.17.21\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"lodash-es\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"^4.17.21\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"react\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"^17.0.2\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"react-dom\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"^17.0.2\"\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"devDependencies\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"@babel/core\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"^7.17.7\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"@babel/preset-react\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"^7.16.7\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"babel-loader\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"^8.2.3\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"Webpack\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"^5.70.0\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"Webpack-bundle-analyzer\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"^4.5.0\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"Webpack-cli\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"^4.9.2\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"Webpack-dev-server\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"^4.7.4\"\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e入口文件 \u003ccode\u003emain.js:\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { render } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react-dom'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eApp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./app.jsx'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mountNode = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetElementById\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'app'\u003c/span\u003e);\n\u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e(\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eApp\u003c/span\u003e /\u003e\u003c/span\u003e\u003c/span\u003e, mountNode);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eapp.jsx:\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eApp\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003ehello react\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eApp\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eWebpack.config.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBundleAnalyzerPlugin\u003c/span\u003e =\n  \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Webpack-bundle-analyzer'\u003c/span\u003e).\u003cspan class=\"hljs-property\"\u003eBundleAnalyzerPlugin\u003c/span\u003e;\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eentry\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'./main.js'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eoutput\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003efilename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'[name].js'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: __dirname + \u003cspan class=\"hljs-string\"\u003e'/dist'\u003c/span\u003e,\n  },\n  \u003cspan class=\"hljs-attr\"\u003emodule\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003erules\u003c/span\u003e: [\n      {\n        \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/\\.(js|jsx|ts|tsx)$/\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eexclude\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/node_modules/\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003euse\u003c/span\u003e: [\n          {\n            \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'babel-loader'\u003c/span\u003e,\n          },\n        ],\n      },\n    ],\n  },\n  \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBundleAnalyzerPlugin\u003c/span\u003e()],\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e.babelrc:\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"presets\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"hljs-punctuation\"\u003e[\u003c/span\u003e\n      \u003cspan class=\"hljs-string\"\u003e\"@babel/preset-react\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003e\"runtime\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"automatic\"\u003c/span\u003e\n      \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可以看到在 \u003ccode\u003eWebpack\u003c/code\u003e 配置中使用了 \u003ccode\u003eBundleAnalyzerPlugin\u003c/code\u003e 这样一个插件, 简单说明下该插件作用.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://www.npmtrends.com/Webpack-bundle-analyzer\"\u003eWebpack bundle analyzer\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e该工具是一个可以分析打包后文件结果的视觉化套件, 有了该工具后就可以清楚的从视觉化的图案了解到每次打包后的文件大小, 用来分析 \u003ccode\u003eWebpack Tree Shaking\u003c/code\u003e 后的结果.\u003c/p\u003e\n\u003ch3 id=\"分析使用不同的方式-import-lodash-的结果\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#分析使用不同的方式-import-lodash-的结果\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e分析使用不同的方式 import lodash 的结果\u003c/h3\u003e\n\u003ch4 id=\"第一种方式-不指定-function-的路径\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#第一种方式-不指定-function-的路径\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e第一种方式: 不指定 \u003ccode\u003efunction\u003c/code\u003e 的路径\u003c/h4\u003e\n\u003cp\u003e修改 \u003ccode\u003eapp.jsx\u003c/code\u003e, 在组件中引入 \u003ccode\u003elodash\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { isEqual } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'lodash'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eApp\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u003e {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003eisEqual\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003ea\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e }, { \u003cspan class=\"hljs-attr\"\u003ec\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'd'\u003c/span\u003e }));\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003ehello react\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eApp\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e打包后的文件结构:\n\u003cimg src=\"../assets/images/webpack-build-result-size/webpack_build_result_1.png\" alt=\"alt\"\u003e\u003c/p\u003e\n\u003cp\u003e可以看到, 明明在项目中只使用了 \u003ccode\u003eisEqual\u003c/code\u003e 这一个 \u003ccode\u003efunction\u003c/code\u003e, 结果 \u003ccode\u003elodash\u003c/code\u003e 打包后的文件大小却足足有 \u003ccode\u003e531kb\u003c/code\u003e, 不禁让人怀疑, \u003ccode\u003eisEqual\u003c/code\u003e 是一个多么伟大的函数...\u003c/p\u003e\n\u003ch4 id=\"第二种方式-指定-function-的路径\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#第二种方式-指定-function-的路径\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e第二种方式: 指定 \u003ccode\u003efunction\u003c/code\u003e 的路径\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e isEqual \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'lodash/isEqual'\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e打包后的文件结构:\n\u003cimg src=\"../assets/images/webpack-build-result-size/webpack_build_result_2.png\" alt=\"alt\"\u003e\u003c/p\u003e\n\u003cp\u003e可以看到这个时候打包后的 \u003ccode\u003elodash\u003c/code\u003e 仅有 \u003ccode\u003e61kb\u003c/code\u003e 了.\u003c/p\u003e\n\u003ch4 id=\"为什么两种-import-的方式会导致-bundle-size-不一样\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#为什么两种-import-的方式会导致-bundle-size-不一样\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e为什么两种 import 的方式会导致 bundle size 不一样\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003elodash\u003c/code\u003e 是一个使用 \u003ccode\u003eUMD\u003c/code\u003e 为模块的构建的, 这意味着 \u003ccode\u003elodash\u003c/code\u003e 并不满足在 \u003ccode\u003ewebpack\u003c/code\u003e 中的 \u003ccode\u003etree-shaking\u003c/code\u003e 必须是 \u003ccode\u003ees module\u003c/code\u003e 的条件. 所以第一种方式实际上会导入完整的 \u003ccode\u003elodash\u003c/code\u003e, 最终导致 \u003ccode\u003ebundle size\u003c/code\u003e 莫名的巨大. 而第二种方法就是只导入了一个文件, 再从文件中拿出我们需要的 \u003ccode\u003eisEqual\u003c/code\u003e, 如此一来最后打包处的文件大小便是正常的.\u003c/p\u003e\n\u003cp\u003e可是如果都要这样写代码会很麻烦, 毕竟 \u003ccode\u003evscode\u003c/code\u003e 自动导入会按照第一种方式导入. 当然 \u003ccode\u003elodash\u003c/code\u003e 官方也有考虑到这个问题, 推出了 \u003ccode\u003ees module\u003c/code\u003e 版本的 \u003ccode\u003elodash-es\u003c/code\u003e.\u003c/p\u003e\n\u003ch3 id=\"为什么-webpack-tree-shaking-使用的是-es-module\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#为什么-webpack-tree-shaking-使用的是-es-module\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e为什么 webpack tree-shaking 使用的是 es module?\u003c/h3\u003e\n\u003cp\u003e因为在 \u003ccode\u003eCommonJS\u003c/code\u003e、\u003ccode\u003eAMD\u003c/code\u003e 、\u003ccode\u003eUMD\u003c/code\u003e 中的导入都可能是非确定性的, 因此无法静态分析以有效消除死代码.\u003c/p\u003e\n\u003cp\u003e举个栗子:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e flag = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (flag) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e lodash = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'lodash'\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"vite-tree-shaking\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#vite-tree-shaking\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003evite tree-shaking\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003evite\u003c/code\u003e 的构建生产环境使用的是 \u003ccode\u003erollup\u003c/code\u003e, 相比于 \u003ccode\u003ewebpack\u003c/code\u003e, \u003ccode\u003erollup\u003c/code\u003e 总是能够打出更小、更快的宝. 并且 rollup 也是基于 \u003ccode\u003ees module\u003c/code\u003e, 相比于 \u003ccode\u003ewebpack\u003c/code\u003e 使用的 \u003ccode\u003eCommonJS\u003c/code\u003e 更加的高效.\u003c/p\u003e","ogImage":{"url":"/assets/blog/image/cover.jpg"},"coverImage":"/assets/blog/image/cover.jpg","theme":"scrolls-light","tag":["Webpack","javascript","node.js","vite","babel"]}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"webpack与vite学习记录01"},"buildId":"k52nxzxdyD3iAtLv2GTft","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>