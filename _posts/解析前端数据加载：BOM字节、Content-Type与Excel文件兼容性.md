---
title: è§£æå‰ç«¯æ•°æ®åŠ è½½ï¼šBOMå­—èŠ‚ã€Content-Typeä¸Excelæ–‡ä»¶å…¼å®¹æ€§
date: "2024-04-10"
image: 
headerImage: false
tag:
  -
star: true
category: blog
author: Ai.Haibara
excerpt: 
theme: fancy
---

## å¼•è¨€
åœ¨å¼€å‘ To B ç«¯çš„é¡¹ç›®æ—¶ï¼Œå¯¼å‡º CSV æ–‡ä»¶è¿›è¡Œæ•°æ®åˆ†ææ˜¯ä¸€é¡¹å¸¸è§„æ“ä½œã€‚ç„¶è€Œï¼Œè¿™ä¸€è¿‡ç¨‹å¹¶éæ€»æ˜¯é¡ºç•…æ— é˜»ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå½“ä½ ä¿¡å¿ƒæ»¡æ»¡åœ°å°†ä¸€ä¸ª CSV æ–‡ä»¶æ‹–å…¥ Excel ï¼ŒæœŸå¾…çœ‹åˆ°ä¸€ä¸ªæ•´é½çš„æ•°æ®è¡¨æ ¼æ—¶ï¼Œå´é­é‡äº†ä¹±ç çš„å°´å°¬åœºæ™¯ã€‚è¿™ä¸ä»…ä»¤äººæ²®ä¸§ï¼Œè€Œä¸”å¯èƒ½ä¸¥é‡å½±å“å·¥ä½œæ•ˆç‡ã€‚é‚£ä¹ˆï¼ŒCSV æ–‡ä»¶ä¸ Excel ä¹‹é—´å­˜åœ¨å“ªäº›å·®å¼‚ï¼Ÿæˆ‘ä»¬å¦‚ä½•ç¡®ä¿åœ¨ Excel ä¸­èƒ½å¤Ÿæ­£å¸¸æ‰“å¼€ CSV æ–‡ä»¶ï¼Ÿ

æœ¬æ–‡å°†é’ˆå¯¹è¿™äº›ç–‘é—®å±•å¼€æ¢è®¨ï¼Œä»ä¸€æ¬¡ CSV æ–‡ä»¶å¯¼å…¥ Excel æ—¶å‡ºç°çš„ä¹±ç é—®é¢˜å…¥æ‰‹ï¼Œé€æ­¥å‰–æèƒŒåçš„åŸå› ã€‚é‡ç‚¹æ¢è®¨`BOMï¼ˆByte Order Markï¼‰`å­—èŠ‚å’Œ HTTP å“åº”ä¸­çš„`Content-Type`å¦‚ä½•å½±å“å‰ç«¯å¯¹æ•°æ®çš„åŠ è½½å’Œè§£æï¼Œä»¥åŠè¿™äº›å› ç´ å¯¹ Excel æ–‡ä»¶å…¼å®¹æ€§çš„å½±å“ã€‚

## CSVæ–‡ä»¶ä¸Excelçš„å·®å¼‚ [^1]
1. Excelæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®ƒä¿å­˜æœ‰å…³å·¥ä½œç°¿ä¸­æ‰€æœ‰å·¥ä½œè¡¨çš„ä¿¡æ¯ã€‚CSVä»£è¡¨ Comma Separated Values ã€‚è¿™æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ ¼å¼ï¼Œç”¨é€—å·åˆ†éš”ä¸€ç³»åˆ—å€¼ã€‚
2. Excelä¸ä»…å¯ä»¥å­˜å‚¨æ•°æ®ï¼Œè¿˜å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚CSVæ–‡ä»¶åªæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒå­˜å‚¨æ•°æ®ï¼Œä½†ä¸åŒ…å«æ ¼å¼ï¼Œå…¬å¼ï¼Œå®ç­‰ã€‚å®ƒä¹Ÿè¢«ç§°ä¸ºå¹³é¢æ–‡ä»¶ã€‚
3. Excelæ˜¯ä¸€ä¸ªç”µå­è¡¨æ ¼ï¼Œå°†æ–‡ä»¶ä¿å­˜ä¸ºè‡ªå·±çš„ä¸“æœ‰æ ¼å¼ï¼Œå³xlsæˆ–xlsxã€‚CSVæ˜¯å°†è¡¨æ ¼ä¿¡æ¯ä¿å­˜ä¸ºæ‰©å±•åä¸º.csvçš„åˆ†éš”æ–‡æœ¬æ–‡ä»¶çš„æ ¼å¼ã€‚
4. ä¿å­˜åœ¨excelä¸­çš„æ–‡ä»¶ä¸èƒ½è¢«æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€æˆ–ç¼–è¾‘ã€‚CSVæ–‡ä»¶å¯ä»¥é€šè¿‡æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚è®°äº‹æœ¬ï¼‰æ‰“å¼€æˆ–ç¼–è¾‘ã€‚

## BOMå­—èŠ‚çš„æ¦‚å¿µä¸ä½œç”¨
åœ¨è§£é‡ŠBOMå­—èŠ‚å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ CSV æ–‡ä»¶åœ¨ WPS å’Œ Microsoft Excel ä¸­çš„è¡¨ç°åŒºåˆ«

### WPS
![image](https://github.com/LZS911/LZS911.github.io/assets/42765421/6c8989cf-0386-4f4b-bcdb-1dfef747f2dc)

### Microsoft Excel
![image](https://github.com/LZS911/LZS911.github.io/assets/42765421/1eb61e35-19f5-4aaa-b1fa-b0f6a5be24f7)

### ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸­æ–‡ä¹±ç ï¼Ÿ
å½“å‡ºç°ä¹±ç åï¼Œé¦–å…ˆåº”è¯¥è€ƒè™‘çš„æ˜¯æ–‡ä»¶çš„ç¼–ç æ ¼å¼é—®é¢˜ã€‚é€šå¸¸ï¼ŒCSV æ–‡ä»¶é‡‡ç”¨ UTF-8 ç¼–ç ï¼Œè¿™æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å­—ç¬¦ç¼–ç ï¼Œæ”¯æŒåŒ…æ‹¬ä¸­æ–‡åœ¨å†…çš„å¤šç§è¯­è¨€ã€‚ç„¶è€Œ Microsoft Excel ä¼šé»˜è®¤ä½¿ç”¨ ANSI ç¼–ç æ¥è§£ææ–‡ä»¶ï¼Œè€Œ ANSI ç¼–ç å®é™…ä¸Šæ˜¯ä¾èµ–äºç³»ç»ŸåŒºåŸŸè®¾ç½®çš„ç‰¹å®šç¼–ç ï¼Œæ¯”å¦‚åœ¨ä¸­æ–‡ Windows ç³»ç»Ÿä¸­é€šå¸¸æ˜¯GBKã€‚

### è§£å†³æ–¹æ¡ˆ
1. ä¿®æ”¹csvæ–‡ä»¶ç¼–ç æ ¼å¼ã€‚ æ‰§è¡Œå‘½ä»¤ `iconv -f UTF-8 -t GB18030 old_file.csv > new_file.csv`ï¼ˆåœ¨ macos ä¸­èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œï¼Œè‹¥ Windows æ— æ³•æ‰§è¡Œéœ€å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆï¼Œä¾‹å¦‚ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚Notepad++ï¼‰çš„å¦å­˜ä¸ºåŠŸèƒ½ï¼Œé€‰æ‹©GBKä½œä¸ºä¿å­˜ç¼–ç ï¼‰ï¼Œé‡æ–°ç”Ÿæˆçš„ new_file ä¾¿èƒ½æ­£å¸¸åœ¨ Microsoft Excel ä¸­æ˜¾ç¤ºä¸­æ–‡äº†ã€‚
   å°½ç®¡ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œç¼–ç è½¬æ¢å¯¹äºæŠ€æœ¯ç”¨æˆ·æ¥è¯´æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ–¹æ³•ï¼Œä½†ç¡®å®å¯èƒ½å¯¹æ™®é€šç”¨æˆ·æ¥è¯´æœ‰ä¸€å®šçš„ä½¿ç”¨é—¨æ§›ã€‚
2. ä½¿ç”¨ BOM æ¥è¿›è¡Œç¼–ç è¡¨ç¤ºã€‚ BOMæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å­—èŠ‚åºåˆ—ï¼Œç”¨äºæ ‡è¯†æ–‡ä»¶çš„ç¼–ç æ ¼å¼ã€‚UTF-8ç¼–ç çš„BOMå­—èŠ‚åºåˆ—æ˜¯`0xEF 0xBB 0xBF`ã€‚å½“Excelæ‰“å¼€å¸¦æœ‰BOMçš„CSVæ–‡ä»¶æ—¶ï¼ŒBOMå¸®åŠ©Excelè¯†åˆ«æ–‡ä»¶æ˜¯ä»¥UTF-8ç¼–ç çš„ï¼Œä»è€Œé¿å…äº†ä½¿ç”¨é”™è¯¯çš„ç¼–ç è§£ææ–‡ä»¶å†…å®¹ã€‚
   ä»£ç æ¡ˆä¾‹ï¼šhttps://github.com/LZS911/csv-bom-excel-example [^2]

   ![image](https://github.com/LZS911/LZS911.github.io/assets/42765421/260b5efb-a0a9-4b2b-a4ed-8e8e84a8ddd8)
   ![image](https://github.com/LZS911/LZS911.github.io/assets/42765421/aeade430-b59a-4e57-a92f-f81f1604f48e)

   >å…¶ä¸­æ–‡ä»¶å¤§å°ä¸º 60b çš„ä¸ºé™„å¸¦äº† BOM å­—èŠ‚çš„ csv æ–‡ä»¶


## Response-Typeåœ¨HTTPå“åº”ä¸­çš„ä½œç”¨
æˆ‘ä»¬æ¥çœ‹ä¸€è¡Œä»£ç ï¼š https://github.com/LZS911/csv-bom-excel-example/blob/main/index.html#L15

é¦–å…ˆäº†è§£ä¸‹ ResponseType[^3] çš„ä½œç”¨
>`XMLHttpRequest` å±æ€§ `responseType` æ˜¯ä¸€ä¸ªæšä¸¾å­—ç¬¦ä¸²å€¼ï¼Œç”¨äºæŒ‡å®šå“åº”ä¸­åŒ…å«çš„æ•°æ®ç±»å‹ã€‚
>å®ƒè¿˜å…è®¸ä½œè€…æ›´æ”¹å“åº”ç±»å‹ã€‚å¦‚æœå°† `responseType` çš„å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™ä¼šä½¿ç”¨ `'text'` ä½œä¸ºé»˜è®¤å€¼ã€‚

æ–‡ç« å¯èƒ½çœ‹çš„æœ‰ç‚¹è¿·ç³Šï¼Œæˆ‘ä»¬ç›´æ¥å°†è¿™è¡Œä»£ç æ³¨é‡Šï¼Œç„¶åè§‚å¯Ÿä¸‹è½½å¾—åˆ°çš„æ–‡ä»¶çš„è¡¨ç°
![image](https://github.com/LZS911/LZS911.github.io/assets/42765421/d6084364-3e6b-4beb-a012-02efede30366)
![image](https://github.com/LZS911/LZS911.github.io/assets/42765421/0434db6d-3f2e-4ed1-aa37-c81b7bf6cd7f)

å¯ä»¥å‘ç°ï¼Œå‰ç«¯è·å–åˆ°çš„ csv æ–‡ä»¶åˆä¸¢å¤±æ‰äº†åç«¯é™„åŠ çš„ BOM å­—èŠ‚ï¼Œå¯¼è‡´åœ¨ Microsoft Excel ä¸­å‡ºç°äº†ä¹±ç ã€‚

æ‰€ä»¥ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼š

å½“æœåŠ¡ç«¯ç«¯åœ¨è¿”å›æ•°æ®é¦–éƒ¨æ·»åŠ å­—èŠ‚`BOMï¼ˆByte Order Markï¼‰`æ—¶ï¼Œå‰ç«¯å¦‚æœæ²¡æœ‰ç‰¹åˆ«è®¾ç½® `XMLHttpRequestçš„responseType` ä¸º `'blob'`ï¼Œä¼šä¸¢å¤±BOMå­—èŠ‚ã€‚

è¿™æ˜¯å› ä¸º`XMLHttpRequest`çš„é»˜è®¤`responseType`æ˜¯ `'text'`ï¼Œå½“è®¾ç½®ä¸º`'text'`æ—¶ï¼Œæµè§ˆå™¨ä¼šå°è¯•å°†å“åº”ä½“è§£ç ä¸ºå­—ç¬¦ä¸²æ–‡æœ¬ã€‚

## å¦‚ä½•é¿å…BOMå­—èŠ‚çš„ä¸¢å¤±
### åç«¯å¤„ç†
åœ¨å‰ç«¯ä¸è¿›è¡Œä»»ä½•é¢å¤–çš„å¤„ç†æƒ…å†µä¸‹ï¼Œåç«¯å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²é¦–éƒ¨æ·»åŠ å­—èŠ‚ `\ufeff` çš„æ–¹å¼ã€‚ è§ä»£ç ï¼šhttps://github.com/LZS911/csv-bom-excel-example/blob/main/server.js#L5ã€‚å½“ç„¶ï¼Œæœ€åä»£ç èƒ½ä¸èƒ½è¿‡ review å°±ä¸å¥½è¯´äº†ğŸ¤ªã€‚

### å‰ç«¯å¤„ç†
1. å‰ç«¯æ‰‹åŠ¨æ·»åŠ  `{responseType: 'blob'}`ï¼Œ å­˜åœ¨ä¸€å®šçš„å¿ƒæ™ºè´Ÿæ‹…ã€‚
2. ç»Ÿä¸€åœ¨è¯·æ±‚åœ¨ `context-type` ä¸º 'text/csv' çš„æƒ…å†µä¸‹ï¼Œåœ¨è¿”å›çš„dataå‰éƒ¨åŠ ä¸Š `\ufeff`ã€‚ åŒæ ·éœ€è¦ç»è¿‡ä»£ç  review çš„è€ƒéªŒã€‚

### æœ€ä½³å®è·µ
ç›®å‰å¯¹æ¯”ä¸‹æ¥ï¼Œä¸Šè¿°çš„å‡ ç§æ–¹æ¡ˆéƒ½ä¸æ˜¯ç‰¹åˆ«å®Œç¾ã€‚ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»¼åˆåˆ©ç”¨é¡¹ç›®ä¸­ç°æœ‰çš„å·¥å…·å’Œæµç¨‹æ¥æ‰¾å¯»åˆ°æœ€ä½³å®è·µã€‚

æˆ‘ä»¬çš„å‰ç«¯é¡¹ç›®ä½¿ç”¨äº† `Typescript`ï¼Œå¹¶ä¸” api å®šä¹‰éƒ¨åˆ†ä½¿ç”¨ä¸€æ®µè„šæœ¬é€šè¿‡è·å–åç«¯çš„ swagger.json æ–‡ä»¶æ¥è‡ªåŠ¨ç”Ÿæˆï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼šhttps://github.com/actiontech/dms-ui/blob/08f7de1a9e724008e18f73e498eaa9aca456ed1d/packages/shared/lib/api/sqle/service/task/index.ts#L206

![image](https://github.com/LZS911/LZS911.github.io/assets/42765421/0ca221f5-4417-4d12-b257-08c90d5ab709)

äºæ˜¯æˆ‘ä»¬å¯ä»¥æ ¹æ®åç«¯çš„ swagger å®šä¹‰ï¼Œç¡®å®šéœ€è¦è®¾ç½® {responseType: 'blob'} çš„æ¥å£ï¼Œç„¶ååœ¨ api æ¨¡æ¿éƒ¨åˆ†è‡ªåŠ¨æ·»åŠ ä¸Šè¯¥å‚æ•°ï¼Œä¾¿èƒ½å‡å°‘å¿ƒæ™ºè´Ÿæ‹…ï¼Œç¡®ä¿è¯¥å‚æ•°çš„å­˜åœ¨ã€‚


## ç»“è¯­[^4]
åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†åœ¨ Web å¼€å‘è¿‡ç¨‹ä¸­å¤„ç†CSVæ–‡ä»¶æ—¶å¯èƒ½ä¼šé‡åˆ°çš„ä¸€ä¸ªæ£˜æ‰‹é—®é¢˜â€”â€”ä¹±ç ï¼Œä»¥åŠä¸ä¹‹ç›¸å…³çš„æŠ€æœ¯ç»†èŠ‚ã€‚æˆ‘ä»¬åˆ†æäº†ä¹±ç äº§ç”Ÿçš„åŸå› ï¼Œä¸»è¦é›†ä¸­åœ¨å­—ç¬¦ç¼–ç çš„ä¸åŒ¹é…ï¼Œå°¤å…¶æ˜¯å½“ CSV æ–‡ä»¶ä½¿ç”¨ UTF-8 ç¼–ç ä¸”å¸¦æœ‰BOMå­—èŠ‚ï¼Œè€Œå‰ç«¯æˆ– Excel ç­‰ç”µå­è¡¨æ ¼è½¯ä»¶æœªèƒ½æ­£ç¡®è¯†åˆ«å’Œå¤„ç†è¿™äº›å­—èŠ‚æ—¶ã€‚
é€šè¿‡æä¾›ä¸€ç³»åˆ—çš„è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬åœ¨æœåŠ¡ç«¯æ­£ç¡®è®¾ç½® HTTP å“åº”çš„`Content-Type`å¤´éƒ¨ï¼Œä»¥åŠåœ¨å‰ç«¯é€šè¿‡`XMLHttpRequest`ä»¥é€‚å½“çš„`responseType`æ¥æ”¶äºŒè¿›åˆ¶æ•°æ®ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•æœ‰æ•ˆåœ°é¿å…æ•°æ®åœ¨ä¼ è¾“å’ŒåŠ è½½è¿‡ç¨‹ä¸­å‡ºç°ä¹±ç ã€‚

## é™„å½•
> é€šè¿‡ [Kimi](https://kimi.moonshot.cn/) è¾…åŠ©ç”Ÿæˆæ–‡ç« æ ‡é¢˜ä»¥åŠå…·ä½“å¤§çº²ï¼Œå¹¶ä¸”è¿›è¡Œç»†èŠ‚ä¼˜åŒ–ã€‚
[^1]:[CSVæ–‡ä»¶ä¸Excelçš„å·®å¼‚](https://zhuanlan.zhihu.com/p/148209693)\
[^2]:[ç¤ºä¾‹ä»£ç ç”± Kimi ç”Ÿæˆ](https://github.com/LZS911/csv-bom-excel-example)
[^3]:[ResponseType](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/responseType)
[^4]:[æ¥è‡ª Kimi](https://kimi.moonshot.cn/) 
