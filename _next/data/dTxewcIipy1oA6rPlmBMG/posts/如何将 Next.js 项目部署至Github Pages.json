{"pageProps":{"post":{"title":"如何将 Next.js 项目部署至Github Pages","date":"2022-12-06","slug":"如何将 Next.js 项目部署至Github Pages","author":"Ai.Haibara","content":"<h2 id=\"1-创建-github-仓库\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#1-创建-github-仓库\"><span class=\"icon icon-link\"></span></a>1. 创建 Github 仓库</h2>\n<p>新建仓库名称约束: <code>username.github.io</code>, 其中 <code>username</code> 为 <code>Github</code> 上的用户名(或组织名称).</p>\n<p><img src=\"/assets/github-pages/example-1.png\" alt=\"alt\"></p>\n<h2 id=\"2-创建-nextjs-项目\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#2-创建-nextjs-项目\"><span class=\"icon icon-link\"></span></a>2. 创建 Next.js 项目</h2>\n<pre><code class=\"language-ssh\">npx create-next-app@latest --typescript\n# or\nyarn create next-app --typescript\n# or\npnpm create next-app --typescript\n</code></pre>\n<h2 id=\"3-打开-packagejson-并添加脚本\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#3-打开-packagejson-并添加脚本\"><span class=\"icon icon-link\"></span></a>3. 打开 package.json 并添加脚本</h2>\n<pre><code class=\"language-json\"> \"scripts\": {\n    \"dev\": \"next dev\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"lint\": \"next lint\",\n    \"export\": \"next export\" //add\n    \"\"\n  },\n</code></pre>\n<h2 id=\"4-添加-github-actions\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#4-添加-github-actions\"><span class=\"icon icon-link\"></span></a>4. 添加 github Actions</h2>\n<p>关于 <code>GitHub Pages</code> 站点的发布源: <a href=\"https://docs.github.com/cn/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site\">https://docs.github.com/cn/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site</a></p>\n<p>鉴于 <code>Next.js</code> 的源码文件格式并不能直接作为发布源, 我们需要对项目进行打包处理, 同时也可以做一些代码 <code>check</code>, 所以我们需要添加 <code>github Actions</code>.</p>\n<p>添加文件: <code>.github/workflows/gh-pages.yml</code></p>\n<pre><code class=\"language-yml\">name: GitHub Pages\n\non:\n  push:\n    branches:\n      - main\n  pull_request:\n\njobs:\n  deploy:\n    runs-on: ubuntu-22.04\n    permissions:\n      contents: write\n    concurrency:\n      group: ${{ github.workflow }}-${{ github.ref }}\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Setup Node\n        uses: actions/setup-node@v3\n        with:\n          node-version: \"14\"\n\n      - name: Get yarn cache\n        id: yarn-cache\n        run: echo \"::set-output name=dir::$(yarn cache dir)\"\n\n      - name: Cache dependencies\n        uses: actions/cache@v2\n        with:\n          path: ${{ steps.yarn-cache.outputs.dir }}\n          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}\n          restore-keys: |\n            ${{ runner.os }}-yarn-\n\n      - run: yarn install --frozen-lockfile\n      - run: yarn lint\n      - run: yarn build\n      - run: yarn export\n\n      - name: Deploy\n        uses: peaceiris/actions-gh-pages@v3\n        if: ${{ github.ref == 'refs/heads/main' }}\n        with:\n          github_token: ${{ secrets.GITHUB_TOKEN }}\n          publish_dir: ./out\n\n</code></pre>\n<p>了解更多详细信息请前往: <a href=\"https://github.com/peaceiris/actions-gh-pages\">https://github.com/peaceiris/actions-gh-pages</a></p>\n<h2 id=\"5-将代码推送至仓库\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#5-将代码推送至仓库\"><span class=\"icon icon-link\"></span></a>5. 将代码推送至仓库</h2>\n<pre><code class=\"language-ssh\">rm -rf .git\ngit add .\ngit commit -m \"init\"\ngit branch -M main\ngit remote add origin git@github.com:LZS911/LZS911.github.io.git //注意改成在第一步创建的仓库\ngit push -u origin main\n</code></pre>\n<h2 id=\"6-修改仓库设置\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#6-修改仓库设置\"><span class=\"icon icon-link\"></span></a>6. 修改仓库设置</h2>\n<p>将 <code>Branch</code> 选项设置为 <code>gh-pages</code></p>\n<p><img src=\"/assets/github-pages/example-2.png\" alt=\"alt\"></p>\n<h2 id=\"7-等待-actions-成功\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#7-等待-actions-成功\"><span class=\"icon icon-link\"></span></a>7. 等待 Actions 成功</h2>\n<p><img src=\"/assets/github-pages/example-3.png\" alt=\"alt\"></p>\n<p>最后, 打开  <a href=\"https://lzs911.github.io/\">https://lzs911.github.io/</a> 便可以访问到创建的 <code>Next</code> 项目. 后续更新只需要推送代码至 <code>main</code> 分支即可.</p>","theme":"fancy","tag":[null]}},"__N_SSG":true}