{"pageProps":{"post":{"title":"对象存储服务OSS","date":"2024-02-23","slug":"对象存储服务OSS","author":"Ai.Haibara","content":"<h2 id=\"什么是-oss\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#什么是-oss\"><span class=\"icon icon-link\"></span></a>什么是 OSS？</h2>\n<p><a href=\"https://help.aliyun.com/zh/oss/product-overview/what-is-oss\">阿里云 OSS 介绍</a></p>\n<h2 id=\"如何自己搭建一个-oss-服务\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#如何自己搭建一个-oss-服务\"><span class=\"icon icon-link\"></span></a>如何自己搭建一个 OSS 服务？</h2>\n<h3 id=\"minio\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#minio\"><span class=\"icon icon-link\"></span></a>MinIO</h3>\n<p><a href=\"https://zhuanlan.zhihu.com/p/103803549\">开源分布式对象存储-MinIO</a></p>\n<h3 id=\"使用-docker-部署-oss-服务\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#使用-docker-部署-oss-服务\"><span class=\"icon icon-link\"></span></a>使用 Docker 部署 OSS 服务</h3>\n<ol>\n<li>\n<p>先确定需要使用的 docker 镜像：<a href=\"https://hub.docker.com/r/bitnami/minio\">bitnami/minio</a></p>\n</li>\n<li>\n<p>编写 <code>docker-compose.yaml</code> 文件</p>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">\"2.4\"</span>\n\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">minio:</span>\n    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">always</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">\"bitnami/minio:latest\"</span>\n    <span class=\"hljs-attr\">ports:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"9000:9000\"</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">\"9001:9001\"</span>\n    <span class=\"hljs-attr\">environment:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=Asia/Shanghai</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">MINIO_ROOT_USER=liyu</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">MINIO_ROOT_PASSWORD=liyu@911.com</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">MINIO_PUBLIC_ADDRESS=http://47.115.219.196:9001/</span>\n    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">liyu_minio</span>\n    <span class=\"hljs-attr\">volumes:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">minio_data:/bitnami/minio/data</span>\n\n<span class=\"hljs-attr\">volumes:</span>\n  <span class=\"hljs-attr\">minio_data:</span>\n    <span class=\"hljs-attr\">driver:</span> <span class=\"hljs-string\">local</span>\n</code></pre>\n</li>\n<li>\n<p>启动容器：<code>docker-compose -f docker-compose.yaml up --build -d --remove-orphans</code></p>\n</li>\n</ol>\n<h3 id=\"管理界面操作\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#管理界面操作\"><span class=\"icon icon-link\"></span></a>管理界面操作</h3>\n<h3 id=\"使用-sdk-操作\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#使用-sdk-操作\"><span class=\"icon icon-link\"></span></a>使用 sdk 操作</h3>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">Minio</span> = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'minio'</span>);\n<span class=\"hljs-keyword\">const</span> fs = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'fs'</span>);\n\n<span class=\"hljs-keyword\">const</span> minioClient = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Minio</span>.<span class=\"hljs-title class_\">Client</span>({\n  <span class=\"hljs-attr\">endPoint</span>: <span class=\"hljs-string\">'47.115.219.196'</span>,\n  <span class=\"hljs-attr\">port</span>: <span class=\"hljs-number\">9000</span>,\n  <span class=\"hljs-attr\">useSSL</span>: <span class=\"hljs-literal\">false</span>,\n  <span class=\"hljs-attr\">accessKey</span>: <span class=\"hljs-string\">'zgJ83Buz1v9Q7s060fTS'</span>,\n  <span class=\"hljs-attr\">secretKey</span>: <span class=\"hljs-string\">'duysuG1vlfco6ozl8BtMkdY9Q3zm6fxDB02pRijT'</span>,\n});\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">put</span>(<span class=\"hljs-params\"></span>) {\n  minioClient.<span class=\"hljs-title function_\">fPutObject</span>(\n    <span class=\"hljs-string\">'liyu-test'</span>,\n    <span class=\"hljs-string\">'Union-put.svg'</span>,\n    <span class=\"hljs-string\">'./Union-get.svg'</span>,\n    <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">err, etag</span>) {\n      <span class=\"hljs-keyword\">if</span> (err) <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(err);\n      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'上传成功'</span>);\n    }\n  );\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">get</span>(<span class=\"hljs-params\"></span>) {\n  minioClient.<span class=\"hljs-title function_\">getObject</span>(<span class=\"hljs-string\">'liyu-test'</span>, <span class=\"hljs-string\">'Union.svg'</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, stream</span>) =></span> {\n    <span class=\"hljs-keyword\">if</span> (err) <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(err);\n    stream.<span class=\"hljs-title function_\">pipe</span>(fs.<span class=\"hljs-title function_\">createWriteStream</span>(<span class=\"hljs-string\">'./Union-get.svg'</span>));\n  });\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">main</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-comment\">// get();</span>\n\n  <span class=\"hljs-title function_\">put</span>();\n}\n\n<span class=\"hljs-title function_\">main</span>();\n</code></pre>","theme":"fancy","tag":[null]}},"__N_SSG":true}