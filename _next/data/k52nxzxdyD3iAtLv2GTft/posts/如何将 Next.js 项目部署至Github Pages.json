{"pageProps":{"post":{"title":"如何将 Next.js 项目部署至Github Pages","date":"2022-12-06","slug":"如何将 Next.js 项目部署至Github Pages","author":"Ai.Haibara","content":"<h2 id=\"1-创建-github-仓库\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#1-创建-github-仓库\"><span class=\"icon icon-link\"></span></a>1. 创建 Github 仓库</h2>\n<p>新建仓库名称约束: <code>username.github.io</code>, 其中 <code>username</code> 为 <code>Github</code> 上的用户名(或组织名称).</p>\n<p><img src=\"/assets/github-pages/example-1.png\" alt=\"alt\"></p>\n<h2 id=\"2-创建-nextjs-项目\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#2-创建-nextjs-项目\"><span class=\"icon icon-link\"></span></a>2. 创建 Next.js 项目</h2>\n<pre><code class=\"hljs language-ssh\">npx create-next-app@latest --typescript\n# or\nyarn create next-app --typescript\n# or\npnpm create next-app --typescript\n</code></pre>\n<h2 id=\"3-打开-packagejson-并添加脚本\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#3-打开-packagejson-并添加脚本\"><span class=\"icon icon-link\"></span></a>3. 打开 package.json 并添加脚本</h2>\n<pre><code class=\"hljs language-json\"> <span class=\"hljs-attr\">\"scripts\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"dev\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"next dev\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"build\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"next build\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"start\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"next start\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"lint\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"next lint\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"export\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"next export\"</span> <span class=\"hljs-comment\">//add</span>\n    <span class=\"hljs-string\">\"\"</span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n</code></pre>\n<h2 id=\"4-添加-github-actions\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#4-添加-github-actions\"><span class=\"icon icon-link\"></span></a>4. 添加 github Actions</h2>\n<p>关于 <code>GitHub Pages</code> 站点的发布源: <a href=\"https://docs.github.com/cn/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site\">https://docs.github.com/cn/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site</a></p>\n<p>鉴于 <code>Next.js</code> 的源码文件格式并不能直接作为发布源, 我们需要对项目进行打包处理, 同时也可以做一些代码 <code>check</code>, 所以我们需要添加 <code>github Actions</code>.</p>\n<p>添加文件: <code>.github/workflows/gh-pages.yml</code></p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">GitHub</span> <span class=\"hljs-string\">Pages</span>\n\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">branches:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">main</span>\n  <span class=\"hljs-attr\">pull_request:</span>\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">deploy:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-22.04</span>\n    <span class=\"hljs-attr\">permissions:</span>\n      <span class=\"hljs-attr\">contents:</span> <span class=\"hljs-string\">write</span>\n    <span class=\"hljs-attr\">concurrency:</span>\n      <span class=\"hljs-attr\">group:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">github.workflow</span> <span class=\"hljs-string\">}}-${{</span> <span class=\"hljs-string\">github.ref</span> <span class=\"hljs-string\">}}</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v3</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Setup</span> <span class=\"hljs-string\">Node</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/setup-node@v3</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">node-version:</span> <span class=\"hljs-string\">\"14\"</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Get</span> <span class=\"hljs-string\">yarn</span> <span class=\"hljs-string\">cache</span>\n        <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">yarn-cache</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">echo</span> <span class=\"hljs-string\">\"::set-output name=dir::$(yarn cache dir)\"</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Cache</span> <span class=\"hljs-string\">dependencies</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/cache@v2</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">steps.yarn-cache.outputs.dir</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">key:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">runner.os</span> <span class=\"hljs-string\">}}-yarn-${{</span> <span class=\"hljs-string\">hashFiles('**/yarn.lock')</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">restore-keys:</span> <span class=\"hljs-string\">|\n            ${{ runner.os }}-yarn-\n</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">yarn</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">--frozen-lockfile</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">yarn</span> <span class=\"hljs-string\">lint</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">yarn</span> <span class=\"hljs-string\">build</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">yarn</span> <span class=\"hljs-string\">export</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Deploy</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">peaceiris/actions-gh-pages@v3</span>\n        <span class=\"hljs-attr\">if:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">github.ref</span> <span class=\"hljs-string\">==</span> <span class=\"hljs-string\">'refs/heads/main'</span> <span class=\"hljs-string\">}}</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">github_token:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.GITHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">publish_dir:</span> <span class=\"hljs-string\">./out</span>\n\n</code></pre>\n<p>了解更多详细信息请前往: <a href=\"https://github.com/peaceiris/actions-gh-pages\">https://github.com/peaceiris/actions-gh-pages</a></p>\n<h2 id=\"5-将代码推送至仓库\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#5-将代码推送至仓库\"><span class=\"icon icon-link\"></span></a>5. 将代码推送至仓库</h2>\n<pre><code class=\"hljs language-ssh\">rm -rf .git\ngit add .\ngit commit -m \"init\"\ngit branch -M main\ngit remote add origin git@github.com:LZS911/LZS911.github.io.git //注意改成在第一步创建的仓库\ngit push -u origin main\n</code></pre>\n<h2 id=\"6-修改仓库设置\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#6-修改仓库设置\"><span class=\"icon icon-link\"></span></a>6. 修改仓库设置</h2>\n<p>将 <code>Branch</code> 选项设置为 <code>gh-pages</code></p>\n<p><img src=\"/assets/github-pages/example-2.png\" alt=\"alt\"></p>\n<h2 id=\"7-等待-actions-成功\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#7-等待-actions-成功\"><span class=\"icon icon-link\"></span></a>7. 等待 Actions 成功</h2>\n<p><img src=\"/assets/github-pages/example-3.png\" alt=\"alt\"></p>\n<p>最后, 打开  <a href=\"https://lzs911.github.io/\">https://lzs911.github.io/</a> 便可以访问到创建的 <code>Next</code> 项目. 后续更新只需要推送代码至 <code>main</code> 分支即可.</p>","theme":"fancy","tag":[null]}},"__N_SSG":true}