(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[858],{163:()=>{},401:()=>{},646:()=>{},788:()=>{},889:()=>{},1012:()=>{},1256:()=>{},1971:()=>{},2613:()=>{},2614:()=>{},3924:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});var n=r(5155),o=r(2115),s=r(9509);let l=s.env.NEXT_PUBLIC_GITHUB_CLIENT_ID;s.env.GH_CLIENT_SECRET,s.env.GITHUB_TOKEN;var i=r(6766);let a=e=>{let{slug:t}=e,[r,s]=(0,o.useState)([]),[a,c]=(0,o.useState)(!0),[d,m]=(0,o.useState)(null),[u,h]=(0,o.useState)(""),[b,f]=(0,o.useState)(!1),[p,v]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=async()=>{try{c(!0);let e=await fetch("/api/comments/".concat(t));if(!e.ok)throw Error("获取评论失败");let r=await e.json();s(r.comments||[])}catch(e){m("获取评论失败，请稍后再试"),console.error("Error fetching comments:",e)}finally{c(!1)}},r=async()=>{if(document.cookie.split("; ").find(e=>e.startsWith("github_token=")))try{v(null)}catch(e){console.error("Error fetching user info:",e)}};t&&(e(),r())},[t]);let x=async e=>{if(e.preventDefault(),u.trim())try{f(!0);let e=await fetch("/api/comments/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:u})});if(!e.ok){let t=await e.json();throw Error(t.error||"提交评论失败")}let r=await fetch("/api/comments/".concat(t)),n=await r.json();s(n.comments||[]),h("")}catch(e){m(e instanceof Error?e.message:"提交评论失败，请稍后再试"),console.error("Error submitting comment:",e)}finally{f(!1)}};return(0,n.jsxs)("div",{className:"mt-10 max-w-3xl",children:[(0,n.jsx)("h3",{className:"text-2xl font-bold mb-4",children:"评论"}),a?(0,n.jsx)("p",{children:"加载评论中..."}):d?(0,n.jsx)("p",{className:"text-red-500",children:d}):(0,n.jsxs)(n.Fragment,{children:[0===r.length?(0,n.jsx)("p",{className:"mb-4",children:"暂无评论，来添加第一条评论吧！"}):(0,n.jsx)("div",{className:"space-y-4 mb-6",children:r.map(e=>(0,n.jsxs)("div",{className:"border border-accent-2 p-4 rounded-md",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)(i.default,{src:e.author.avatarUrl,alt:e.author.login,className:"w-8 h-8 rounded-full mr-2"}),(0,n.jsx)("a",{href:e.author.url,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-black hover:underline",children:e.author.login}),(0,n.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:new Date(e.createdAt).toLocaleDateString()})]}),(0,n.jsx)("div",{className:"prose",dangerouslySetInnerHTML:{__html:e.bodyHTML}})]},e.id))}),p?(0,n.jsxs)("form",{onSubmit:x,className:"mt-6",children:[(0,n.jsxs)("div",{className:"mb-2 flex items-center",children:[(0,n.jsx)(i.default,{src:p.avatarUrl,alt:p.login,className:"w-8 h-8 rounded-full mr-2"}),(0,n.jsx)("span",{className:"font-medium",children:p.login})]}),(0,n.jsx)("textarea",{value:u,onChange:e=>h(e.target.value),className:"w-full border border-accent-2 rounded-md p-2 min-h-[100px]",placeholder:"写下你的评论...",disabled:b}),(0,n.jsx)("button",{type:"submit",disabled:b||!u.trim(),className:"mt-2 bg-black text-white px-4 py-2 rounded-md hover:bg-opacity-90 disabled:opacity-50",children:b?"提交中...":"提交评论"})]}):(0,n.jsxs)("div",{className:"mt-6 border border-accent-2 p-4 rounded-md text-center",children:[(0,n.jsx)("p",{className:"mb-2",children:"登录后参与讨论"}),(0,n.jsx)("button",{onClick:()=>{document.cookie="redirect_url=".concat(window.location.pathname,"; path=/; max-age=300"),window.location.href=function(){let e="".concat(window.location.origin,"/api/auth/github/callback");return"https://github.com/login/oauth/authorize?client_id=".concat(l,"&redirect_uri=").concat(encodeURIComponent(e),"&scope=public_repo")}()},className:"bg-black text-white px-4 py-2 rounded-md hover:bg-opacity-90",children:"使用 GitHub 登录"})]})]})]})}},4119:()=>{},4124:()=>{},4237:()=>{},4398:()=>{},4627:()=>{},5595:()=>{},6250:()=>{},6654:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return o}});let n=r(2115);function o(e,t){let r=(0,n.useRef)(null),o=(0,n.useRef)(null);return(0,n.useCallback)(n=>{if(null===n){let e=r.current;e&&(r.current=null,e());let t=o.current;t&&(o.current=null,t())}else e&&(r.current=s(e,n)),t&&(o.current=s(t,n))},[e,t])}function s(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7209:()=>{},7221:()=>{},7522:()=>{},7603:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,7209,23)),Promise.resolve().then(r.t.bind(r,7800,23)),Promise.resolve().then(r.t.bind(r,9689,23)),Promise.resolve().then(r.t.bind(r,2613,23)),Promise.resolve().then(r.t.bind(r,4124,23)),Promise.resolve().then(r.t.bind(r,401,23)),Promise.resolve().then(r.t.bind(r,2614,23)),Promise.resolve().then(r.t.bind(r,5595,23)),Promise.resolve().then(r.t.bind(r,889,23)),Promise.resolve().then(r.t.bind(r,7906,23)),Promise.resolve().then(r.t.bind(r,8588,23)),Promise.resolve().then(r.t.bind(r,4398,23)),Promise.resolve().then(r.t.bind(r,7522,23)),Promise.resolve().then(r.t.bind(r,6250,23)),Promise.resolve().then(r.t.bind(r,788,23)),Promise.resolve().then(r.t.bind(r,4237,23)),Promise.resolve().then(r.t.bind(r,1012,23)),Promise.resolve().then(r.t.bind(r,1256,23)),Promise.resolve().then(r.t.bind(r,4627,23)),Promise.resolve().then(r.t.bind(r,4119,23)),Promise.resolve().then(r.t.bind(r,163,23)),Promise.resolve().then(r.t.bind(r,1971,23)),Promise.resolve().then(r.t.bind(r,7221,23)),Promise.resolve().then(r.t.bind(r,8515,23)),Promise.resolve().then(r.t.bind(r,646,23)),Promise.resolve().then(r.bind(r,3924))},7800:()=>{},7906:()=>{},8515:()=>{},8588:()=>{},9689:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[508,859,749,766,441,684,358],()=>t(7603)),_N_E=e.O()}]);