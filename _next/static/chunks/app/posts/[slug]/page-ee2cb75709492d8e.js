(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[858],{163:()=>{},401:()=>{},646:()=>{},788:()=>{},889:()=>{},1012:()=>{},1256:()=>{},1971:()=>{},2613:()=>{},2614:()=>{},3924:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var s=r(5155),n=r(2115),o=r(9509);let i=o.env.NEXT_PUBLIC_GITHUB_CLIENT_ID;async function l(e){try{let t=await fetch("https://api.github.com/user",{headers:{Authorization:"token ".concat(e),Accept:"application/json"}});if(!t.ok)return console.error("获取用户信息失败:",t.statusText),null;return await t.json()}catch(e){return console.error("获取用户信息异常:",e),null}}o.env.GH_CLIENT_SECRET,o.env.GITHUB_TOKEN;var a=r(6766),c=r(3319);let d=e=>{let{onSubmit:t,isSubmitting:r,initialContent:o="",placeholder:i="写下你的评论...",buttonText:l="提交评论",userInfo:c}=e,[d,m]=(0,n.useState)(o);return(0,s.jsxs)("div",{className:"mt-2 bg-white rounded-lg p-3 shadow-sm",children:[c&&(0,s.jsxs)("div",{className:"mb-2 flex items-center",children:[(0,s.jsx)(a.default,{src:c.avatarUrl,alt:c.login,className:"w-8 h-8 rounded-full mr-2 border-2 border-gray-100",width:32,height:32}),(0,s.jsx)("span",{className:"font-medium text-gray-800 text-sm",children:c.login})]}),(0,s.jsx)("textarea",{value:d,onChange:e=>m(e.target.value),className:"w-full border border-gray-200 rounded-lg p-2 min-h-[80px] focus:ring-1 focus:ring-blue-500 focus:border-transparent resize-none text-sm",placeholder:i,disabled:r}),(0,s.jsx)("button",{onClick:()=>{t(d),m("")},disabled:r||!d.trim(),className:"mt-2 bg-black text-white px-4 py-1.5 text-sm rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer",children:r?"提交中...":l})]})},m=e=>{let{comment:t,onReply:r,userInfo:o,isSubmitting:i,level:l=0}=e,[m,h]=(0,n.useState)(!1);return(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm transition-all ".concat(l>0?"ml-6 mt-2 border-l-2 border-gray-100":"border border-gray-100"),children:(0,s.jsxs)("div",{className:"p-3",children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[(0,s.jsx)(a.default,{src:t.author.avatarUrl,alt:t.author.login,className:"w-8 h-8 rounded-full mr-2 border-2 border-gray-100",width:32,height:32}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("a",{href:t.author.url,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-gray-900 hover:text-blue-600 transition-colors text-sm truncate block",children:t.author.login}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:(0,c.GP)(new Date(t.createdAt),"yyyy-MM-dd HH:mm:ss")})]})]}),(0,s.jsx)("div",{className:"prose max-w-none mb-2 text-sm text-gray-800 leading-normal",children:t.content}),o&&0===l&&(0,s.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-50",children:[(0,s.jsxs)("button",{onClick:()=>h(!m),className:"text-xs text-gray-600 hover:text-blue-600 transition-colors flex items-center cursor-pointer",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),m?"取消回复":"回复"]}),m&&(0,s.jsx)(d,{onSubmit:e=>{r(e,t.id),h(!1)},isSubmitting:i,placeholder:"回复 @".concat(t.author.login,"..."),buttonText:"提交回复",userInfo:o})]})]})})},h=e=>{var t;let{comment:r,onReply:o,userInfo:i,isSubmitting:l}=e,[a,c]=(0,n.useState)(!1),d=r.replies&&r.replies.length>3,h=a?r.replies:null==(t=r.replies)?void 0:t.slice(0,3);return(0,s.jsxs)("div",{children:[(0,s.jsx)(m,{comment:r,onReply:o,userInfo:i,isSubmitting:l}),null==h?void 0:h.map(e=>(0,s.jsx)(m,{comment:e,onReply:o,userInfo:i,isSubmitting:l,level:1},e.id)),d&&(0,s.jsxs)("button",{onClick:()=>c(!a),className:"ml-6 mt-2 text-xs text-blue-600 hover:text-blue-800 transition-colors flex items-center cursor-pointer",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a?(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"}):(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),a?"收起回复":"展开其他 ".concat(r.replies.length-3," 条回复")]})]})},u=e=>{let{slug:t}=e,[r,o]=(0,n.useState)([]),[a,c]=(0,n.useState)(!0),[m,u]=(0,n.useState)(null),[x,b]=(0,n.useState)(!1),[p,g]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=async()=>{try{c(!0);let e=await fetch("/api/comments/".concat(t));if(!e.ok)throw Error("获取评论失败");let r=await e.json();o(r.comments||[])}catch(e){u("获取评论失败，请稍后再试"),console.error("Error fetching comments:",e)}finally{c(!1)}},r=async()=>{let e=document.cookie.split("; ").find(e=>e.startsWith("github_token="));if(e){let t=e.split("=")[1];try{let e=await l(t);e?g({login:e.login,avatarUrl:e.avatar_url}):g(null)}catch(e){console.error("Error fetching user info:",e),g(null)}}else g(null)};t&&(e(),r())},[t]);let v=async(e,r)=>{if(e.trim())try{b(!0);let s=document.cookie.split("; ").find(e=>e.startsWith("github_token="));if(!s)throw Error("请先登录后再评论");let n=s.split("=")[1],i=await fetch("/api/comments/".concat(t),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({content:e,replyToId:r})});if(!i.ok){let e=await i.json();throw Error(e.error||"提交评论失败")}let l=await fetch("/api/comments/".concat(t)),a=await l.json();o(a.comments||[])}catch(e){u(e instanceof Error?e.message:"提交评论失败，请稍后再试"),console.error("Error submitting comment:",e)}finally{b(!1)}},f=r.reduce((e,t)=>{if(t.replyToId){let e=r.find(e=>e.id===t.replyToId);e&&(Array.isArray(e.replies)||(e.replies=[]),e.replies.push(t))}else e.push(t);return e},[]);return(0,s.jsxs)("div",{className:"mt-8 max-w-3xl mx-auto",children:[(0,s.jsx)("h3",{className:"text-xl font-bold mb-4 text-gray-900",children:"评论区"}),a?(0,s.jsxs)("div",{className:"text-center py-6",children:[(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-3 border-gray-200 border-t-blue-600"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"加载评论中..."})]}):m?(0,s.jsx)("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg text-sm",children:m}):(0,s.jsxs)(s.Fragment,{children:[p?(0,s.jsx)(d,{onSubmit:e=>v(e),isSubmitting:x,userInfo:p}):(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:[(0,s.jsx)("p",{className:"mb-3 text-sm text-gray-700",children:"登录后参与讨论"}),(0,s.jsxs)("button",{onClick:()=>{document.cookie="redirect_url=".concat(window.location.pathname,"; path=/; max-age=300"),window.location.href=function(){let e="".concat(window.location.origin,"/api/auth/github/callback");return"https://github.com/login/oauth/authorize?client_id=".concat(i,"&redirect_uri=").concat(encodeURIComponent(e),"&scope=public_repo")}()},className:"bg-black text-white px-4 py-1.5 text-sm rounded-lg transition-colors inline-flex items-center cursor-pointer",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})}),"使用 GitHub 登录"]})]}),(0,s.jsx)("div",{className:"mt-4 space-y-2",children:0===f.length?(0,s.jsx)("div",{className:"text-center py-6 text-sm text-gray-500",children:"暂无评论，来添加第一条评论吧！"}):f.map(e=>(0,s.jsx)(h,{comment:e,onReply:v,userInfo:p,isSubmitting:x},e.id))})]})]})}},4119:()=>{},4124:()=>{},4237:()=>{},4398:()=>{},4627:()=>{},5595:()=>{},6250:()=>{},7209:()=>{},7221:()=>{},7522:()=>{},7603:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,7209,23)),Promise.resolve().then(r.t.bind(r,7800,23)),Promise.resolve().then(r.t.bind(r,9689,23)),Promise.resolve().then(r.t.bind(r,2613,23)),Promise.resolve().then(r.t.bind(r,4124,23)),Promise.resolve().then(r.t.bind(r,401,23)),Promise.resolve().then(r.t.bind(r,2614,23)),Promise.resolve().then(r.t.bind(r,5595,23)),Promise.resolve().then(r.t.bind(r,889,23)),Promise.resolve().then(r.t.bind(r,7906,23)),Promise.resolve().then(r.t.bind(r,8588,23)),Promise.resolve().then(r.t.bind(r,4398,23)),Promise.resolve().then(r.t.bind(r,7522,23)),Promise.resolve().then(r.t.bind(r,6250,23)),Promise.resolve().then(r.t.bind(r,788,23)),Promise.resolve().then(r.t.bind(r,4237,23)),Promise.resolve().then(r.t.bind(r,1012,23)),Promise.resolve().then(r.t.bind(r,1256,23)),Promise.resolve().then(r.t.bind(r,4627,23)),Promise.resolve().then(r.t.bind(r,4119,23)),Promise.resolve().then(r.t.bind(r,163,23)),Promise.resolve().then(r.t.bind(r,1971,23)),Promise.resolve().then(r.t.bind(r,7221,23)),Promise.resolve().then(r.t.bind(r,8515,23)),Promise.resolve().then(r.t.bind(r,646,23)),Promise.resolve().then(r.bind(r,3924))},7800:()=>{},7906:()=>{},8515:()=>{},8588:()=>{},9689:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[508,859,749,766,62,441,684,358],()=>t(7603)),_N_E=e.O()}]);