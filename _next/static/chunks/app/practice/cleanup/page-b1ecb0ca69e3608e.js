(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[617],{5343:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>n});var r=t(5155),s=t(2115),l=t(5695);function n(){let e=(0,l.useRouter)(),[a,t]=(0,s.useState)(""),[n,c]=(0,s.useState)(null),[i,o]=(0,s.useState)(!1),[d,u]=(0,s.useState)(""),[m,h]=(0,s.useState)("86400000"),[p,x]=(0,s.useState)("86400000");(0,s.useEffect)(()=>{!async function(){try{(await fetch("/api/auth/check")).ok||e.push("/")}catch(a){console.error("检查认证状态失败:",a),e.push("/")}}()},[e]),(0,s.useEffect)(()=>{let e=localStorage.getItem("cleanup_api_key");e&&(t(e),(async()=>{o(!0);try{let a=await fetch("/api/cleanup?key=".concat(e,"&operation=status"));if(a.ok){let e=await a.json();c(e),u("")}else{localStorage.removeItem("cleanup_api_key");let e=await a.json();u(e.error||"获取状态失败，请重新输入 API 密钥")}}catch(e){u("获取状态失败: "+e.message)}finally{o(!1)}})())},[]);let b=async()=>{if(!a.trim())return void u("请输入 API 密钥");o(!0);try{let e=await fetch("/api/cleanup?key=".concat(a,"&operation=status"));if(e.ok){let t=await e.json();c(t),u(""),localStorage.setItem("cleanup_api_key",a)}else{let a=await e.json();u(a.error||"获取状态失败")}}catch(e){u("获取状态失败: "+e.message)}finally{o(!1)}},y=async()=>{if(!a.trim())return void u("请输入 API 密钥");o(!0);try{let e=await fetch("/api/cleanup?key=".concat(a,"&operation=manual"));if(e.ok){let a=await e.json();u(a.message||"清理完成"),b()}else{let a=await e.json();u(a.error||"清理失败")}}catch(e){u("清理失败: "+e.message)}finally{o(!1)}},g=async()=>{if(!a.trim())return void u("请输入 API 密钥");o(!0);try{let e=await fetch("/api/cleanup?key=".concat(a,"&operation=start&interval=").concat(m));if(e.ok){let a=await e.json();u(a.message||"定时任务已启动"),b()}else{let a=await e.json();u(a.error||"启动任务失败")}}catch(e){u("启动任务失败: "+e.message)}finally{o(!1)}},j=async()=>{if(!a.trim())return void u("请输入 API 密钥");o(!0);try{let e=await fetch("/api/cleanup?key=".concat(a,"&operation=stop"));if(e.ok){let a=await e.json();u(a.message||"定时任务已停止"),b()}else{let a=await e.json();u(a.error||"停止任务失败")}}catch(e){u("停止任务失败: "+e.message)}finally{o(!1)}},v=e=>e<6e4?"".concat(e/1e3,"秒"):e<36e5?"".concat(e/6e4,"分钟"):e<864e5?"".concat(e/36e5,"小时"):"".concat(e/864e5,"天");return(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"临时文件清理管理"}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6 mb-6",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"apiKey",className:"block text-gray-700 dark:text-gray-300 mb-2",children:"API 密钥"}),(0,r.jsx)("input",{id:"apiKey",type:"password",value:a,onChange:e=>t(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md",placeholder:"输入 API 密钥"})]}),(0,r.jsxs)("div",{className:"flex space-x-2 mb-6",children:[(0,r.jsx)("button",{onClick:b,disabled:i,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md disabled:opacity-50",children:"获取状态"}),(0,r.jsx)("button",{onClick:y,disabled:i,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md disabled:opacity-50",children:"手动清理"})]}),n&&(0,r.jsxs)("div",{className:"bg-gray-100 dark:bg-gray-700 p-4 rounded-md mb-6",children:[(0,r.jsx)("h2",{className:"font-bold mb-2",children:"当前状态"}),(0,r.jsxs)("p",{children:["定时任务: ",n.active?"运行中":"已停止"]}),n.interval&&(0,r.jsxs)("p",{children:["清理间隔: ",v(n.interval)]}),(0,r.jsxs)("p",{children:["状态信息: ",n.message]})]}),(0,r.jsxs)("div",{className:"border-t border-gray-300 dark:border-gray-600 pt-6 mb-4",children:[(0,r.jsx)("h2",{className:"font-bold mb-4",children:"定时任务管理"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"intervalPreset",className:"block text-gray-700 dark:text-gray-300 mb-2",children:"清理间隔预设"}),(0,r.jsxs)("select",{id:"intervalPreset",value:p,onChange:e=>{let a=e.target.value;x(a),h(a)},className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md",children:[(0,r.jsx)("option",{value:"3600000",children:"1小时"}),(0,r.jsx)("option",{value:"7200000",children:"2小时"}),(0,r.jsx)("option",{value:"21600000",children:"6小时"}),(0,r.jsx)("option",{value:"43200000",children:"12小时"}),(0,r.jsx)("option",{value:"86400000",children:"1天"}),(0,r.jsx)("option",{value:"604800000",children:"1周"}),(0,r.jsx)("option",{value:"custom",children:"自定义"})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"interval",className:"block text-gray-700 dark:text-gray-300 mb-2",children:"自定义间隔 (毫秒)"}),(0,r.jsx)("input",{id:"interval",type:"number",value:m,onChange:e=>{h(e.target.value),x("custom")},className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md",placeholder:"清理间隔 (毫秒)",min:"60000"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["当前设置: ",v(parseInt(m,10)||0)]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:g,disabled:i,className:"bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-md disabled:opacity-50",children:"启动定时任务"}),(0,r.jsx)("button",{onClick:j,disabled:i,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md disabled:opacity-50",children:"停止定时任务"})]})]})]}),d&&(0,r.jsx)("div",{className:"p-4 rounded-md ".concat(d.includes("失败")?"bg-red-100 text-red-700":"bg-green-100 text-green-700"),children:d}),(0,r.jsx)("div",{className:"mt-6 text-center",children:(0,r.jsx)("a",{href:"/practice",className:"text-blue-500 hover:underline",children:"返回写作页面"})})]})}},5695:(e,a,t)=>{"use strict";var r=t(8999);t.o(r,"usePathname")&&t.d(a,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(a,{useSearchParams:function(){return r.useSearchParams}})},8956:(e,a,t)=>{Promise.resolve().then(t.bind(t,5343))}},e=>{var a=a=>e(e.s=a);e.O(0,[441,684,358],()=>a(8956)),_N_E=e.O()}]);