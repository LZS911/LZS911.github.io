(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[617],{5343:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>s});var l=t(5155),r=t(2115);function s(){let[e,a]=(0,r.useState)(""),[t,s]=(0,r.useState)(null),[i,n]=(0,r.useState)(!1),[c,d]=(0,r.useState)(""),[o,m]=(0,r.useState)("86400000"),[p,h]=(0,r.useState)("86400000");(0,r.useEffect)(()=>{let e=localStorage.getItem("cleanup_api_key");e&&(a(e),(async()=>{n(!0);try{let a=await fetch("/api/cleanup?key=".concat(e,"&operation=status"));if(a.ok){let e=await a.json();s(e),d("")}else{localStorage.removeItem("cleanup_api_key");let e=await a.json();d(e.error||"获取状态失败，请重新输入 API 密钥")}}catch(e){d("获取状态失败: "+e.message)}finally{n(!1)}})())},[]);let u=async()=>{if(!e.trim())return void d("请输入 API 密钥");n(!0);try{let a=await fetch("/api/cleanup?key=".concat(e,"&operation=status"));if(a.ok){let t=await a.json();s(t),d(""),localStorage.setItem("cleanup_api_key",e)}else{let e=await a.json();d(e.error||"获取状态失败")}}catch(e){d("获取状态失败: "+e.message)}finally{n(!1)}},x=async()=>{if(!e.trim())return void d("请输入 API 密钥");n(!0);try{let a=await fetch("/api/cleanup?key=".concat(e,"&operation=manual"));if(a.ok){let e=await a.json();d(e.message||"清理完成"),u()}else{let e=await a.json();d(e.error||"清理失败")}}catch(e){d("清理失败: "+e.message)}finally{n(!1)}},b=async()=>{if(!e.trim())return void d("请输入 API 密钥");n(!0);try{let a=await fetch("/api/cleanup?key=".concat(e,"&operation=start&interval=").concat(o));if(a.ok){let e=await a.json();d(e.message||"定时任务已启动"),u()}else{let e=await a.json();d(e.error||"启动任务失败")}}catch(e){d("启动任务失败: "+e.message)}finally{n(!1)}},g=async()=>{if(!e.trim())return void d("请输入 API 密钥");n(!0);try{let a=await fetch("/api/cleanup?key=".concat(e,"&operation=stop"));if(a.ok){let e=await a.json();d(e.message||"定时任务已停止"),u()}else{let e=await a.json();d(e.error||"停止任务失败")}}catch(e){d("停止任务失败: "+e.message)}finally{n(!1)}},y=e=>e<6e4?"".concat(e/1e3,"秒"):e<36e5?"".concat(e/6e4,"分钟"):e<864e5?"".concat(e/36e5,"小时"):"".concat(e/864e5,"天");return(0,l.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"临时文件清理管理"}),(0,l.jsxs)("div",{className:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6 mb-6",children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{htmlFor:"apiKey",className:"block text-gray-700 dark:text-gray-300 mb-2",children:"API 密钥"}),(0,l.jsx)("input",{id:"apiKey",type:"password",value:e,onChange:e=>a(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md",placeholder:"输入 API 密钥"})]}),(0,l.jsxs)("div",{className:"flex space-x-2 mb-6",children:[(0,l.jsx)("button",{onClick:u,disabled:i,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md disabled:opacity-50",children:"获取状态"}),(0,l.jsx)("button",{onClick:x,disabled:i,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md disabled:opacity-50",children:"手动清理"})]}),t&&(0,l.jsxs)("div",{className:"bg-gray-100 dark:bg-gray-700 p-4 rounded-md mb-6",children:[(0,l.jsx)("h2",{className:"font-bold mb-2",children:"当前状态"}),(0,l.jsxs)("p",{children:["定时任务: ",t.active?"运行中":"已停止"]}),t.interval&&(0,l.jsxs)("p",{children:["清理间隔: ",y(t.interval)]}),(0,l.jsxs)("p",{children:["状态信息: ",t.message]})]}),(0,l.jsxs)("div",{className:"border-t border-gray-300 dark:border-gray-600 pt-6 mb-4",children:[(0,l.jsx)("h2",{className:"font-bold mb-4",children:"定时任务管理"}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{htmlFor:"intervalPreset",className:"block text-gray-700 dark:text-gray-300 mb-2",children:"清理间隔预设"}),(0,l.jsxs)("select",{id:"intervalPreset",value:p,onChange:e=>{let a=e.target.value;h(a),m(a)},className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md",children:[(0,l.jsx)("option",{value:"3600000",children:"1小时"}),(0,l.jsx)("option",{value:"7200000",children:"2小时"}),(0,l.jsx)("option",{value:"21600000",children:"6小时"}),(0,l.jsx)("option",{value:"43200000",children:"12小时"}),(0,l.jsx)("option",{value:"86400000",children:"1天"}),(0,l.jsx)("option",{value:"604800000",children:"1周"}),(0,l.jsx)("option",{value:"custom",children:"自定义"})]})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{htmlFor:"interval",className:"block text-gray-700 dark:text-gray-300 mb-2",children:"自定义间隔 (毫秒)"}),(0,l.jsx)("input",{id:"interval",type:"number",value:o,onChange:e=>{m(e.target.value),h("custom")},className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md",placeholder:"清理间隔 (毫秒)",min:"60000"}),(0,l.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["当前设置: ",y(parseInt(o,10)||0)]})]}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)("button",{onClick:b,disabled:i,className:"bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-md disabled:opacity-50",children:"启动定时任务"}),(0,l.jsx)("button",{onClick:g,disabled:i,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md disabled:opacity-50",children:"停止定时任务"})]})]})]}),c&&(0,l.jsx)("div",{className:"p-4 rounded-md ".concat(c.includes("失败")?"bg-red-100 text-red-700":"bg-green-100 text-green-700"),children:c}),(0,l.jsx)("div",{className:"mt-6 text-center",children:(0,l.jsx)("a",{href:"/practice",className:"text-blue-500 hover:underline",children:"返回写作页面"})})]})}},8956:(e,a,t)=>{Promise.resolve().then(t.bind(t,5343))}},e=>{var a=a=>e(e.s=a);e.O(0,[441,684,358],()=>a(8956)),_N_E=e.O()}]);