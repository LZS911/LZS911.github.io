(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[502],{907:(e,t,a)=>{Promise.resolve().then(a.bind(a,5657))},1928:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(5155),n=a(6766);let l=e=>{let{name:t,picture:a,showName:l,...s}=e;return(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(n.default,{src:a,className:" rounded-full",alt:t,...s}),l?(0,r.jsx)("div",{className:"text-xl font-bold",children:t}):null]})}},5657:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>_});var r=a(5155),n=a(8923),l=a(2115),s=a(7660),o=a(9641).Buffer,c=a(9509);class i{async uploadImage(e,t){try{let a=Date.now(),r=t||"image-".concat(a,".png"),n="".concat(this.imagesPath,"/").concat(r),l=await e.arrayBuffer(),s=o.from(l).toString("base64");this.uploadedImages.push({path:n,content:s,name:r});let c=new Blob([new Uint8Array(l)],{type:"image/png"});return URL.createObjectURL(c)+"#"+"/assets/blog/posts/".concat(r)}catch(e){throw console.error("处理图片失败:",e),Error("处理图片失败")}}getUploadedImages(){return[...this.uploadedImages]}clearUploadedImages(){this.uploadedImages=[]}constructor(e){this.uploadedImages=[],this.octokit=new s.E({auth:(null==e?void 0:e.auth)||c.env.NEXT_PUBLIC_GITHUB_TOKEN}),this.owner=(null==e?void 0:e.owner)||c.env.NEXT_PUBLIC_GITHUB_OWNER||"LZS911",this.repo=(null==e?void 0:e.repo)||c.env.NEXT_PUBLIC_REPO_NAME||"LZS911.github.io",this.imagesPath=(null==e?void 0:e.imagesPath)||"public/assets/blog/posts"}}let u=null;function d(){return u||((c.env.NEXT_PUBLIC_STORAGE_TYPE||"github").toLowerCase(),u=new i)}var g=a(9509),h=a(9641).Buffer;let m=new s.E({auth:g.env.NEXT_PUBLIC_GITHUB_TOKEN}),f=g.env.NEXT_PUBLIC_GITHUB_OWNER||"LZS911",p=g.env.NEXT_PUBLIC_REPO_NAME||"LZS911.github.io";async function b(e){let{title:t,content:a,path:r}=e;try{let{data:e}=await m.git.getRef({owner:f,repo:p,ref:"heads/main"}),n="algorithm-post-".concat(Date.now());await m.git.createRef({owner:f,repo:p,ref:"refs/heads/".concat(n),sha:e.object.sha});let l=d(),s=l.getUploadedImages();for(let e of s)await m.repos.createOrUpdateFileContents({owner:f,repo:p,path:e.path,message:"feat: upload image ".concat(e.name),content:e.content,branch:n});await m.repos.createOrUpdateFileContents({owner:f,repo:p,path:r,message:"feat: ".concat(t),content:h.from(a).toString("base64"),branch:n});let{data:o}=await m.pulls.create({owner:f,repo:p,title:t,head:n,base:"main",body:"auto create pr".concat(s.length>0?" with ".concat(s.length," images"):"")});return l.clearUploadedImages(),{url:o.html_url}}catch(e){throw console.error("创建 PR 失败:",e),Error("创建 PR 失败")}}var v=a(1928);let y=["arknights","awesome-green","channing-cyan","Chinese-red","condensed-night-purple","cyanosis","devui-blue","fancy","geek-black","github","greenwillow","healer-readable","hydrogen","juejin","jzman","mk-cute","nico","orange","qklhk-chocolate","scrolls-light","simplicity-green","smartblue","v-green","vue-pro","vuepress"];var x=a(3319);let w=(e,t,a,r)=>"---\ntitle: ".concat(e,'\nlayout: post\ndate: "').concat((0,x.GP)(new Date,"yyyy-MM-dd"),'"\nimage:\nheaderImage: false\nstar: true\ncategory: ').concat(r,"\nauthor: LZS_911\ndescription: ").concat(r,"\nexcerpt: ''\ntheme: ").concat(a,"  \n---\n\n").concat(t,"\n");var I=a(9345),j=a.n(I);let N=["talk","project","blog"];function _(){let[e,t]=(0,l.useState)(""),[a,s]=(0,l.useState)(""),[o,c]=(0,l.useState)(N[0]),[i,u]=(0,l.useState)(y[0]),[g,h]=(0,l.useState)(!1),[m,f]=(0,l.useState)(null),[p,I]=(0,l.useState)(!1),[_,k]=(0,l.useState)(!1),[E,S]=(0,l.useState)(""),T=(0,l.useRef)(null),C=(0,l.useRef)(null),P=(0,l.useRef)({title:"",content:"",theme:"",category:N[0]}),L=(0,l.useCallback)(async a=>{var r;let n=null==(r=a.clipboardData)?void 0:r.items;if(n){for(let r=0;r<n.length;r++)if(-1!==n[r].type.indexOf("image")){a.preventDefault();let l=n[r].getAsFile();if(!l)continue;try{k(!0);let a=C.current,r=a?a.selectionStart:-1,n="img-upload-".concat(Date.now()),s="![正在上传图片...](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YwZjBmMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGFsaWdubWVudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSIjOTk5Ij7mraPluLjkuIrkvKDkuK0uLi48L3RleHQ+PC9zdmc+#".concat(n,")"),o=U(e,s,r);t(o),S("上传图片中...");let c=d(),i=await c.uploadImage(l),u=B(o,n,i);t(u),S("图片上传成功!"),setTimeout(()=>S(""),3e3)}catch(e){console.error("粘贴图片失败:",e),S("图片上传失败，请重试"),setTimeout(()=>S(""),3e3)}finally{k(!1)}break}}},[e]),U=(e,t,a)=>a>=0&&a<=e.length?e.slice(0,a)+t+e.slice(a):e+"\n"+t,B=(e,t,a)=>{let r=RegExp("!\\[正在上传图片...\\]\\(data:image\\/svg\\+xml;base64,[^#]+#".concat(t,"\\)"),"g");return e.replace(r,"![".concat(a.split("#")[1]||"image","](").concat(a.split("#")[0],")"))};(0,l.useEffect)(()=>{let e=()=>{if(T.current){let e=T.current.querySelector("textarea");if(e)return C.current=e,e.addEventListener("paste",L),!0}return!1};if(!e()){let t=setTimeout(()=>{e()},500);return()=>clearTimeout(t)}return()=>{C.current&&C.current.removeEventListener("paste",L)}},[L]),(0,l.useEffect)(()=>{let e=localStorage.getItem("blog_draft");if(e)try{let{title:a,content:r,category:n,theme:l,lastSaved:o}=JSON.parse(j().decompressFromUTF16(e)||"{}");s(a||""),t(r||""),c(n||N[0]),u(l||y[0]),P.current={title:a||"",content:r||"",theme:l||y[0],category:n||N[0]},f(new Date(o))}catch(e){console.error("Failed to load draft:",e)}},[]),(0,l.useEffect)(()=>{let t=setInterval(()=>{I(!0);let t={title:a,content:e,category:o,lastSaved:new Date().toISOString(),theme:i},r=j().compressToUTF16(JSON.stringify(t));localStorage.setItem("blog_draft",r),P.current={title:a,content:e,category:o,theme:i},f(new Date(t.lastSaved)),I(!1)},3e4);return()=>{clearInterval(t)}},[a,e,o,i]),(0,l.useEffect)(()=>{let t=t=>{let r=P.current.title!==a||P.current.content!==e||P.current.category!==o||P.current.theme!==i;if(p||r)return t.preventDefault(),t.returnValue="您有未保存的更改，确定要离开吗？",t.returnValue};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}},[o,e,p,i,a]);let R=async()=>{if(!e||!a)return void alert("标题和内容不能为空");h(!0);try{let r=e.replace(/!\[(.*?)\]\((blob:[^#]+)#([^)]+)\)/g,(e,t,a,r)=>"![image](".concat(r,")")),n="_posts/".concat(a,".md"),l=await b({title:a,content:w(a,r,i,o),path:n});(null==l?void 0:l.url)&&(alert("提交成功！PR链接："+l.url),localStorage.removeItem("blog_draft"),t(""),s(""),f(null),window.open(l.url,"_blank"))}catch(e){alert("提交失败："+e.message)}finally{h(!1)}};return(0,r.jsxs)("div",{className:"flex flex-col w-full min-h-screen",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-6 py-2 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 sticky top-0 z-10",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,r.jsx)("input",{type:"text",value:a,onChange:e=>s(e.target.value),placeholder:"请输入文章标题",className:"text-2xl font-bold px-4 py-2 w-1/3 border-none focus:outline-none focus:ring-0 dark:bg-gray-800 dark:text-white placeholder-gray-400"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("select",{value:o,onChange:e=>c(e.target.value),className:"px-3 py-1.5 text-sm border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white bg-transparent",children:N.map(e=>(0,r.jsx)("option",{value:e,children:e},e))}),(0,r.jsx)("select",{value:i,onChange:e=>u(e.target.value),className:"px-3 py-1.5 text-sm border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white bg-transparent",children:y.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[E&&(0,r.jsx)("span",{className:"text-sm px-3 py-1 bg-blue-100 text-blue-800 rounded-full",children:E}),(0,r.jsx)(v.A,{name:"Ai.Haibara",picture:"/assets/blog/authors/haibara_2.jpg",height:40,width:40}),(0,r.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:p?"自动保存中...":m?"上次保存: ".concat((0,x.GP)(m,"yyyy-MM-dd HH:mm:ss")):"尚未保存"}),(0,r.jsx)("button",{onClick:R,disabled:g||_,className:"px-4 py-2 bg-blue-500 text-white text-sm rounded-full hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:g?"提交中...":"发布文章"})]})]}),(0,r.jsx)("div",{className:"flex-1 w-full",children:(0,r.jsx)("div",{ref:T,children:(0,r.jsx)(n.Ay,{value:e,onChange:e=>t(e||""),height:window.innerHeight-76,preview:"edit",className:"editor-fullscreen h-full",hideToolbar:!1,textareaProps:{placeholder:"请输入文章内容...","aria-label":"可以粘贴图片（Ctrl+V）到编辑器中"}})})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[827,766,62,598,441,684,358],()=>t(907)),_N_E=e.O()}]);